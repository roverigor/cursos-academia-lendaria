# Aula 3.2: Client vs Server - A Diferença Crucial

**Módulo:** 3 - Environment Variables
**Duração:** 8 minutos
**Tipo:** Conceitual + demo

---

## Objetivo da Aula

Ao final desta aula, o aluno vai:
- Entender diferença client vs server
- Saber quando usar NEXT_PUBLIC_
- Evitar expor secrets no client

---

## Roteiro

### ABERTURA (20 segundos)

```
[TELA: Título com dois lados - Client | Server]
```

**NARRAÇÃO:**

> Essa aula pode parecer teórica, mas é a diferença entre seu app funcionar e dar "undefined" em produção.
>
> Client vs Server. Entende isso e você nunca mais vai ter problema com env vars.

---

### BLOCO 1: O QUE É CLIENT E SERVER (2 minutos)

```
[TELA: Diagrama navegador ↔ servidor]
```

**NARRAÇÃO:**

> No Next.js, seu código roda em DOIS lugares diferentes:
>
> **Server (Servidor):**
> - Roda na máquina da Vercel
> - Usuário não vê esse código
> - Pode acessar banco de dados, APIs privadas
> - É seguro colocar secrets aqui

```
[DESTAQUE: Lado do servidor]
```

> **Client (Navegador):**
> - Roda no computador/celular do usuário
> - Usuário pode inspecionar (DevTools)
> - Não pode acessar coisas privadas
> - NUNCA coloque secrets aqui

```
[DESTAQUE: Lado do cliente]
```

> É tipo a diferença entre a cozinha e o salão de um restaurante.
>
> - **Servidor** = cozinha (clientes não entram, receitas secretas ficam lá)
> - **Cliente** = salão (todo mundo vê, nada secreto)

---

### BLOCO 2: O PROBLEMA DO NEXT_PUBLIC_ (2 minutos)

```
[TELA: Código com e sem NEXT_PUBLIC_]
```

**NARRAÇÃO:**

> No Next.js, por padrão, env vars só funcionam no servidor.
>
> Então se você fizer:

```javascript
// No seu componente React
const apiKey = process.env.MINHA_API_KEY;
console.log(apiKey); // undefined no navegador!
```

> No servidor funciona. No cliente (navegador) dá `undefined`.
>
> **Por quê?** Segurança. O Next.js assume que suas env vars são secretas.
>
> **E se eu PRECISO da variável no cliente?**
>
> Aí você usa o prefixo mágico: `NEXT_PUBLIC_`

```javascript
// Variável com NEXT_PUBLIC_ funciona no cliente
const publicApiKey = process.env.NEXT_PUBLIC_GOOGLE_MAPS_KEY;
console.log(publicApiKey); // funciona no navegador!
```

```
[TELA: Regra visual]
```

> **A regra é simples:**
> - `MINHA_VAR` → só servidor
> - `NEXT_PUBLIC_MINHA_VAR` → servidor E cliente

---

### BLOCO 3: QUANDO USAR CADA UM (2 minutos)

```
[TELA: Tabela de decisão]
```

**NARRAÇÃO:**

> Então quando usar `NEXT_PUBLIC_`?
>
> **USE NEXT_PUBLIC_ quando:**

| Variável | NEXT_PUBLIC_? | Por quê? |
|----------|--------------|----------|
| Google Maps API Key | ✅ Sim | Precisa no JavaScript do mapa |
| Firebase Config | ✅ Sim | SDK roda no navegador |
| URL da sua API | ✅ Sim | Fetch acontece no cliente |
| ID público (Stripe Publishable) | ✅ Sim | É feito pra ser público |

> **NÃO USE NEXT_PUBLIC_ quando:**

| Variável | NEXT_PUBLIC_? | Por quê? |
|----------|--------------|----------|
| Stripe Secret Key | ❌ Não | É SECRET, duh! |
| Database URL | ❌ Não | Acesso direto ao banco |
| API privada com auth | ❌ Não | Token de autenticação |
| Senhas de qualquer tipo | ❌ Não | Óbvio |

```
[TELA: Alerta vermelho]
```

> **⚠️ CUIDADO:** Se você colocar `NEXT_PUBLIC_` numa variável secreta, ela vai aparecer no JavaScript do navegador. Qualquer pessoa pode ver. É como publicar sua senha.

---

### BLOCO 4: DEMO PRÁTICA (1.5 minutos)

```
[SCREENCAST: DevTools do navegador]
```

**NARRAÇÃO:**

> Deixa eu te provar.
>
> Vou abrir um site Next.js que usa `NEXT_PUBLIC_`:

```
[AÇÃO: Abrir DevTools → Sources]
```

> Aqui nos Sources, posso ver o JavaScript do site...

```
[AÇÃO: Buscar por NEXT_PUBLIC ou valor da variável]
```

> Olha só! O valor da variável tá aqui, literalmente. Qualquer pessoa que abrir o DevTools vê.
>
> Por isso você NUNCA coloca secrets com `NEXT_PUBLIC_`. Eles aparecem aqui pro mundo todo.
>
> Variáveis sem o prefixo não aparecem. Ficam só no servidor.

---

### FECHAMENTO (30 segundos)

```
[TELA: Resumo visual com dois caminhos]
```

**NARRAÇÃO:**

> Resumindo:
>
> **Precisa no navegador (maps, analytics, fetch)?**
> → Use `NEXT_PUBLIC_NOME_DA_VAR`
>
> **É secreto (senhas, tokens, database)?**
> → Use `NOME_DA_VAR` (sem prefixo)
>
> Na dúvida? Não usa NEXT_PUBLIC_. Começa sem e adiciona só se precisar.
>
> Próxima aula: como configurar isso na prática no Vercel!

---

## Recursos Visuais Necessários

1. Diagrama navegador ↔ servidor
2. Analogia cozinha vs salão
3. Código com/sem NEXT_PUBLIC_
4. Tabela de decisão (quando usar)
5. Alerta vermelho de segurança
6. DevTools mostrando variável exposta

---

## Pontos-Chave para Memorização

- Server = seguro, client = público
- Sem prefixo = só servidor
- NEXT_PUBLIC_ = servidor E cliente
- Secrets NUNCA com NEXT_PUBLIC_
- Na dúvida, não use NEXT_PUBLIC_
