# Aula 3.4: Troubleshooting - Env Var Não Funciona

**Módulo:** 3 - Environment Variables
**Duração:** 5 minutos
**Tipo:** Troubleshooting guide

---

## Objetivo da Aula

Ao final desta aula, o aluno vai:
- Diagnosticar problemas com env vars
- Usar checklist de debugging
- Resolver erro "undefined"

---

## Roteiro

### ABERTURA (15 segundos)

```
[TELA: Console do navegador com "undefined"]
```

**NARRAÇÃO:**

> "Mas eu configurei a variável! Por que tá undefined?!"
>
> Calma. Isso tem solução. Vamos debuggar.

---

### BLOCO 1: O CHECKLIST DE DEBUGGING (2 minutos)

```
[TELA: Checklist animado]
```

**NARRAÇÃO:**

> Quando sua env var não funciona, vai nessa ordem:
>
> **Passo 1: O nome tá EXATAMENTE igual?**

```
[TELA: Exemplo de comparação]
```

> No Vercel: `GOOGLE_MAPS_API_KEY`
> No código: `process.env.GOOGLE_MAPS_API_KEY`
>
> Tem que ser IDÊNTICO. Maiúsculas, underscores, tudo.
>
> Erro comum: espaço antes ou depois do nome no Vercel.
>
> **Passo 2: Você fez REDEPLOY?**

```
[TELA: Ícone de redeploy]
```

> Adicionou variável e não fez redeploy? Não vai funcionar.
>
> Vai lá e faz redeploy. Sério.
>
> **Passo 3: Precisa de NEXT_PUBLIC_?**

```
[TELA: Fluxo de decisão]
```

> O código tá rodando no navegador? (componente React, fetch no cliente)
>
> Se sim, a variável PRECISA começar com `NEXT_PUBLIC_`.
>
> Sem o prefixo, só funciona no servidor.
>
> **Passo 4: Tá no ambiente certo?**

```
[TELA: Checkboxes de ambiente]
```

> Você marcou "Production" mas tá testando num preview?
>
> Ou marcou só "Preview" e tá acessando o domínio de produção?
>
> Verifica se os checkboxes estão marcados pro ambiente que você tá usando.

---

### BLOCO 2: ERROS COMUNS E SOLUÇÕES (2 minutos)

```
[TELA: Tabela de erros]
```

**NARRAÇÃO:**

> Os erros mais comuns que eu vejo:
>
> **Erro 1: "undefined" no console**

| Causa | Solução |
|-------|---------|
| Falta NEXT_PUBLIC_ | Adicionar prefixo |
| Não fez redeploy | Fazer redeploy |
| Typo no nome | Verificar nome exato |

> **Erro 2: Funciona local, não funciona na Vercel**

| Causa | Solução |
|-------|---------|
| Variável só existe no .env local | Adicionar no dashboard da Vercel |
| Nome diferente no .env e no Vercel | Usar mesmo nome |

> **Erro 3: Funciona no preview, não funciona em produção**

| Causa | Solução |
|-------|---------|
| Não marcou "Production" | Editar e marcar |
| Valores diferentes | Verificar se é intencional |

> **Erro 4: Valor aparece como "undefined" literalmente**

| Causa | Solução |
|-------|---------|
| Colocou aspas no valor | Remover aspas |
| Colocou nome errado | Verificar se é o mesmo |

---

### BLOCO 3: TÉCNICA DE DEBUGGING (1 minuto)

```
[TELA: Código de debug]
```

**NARRAÇÃO:**

> Quando nada funciona, usa essa técnica:
>
> **No servidor (API Route ou getServerSideProps):**

```javascript
// pages/api/debug.js
export default function handler(req, res) {
  res.json({
    hasKey: !!process.env.MINHA_VAR,
    // NÃO exponha o valor real!
  });
}
```

> Acessa `/api/debug` e vê se retorna `true`.
>
> **No cliente:**

```javascript
// Em qualquer componente
console.log("Variáveis públicas:", {
  temGoogleMaps: !!process.env.NEXT_PUBLIC_GOOGLE_MAPS_API_KEY,
});
```

> Abre o console do navegador e verifica.
>
> **IMPORTANTE:** Depois de debuggar, REMOVE esse código! Não deixa em produção.

---

### FECHAMENTO (30 segundos)

```
[TELA: Checklist resumido]
```

**NARRAÇÃO:**

> Checklist rápido quando env var não funciona:
>
> 1. ✅ Nome idêntico? (case sensitive)
> 2. ✅ Fez redeploy?
> 3. ✅ NEXT_PUBLIC_ se precisa no cliente?
> 4. ✅ Ambiente certo? (Production/Preview)
> 5. ✅ Sem aspas no valor?
>
> 95% dos problemas são resolvidos com esse checklist.
>
> Próximo módulo: domínio customizado! Vamos sair do `.vercel.app` e ter um domínio profissional.

---

## Recursos Visuais Necessários

1. Console com "undefined"
2. Checklist animado (4 passos)
3. Comparação de nomes
4. Tabela de erros e soluções
5. Código de debug
6. Checklist resumido final

---

## Pontos-Chave para Memorização

- Checklist: nome, redeploy, NEXT_PUBLIC_, ambiente
- Case sensitive = maiúsculas importam
- Sem aspas no valor
- Debug: verificar se existe, não expor valor
