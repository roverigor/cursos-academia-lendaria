# 04.4 - UPDATE: Atualizando Registros

**M√≥dulo:** 4 - SQL Essencial com IA
**Dura√ß√£o:** 12 minutos
**Objetivo:** Modificar dados existentes sem acidentes
**Bloom Level:** Apply
**Sources:** PostgreSQL UPDATE Docs | SQL Best Practices 2025

---

## üéØ O Que Voc√™ Vai Aprender

Ao final desta aula, voc√™ vai saber como:
- ‚úÖ Atualizar um registro espec√≠fico
- ‚úÖ Atualizar m√∫ltiplas colunas
- ‚úÖ Usar WHERE pra n√£o fazer o ERRO FATAL
- ‚úÖ RETURNING pra confirmar mudan√ßa

---

## üî• GANCHO EMOCIONAL (Camada 1)

Existe um erro que todo dev junior comete UMA VEZ:

```sql
UPDATE usuarios SET salario = 10000;
```

Pensando: "Vou aumentar o sal√°rio do Jo√£o"

Realidade: **AUMENTOU O SAL√ÅRIO DE TODOS**

10.000 funcion√°rios recebendo aumento ao mesmo tempo.

CEO chamando perguntando por que a folha de pagamento triplicou.

---

**A diferen√ßa?**

```sql
-- ‚ùå NUNCA FA√áA ISSO (afeta TODOS)
UPDATE usuarios SET salario = 10000;

-- ‚úÖ FA√áA ASSIM (afeta APENAS um)
UPDATE usuarios SET salario = 10000 WHERE id = 5;
```

Um WHERE.

√â tudo que separa voc√™ de destruir o banco.

---

## üè† MET√ÅFORA VISUAL (Camada 2)

Imagina voc√™ mudando **endere√ßo de entrega em um e-commerce**.

‚ùå **Ruim:** "Muda o endere√ßo de TODOS para Rua A"
- 10 MILH√ïES de clientes ganham seu endere√ßo
- Caos total

‚úÖ **Bom:** "Muda o endere√ßo de MINHA CONTA (ID 1234) para Rua A"
- S√≥ voc√™ t√° com endere√ßo novo
- Tranquilo

---

UPDATE sem WHERE = DESASTRE

UPDATE com WHERE = Seguro

---

## üí° FUNDAMENTO CONCEITUAL (Camada 3)

Deixa eu te mostrar UPDATE...

### Forma B√°sica

```sql
UPDATE usuarios
SET nome = 'Jo√£o Silva'
WHERE id = 1;
```

**O que significa:**
- UPDATE usuarios = Modifique tabela usuarios
- SET nome = 'Jo√£o Silva' = coloque nome = 'Jo√£o Silva'
- WHERE id = 1 = MAS APENAS onde id √© 1

---

**‚ö†Ô∏è REGRA DE OURO:**

```sql
SEMPRE use WHERE quando fazer UPDATE
```

Sem exce√ß√£o.

---

### Atualizando M√∫ltiplas Colunas

```sql
UPDATE usuarios
SET
  nome = 'Jo√£o Silva',
  email = 'joao.silva@mail.com',
  telefone = '11999999999'
WHERE id = 1;
```

---

### Atualizando com RETURNING

```sql
UPDATE usuarios
SET salario = 10000
WHERE id = 5
RETURNING id, nome, salario;
```

**Resposta:**
```
id | nome  | salario
---|-------|--------
5  | Jo√£o  | 10000
```

**Por que?**
- ‚úÖ Confirma que dados foi atualizado
- ‚úÖ V√™ o novo valor
- ‚úÖ Seguran√ßa: voc√™ TEM PROVA do que mudou

---

### Atualizando M√∫ltiplos com Condi√ß√£o

```sql
UPDATE pedidos
SET status = 'Entregue'
WHERE data_entrega <= CURRENT_DATE
  AND status = 'Em Tr√¢nsito';
```

**O que significa:**
- Atualize status para 'Entregue'
- MAS APENAS pedidos que:
  - Tem data_entrega menor ou igual a hoje
  - E status √© 'Em Tr√¢nsito'

---

### Incrementar Valores (Sem SELECT)

```sql
-- Aumentar saldo em 100
UPDATE contas
SET saldo = saldo + 100
WHERE id = 1;
```

**Como funciona:**
- saldo = saldo + 100
- Pega valor atual de saldo
- Soma 100
- Guarda de volta

---

## ‚ö° APLICA√á√ÉO PR√ÅTICA (Camada 4)

Agora voc√™ vai **ATUALIZAR dados reais**...

### Scenario 1: Cliente Mudou Email

```sql
UPDATE clientes
SET email = 'novo_email@mail.com'
WHERE id = 1
RETURNING id, nome, email;
```

---

### Scenario 2: Pedido Foi Entregue

```sql
UPDATE pedidos
SET
  status = 'Entregue',
  data_entrega = CURRENT_DATE
WHERE id = 123
RETURNING id, status, data_entrega;
```

---

### Scenario 3: Desconto em Produtos Caro

```sql
UPDATE produtos
SET preco = preco * 0.9  -- 10% de desconto
WHERE preco > 1000
RETURNING id, nome, preco;
```

**O que significa:**
- Decrease pre√ßo em 10% (multiplica por 0.9)
- MAS APENAS produtos que custam mais de 1000
- Mostra o novo pre√ßo

---

## üåü EXPANS√ÉO FILOS√ìFICA (Camada 5)

Sabe qual √© a REGRA #1 de UPDATE?

**SEMPRE fa√ßa SELECT ANTES para confirmar qual linha vai mexer**

Processo:

```sql
-- Passo 1: VER QUAL REGISTRO (SELECT)
SELECT id, nome, email FROM usuarios WHERE id = 1;
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ id ‚îÇ nome ‚îÇ     email        ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ 1  ‚îÇ Jo√£o‚îÇ joao@mail.com    ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò

-- Passo 2: MODIFICAR (UPDATE)
UPDATE usuarios SET email = 'novo@mail.com' WHERE id = 1;

-- Passo 3: CONFIRMAR (SELECT novamente ou ver RETURNING)
SELECT id, nome, email FROM usuarios WHERE id = 1;
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ id ‚îÇ nome ‚îÇ     email        ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ 1  ‚îÇ Jo√£o‚îÇ novo@mail.com    ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

E aqui t√° a verdade que ningu√©m conta:

**Banco permite UNDO com transa√ß√µes:**

```sql
BEGIN;  -- Come√ßa transa√ß√£o
  UPDATE usuarios SET email = 'novo@mail.com' WHERE id = 1;
ROLLBACK;  -- Desfaz tudo
```

Mas voc√™ n√£o pode confiar nisso.

Sempre use:
1. SELECT para ver ANTES
2. UPDATE com WHERE
3. RETURNING para confirmar

---

## ‚úÖ RECAPITULA√á√ÉO (Valida√ß√£o do Aprendizado)

Antes de continuar:

**1. Por que SEMPRE usar WHERE?**
Resposta: Sem WHERE, atualiza TODOS os registros.

**2. Como confirmar que UPDATE funcionou?**
Resposta: Usar RETURNING ou fazer SELECT depois.

**3. Qual √© o padr√£o: SELECT ‚Üí UPDATE ‚Üí SELECT?**
Resposta: Sim! Ver antes, modificar, confirmar depois.

**4. Como aumentar um valor em 10%?**
Resposta: SET coluna = coluna * 1.10

**5. Voc√™ pode modificar m√∫ltiplas colunas?**
Resposta: Sim, com v√≠rgula entre cada uma.

---

## üìù EXERC√çCIO (10 minutos)

**Sua tarefa:**

1. Atualize seu pr√≥prio email (id = seu ID)
2. Atualize status de um pedido espec√≠fico
3. Aplique 20% desconto em produtos caros (>500)
4. Use RETURNING pra confirmar tudo

---

## üéØ PR√ìXIMO PASSO

Na pr√≥xima aula (04.5), vamos:
- ‚úÖ DELETE: Remover dados
- ‚úÖ O CUIDADO extremo que voc√™ precisa ter
- ‚úÖ Soft Delete vs Hard Delete

Bora? üöÄ

---

*Aula criada por Jos√© Amorim (Professor Socr√°tico)*
*Framework: Espiral Expansiva + Anti-Impostor Design*
*Dura√ß√£o estimada: 12 minutos*
*Fonte: PostgreSQL UPDATE Docs | SQL Best Practices 2025*
