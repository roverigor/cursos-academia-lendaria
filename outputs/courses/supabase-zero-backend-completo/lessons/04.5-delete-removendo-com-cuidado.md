# 04.5 - DELETE: Removendo com Cuidado

**M√≥dulo:** 4 - SQL Essencial com IA
**Dura√ß√£o:** 10 minutos
**Objetivo:** Deletar dados de forma SEGURA
**Bloom Level:** Apply
**Sources:** PostgreSQL DELETE Docs | Database Best Practices

---

## üéØ O Que Voc√™ Vai Aprender

Ao final desta aula, voc√™ vai saber como:
- ‚úÖ Deletar um registro espec√≠fico
- ‚úÖ O CUIDADO extremo que precisa ter
- ‚úÖ Soft Delete vs Hard Delete
- ‚úÖ Por que backup √© essencial

---

## üî• GANCHO EMOCIONAL (Camada 1)

DELETE √© a opera√ß√£o mais perigosa do SQL.

Uma query errada e voc√™ perde TUDO.

Sem volta.
Sem undo.
Sem pedir desculpa.

---

Eu j√° vi:
- Dev deletar tabela inteira sem WHERE
- Perder 6 meses de dados
- Empresa inteira em p√¢nico
- Backup n√£o existia

---

Essa aula voc√™ vai aprender a **NUNCA fazer esse erro**.

---

## üè† MET√ÅFORA VISUAL (Camada 2)

DELETE √© como **QUEIMAR UM DOCUMENTO**.

Depois de queimado, n√£o volta mais.

Ent√£o voc√™ TEM que:

1. ‚úÖ Confirmar qual documento (WHERE)
2. ‚úÖ Ter c√≥pia antes (BACKUP)
3. ‚úÖ Fazer com calma (n√£o √© correria)
4. ‚úÖ Depois confirmar que foi (SELECT pra verificar)

---

## üí° FUNDAMENTO CONCEITUAL (Camada 3)

Deixa eu te mostrar DELETE...

### Forma B√°sica

```sql
DELETE FROM usuarios
WHERE id = 1;
```

**O que significa:**
- DELETE FROM usuarios = Delete da tabela usuarios
- WHERE id = 1 = MAS APENAS onde id √© 1

---

**‚ö†Ô∏è NUNCA FA√áA ISSO:**

```sql
-- ‚ùå APOCALIPSE! Deleta TODOS
DELETE FROM usuarios;

-- ‚úÖ SEGURO! Deleta apenas 1
DELETE FROM usuarios WHERE id = 1;
```

---

### Deletando M√∫ltiplos com Condi√ß√£o

```sql
DELETE FROM pedidos
WHERE status = 'Cancelado'
  AND data_cancelamento < '2024-01-01';
```

**O que significa:**
- Delete pedidos que:
  - T√° cancelado
  - E cancelamento foi antes de 2024

---

### RETURNING (Confirmar o Que Foi Deletado)

```sql
DELETE FROM usuarios
WHERE id = 1
RETURNING id, nome, email;
```

**Resposta:**
```
id | nome | email
---|------|------------------
1  | Jo√£o | joao@mail.com
```

**Por que?**
- ‚úÖ Prova que deletou o certo
- ‚úÖ Voc√™ V√ä o que foi perdido
- ‚úÖ Seguran√ßa emocional

---

## ‚ö° APLICA√á√ÉO PR√ÅTICA (Camada 4)

**A Maneira CERTA de Deletar:**

### Passo 1: VER QUAL REGISTRO

```sql
SELECT id, nome, status FROM usuarios WHERE id = 1;
```

Se n√£o retornar nada ‚Üí PARA! Voc√™ t√° deletando a pessoa errada.

---

### Passo 2: DELETAR COM RETURNING

```sql
DELETE FROM usuarios
WHERE id = 1
RETURNING id, nome, email;
```

---

### Passo 3: VERIFICAR QUE FOI DELETADO

```sql
SELECT COUNT(*) FROM usuarios WHERE id = 1;
-- Retorna 0 ‚Üí Confirmado, foi deletado
```

---

## üåü EXPANS√ÉO FILOS√ìFICA (Camada 5)

Existem 2 tipos de delete:

### Tipo 1: HARD DELETE (Verdadeiro)

```sql
DELETE FROM usuarios WHERE id = 1;
-- Registro DESAPARECE DO BANCO
```

**Usado quando:**
- Dados n√£o tem valor hist√≥rico
- GDPR (direito ao esquecimento)
- Garantir seguran√ßa

**Problema:**
- N√£o volta mais
- Sem hist√≥rico

---

### Tipo 2: SOFT DELETE (Falso)

```sql
-- Ao inv√©s de deletar...
DELETE FROM usuarios WHERE id = 1;

-- Voc√™ apenas marca como deletado:
UPDATE usuarios
SET deletado_em = CURRENT_TIMESTAMP
WHERE id = 1;

-- Depois quando quer ver:
SELECT * FROM usuarios WHERE deletado_em IS NULL;
-- Mostra s√≥ os n√£o-deletados
```

**Usado quando:**
- Dados tem valor hist√≥rico
- Precisa poder "undelete"
- Auditoria completa

**Vantagem:**
- ‚úÖ Nunca perde dados
- ‚úÖ Consegue recuperar
- ‚úÖ Hist√≥rico intacto

---

**Recomenda√ß√£o:**

Comece com **SOFT DELETE** para dados importantes (usuarios, pedidos, faturas).

Use **HARD DELETE** s√≥ pra lixo (logs tempor√°rios, caches).

---

## ‚úÖ RECAPITULA√á√ÉO (Valida√ß√£o do Aprendizado)

Antes de continuar:

**1. Qual √© o erro fatal de DELETE?**
Resposta: N√£o usar WHERE (deleta TODOS).

**2. Qual √© o processo seguro?**
Resposta: SELECT antes ‚Üí DELETE com WHERE e RETURNING ‚Üí SELECT pra confirmar.

**3. Diferen√ßa entre Hard e Soft Delete?**
Resposta: Hard = remove do banco | Soft = marca como deletado (ainda l√°).

**4. Quando usar Soft Delete?**
Resposta: Dados importantes (usuarios, pedidos).

**5. Quando usar Hard Delete?**
Resposta: Dados tempor√°rios (logs, cache).

---

## üìù EXERC√çCIO (5 minutos)

**Sua tarefa:**

1. Implementar Soft Delete em sua tabela (add coluna deletado_em)
2. "Deletar" um registro (marcar como deletado)
3. Verificar que registro t√° l√° mas invis√≠vel

---

## üéØ PR√ìXIMO PASSO

Na pr√≥xima aula (04.6), vamos:
- ‚úÖ ChatGPT/Claude: Gerar SQL automaticamente
- ‚úÖ Como escrever prompts que funcionam
- ‚úÖ Quando confiar em IA vs quando revisar

Bora? üöÄ

---

*Aula criada por Jos√© Amorim (Professor Socr√°tico)*
*Framework: Espiral Expansiva + Anti-Impostor Design*
*Dura√ß√£o estimada: 10 minutos*
*Fonte: PostgreSQL DELETE Docs | Database Best Practices*
