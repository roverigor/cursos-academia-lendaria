# Aula 2.8: Testes A/B AutomÃ¡ticos

**MÃ³dulo:** 2 - AI Sales Machine
**NÃ­vel:** 2 (FuncionÃ¡rio Aprendendo)
**DuraÃ§Ã£o:** 15 minutos

---

## ðŸŽ¯ Objetivos

1. Configurar testes A/B automatizados em sequÃªncias
2. Testar subject lines, copy, timing, canais
3. Determinar winner automaticamente (statistical significance)
4. Escalar winner para 100% do trÃ¡fego
5. Aumentar conversion rate continuamente

---

## ðŸ“Š O Que Testar

### Testes CrÃ­ticos (Maior Impacto)

**1. Email Subject Line** (â†‘ Open Rate 20-50%)
```
A: {{ company }} aumentar vendas em 800%?
B: {{ first_name }}, veja como {{ similar_company }} cresceu 800%
```

**2. Email Body** (â†‘ Reply Rate 10-30%)
```
A: Formato curto (5 linhas)
B: Formato mÃ©dio (10 linhas + case study)
```

**3. CTA (Call-to-Action)** (â†‘ Click Rate 15-40%)
```
A: "Agende 15 min aqui: [Calendly]"
B: "Quer ver demo? Responda este email"
C: "Clique para ver case completo: [Link]"
```

**4. Timing** (â†‘ Response Rate 10-20%)
```
A: Send at 9 AM
B: Send at 2 PM
```

**5. Personalization Level**
```
A: Low personalization (sÃ³ nome)
B: High personalization (nome + empresa + recent activity)
```

---

## ðŸ”¬ Metodologia A/B Testing

### Setup BÃ¡sico

```javascript
const abTest = {
  name: 'Subject Line Test #1',
  metric: 'open_rate',
  variants: [
    { id: 'A', subject: '{{ company }} aumentar vendas em 800%?', traffic: 50 },
    { id: 'B', subject: '{{ first_name }}, pergunta rÃ¡pida sobre {{ company }}', traffic: 50 }
  ],
  sampleSize: 200, // 100 leads per variant
  confidenceLevel: 0.95, // 95%
  duration: 7 // days
};
```

### n8n: RandomizaÃ§Ã£o

```json
{
  "name": "Assign A/B Variant",
  "type": "n8n-nodes-base.function",
  "parameters": {
    "functionCode": "const lead = $input.first().json;\n\n// Random 50/50 split\nconst variant = Math.random() < 0.5 ? 'A' : 'B';\n\nreturn {\n  json: {\n    ...lead,\n    ab_variant: variant,\n    ab_test_id: 'subject_line_test_1'\n  }\n};"
  }
}
```

### Tracking Results

```sql
CREATE TABLE ab_test_results (
    id SERIAL PRIMARY KEY,
    test_id VARCHAR(100),
    variant VARCHAR(10),
    lead_email VARCHAR(255),

    -- Metrics
    sent BOOLEAN DEFAULT FALSE,
    opened BOOLEAN DEFAULT FALSE,
    clicked BOOLEAN DEFAULT FALSE,
    replied BOOLEAN DEFAULT FALSE,
    meeting_booked BOOLEAN DEFAULT FALSE,

    -- Timestamps
    sent_at TIMESTAMP,
    opened_at TIMESTAMP,
    clicked_at TIMESTAMP,
    replied_at TIMESTAMP,

    created_at TIMESTAMP DEFAULT NOW()
);
```

### Calculate Winner

```javascript
// After test ends (200 leads sent)
const results = await db.query(`
    SELECT
        variant,
        COUNT(*) as sent,
        SUM(CASE WHEN opened THEN 1 ELSE 0 END) as opens,
        SUM(CASE WHEN replied THEN 1 ELSE 0 END) as replies
    FROM ab_test_results
    WHERE test_id = 'subject_line_test_1'
    GROUP BY variant
`);

const variantA = results.find(r => r.variant === 'A');
const variantB = results.find(r => r.variant === 'B');

// Open rates
const openRateA = variantA.opens / variantA.sent;
const openRateB = variantB.opens / variantB.sent;

// Chi-square test for statistical significance
const chiSquare = calculateChiSquare(variantA, variantB);
const pValue = chiSquareToPValue(chiSquare);

if (pValue < 0.05) {
    // Statistically significant difference
    const winner = openRateA > openRateB ? 'A' : 'B';
    console.log(`Winner: Variant ${winner} (p=${pValue})`);

    // Deploy winner to 100%
    await deployWinner(winner);
} else {
    console.log('No statistical significance. Continue testing.');
}
```

---

## ðŸš€ Auto-Deploy Winner

### n8n: Deploy Vencedor

```javascript
async function deployWinner(variant) {
    // Update sequence template
    await db.query(`
        UPDATE email_templates
        SET
            subject = (
                SELECT subject FROM ab_test_variants
                WHERE test_id = 'subject_line_test_1' AND variant = $1
            ),
            deployed_at = NOW(),
            ab_test_winner = $1
        WHERE template_id = 'email_1_intro'
    `, [variant]);

    // Log deployment
    console.log(`âœ… Variant ${variant} deployed to production`);

    // Notify team
    await slack.send({
        channel: '#sales-automation',
        message: `ðŸŽ‰ A/B Test Winner: Variant ${variant}\nOpen Rate: ${openRate}% (${lift}% lift)\nDeployed to 100% traffic.`
    });
}
```

---

## ðŸ“Š Multi-Variate Testing (AvanÃ§ado)

### Testar MÃºltiplos Elementos

```javascript
const multiVariateTest = {
  factors: {
    subject: ['Short', 'Long'],
    body: ['Casual', 'Formal'],
    cta: ['Calendly', 'Reply', 'Link']
  },
  combinations: 2 * 2 * 3 = 12 variants
};

// Exemplo de combinaÃ§Ãµes:
// A1: Short subject + Casual body + Calendly CTA
// A2: Short subject + Casual body + Reply CTA
// A3: Short subject + Casual body + Link CTA
// B1: Short subject + Formal body + Calendly CTA
// ... (12 total)
```

**Problema:** 12 variants = precisa 1.200 leads (100 per variant)

**SoluÃ§Ã£o:** Testar sequencialmente
1. Testar subject (A vs B)
2. Winner â†’ Testar body (Casual vs Formal)
3. Winner â†’ Testar CTA (Calendly vs Reply vs Link)

---

## ðŸŽ¯ Continuous Optimization

### Processo Semanal

```
Week 1: Test subject lines â†’ Deploy winner
Week 2: Test email body â†’ Deploy winner
Week 3: Test CTA â†’ Deploy winner
Week 4: Test send time â†’ Deploy winner
Week 5: Test personalization level â†’ Deploy winner
... repeat
```

### Auto-Generate Variants (GPT-4)

```
Prompt:
Generate 5 email subject line variants for B2B SaaS cold outreach.

Context:
- Target: CEOs of 50-200 person companies
- Pain point: Low lead generation
- Solution: AI Sales Machine (generates 1,500 leads/month)
- Tone: Casual, Brazilian Portuguese
- Length: Max 60 characters

Output 5 variants in JSON:
[
  "{{ company }} aumentar vendas em 800%?",
  "{{ first_name }}, pergunta sobre {{ company }}",
  ...
]
```

---

## âœ… EntregÃ¡vel

```
ab-testing/
â”œâ”€â”€ test-configurations/
â”‚   â”œâ”€â”€ subject-line-tests.json
â”‚   â”œâ”€â”€ body-copy-tests.json
â”‚   â””â”€â”€ timing-tests.json
â”œâ”€â”€ statistical-analysis.js
â””â”€â”€ auto-deploy-winner.js
```

---

## ðŸŽ¯ Checklist

- [ ] A/B test framework implementado (random split)
- [ ] Tracking de metrics (open, click, reply)
- [ ] Statistical significance calculator
- [ ] Auto-deploy winner quando p < 0.05
- [ ] Primeiro teste rodando (subject line)
- [ ] Processo semanal de continuous optimization

---

**ðŸŽ“ Conceito-chave:** Teste TUDO. Cada 1% de melhoria em open rate = +15 leads qualificados/mÃªs.
