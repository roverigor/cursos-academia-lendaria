# Lesson 4.2: Top_P e Top_K - Filtros de Vocabul√°rio

**M√≥dulo:** 4 - OS BOT√ïES SECRETOS DA IA
**Dura√ß√£o:** 15 minutos
**Tipo:** Conceptual + Pr√°tica
**N√≠vel:** Fundamento 1 - Intermedi√°rio

---

## üéØ O QUE VOC√ä VAI DOMINAR

Sabe o que √© louco?

Na Lesson 4.1 voc√™ aprendeu **Temperature** (controle de determinismo).

**Agora voc√™ vai aprender os 2 par√¢metros que 95% dos usu√°rios de IA NEM SABEM QUE EXISTEM.**

**Top_P e Top_K.**

---

Voc√™ j√° teve essa experi√™ncia?

**Teste 1:** Temperature 0.7
```
IA: "O prazo de entrega √© de 7 dias √∫teis."
```

**Teste 2:** MESMA temperature 0.7, mas Top_K = 80
```
IA: "A gente entrega em uma semaninha √∫til."
```

**MESMA TEMPERATURE. VOCABUL√ÅRIO COMPLETAMENTE DIFERENTE.**

---

E a√≠ que t√°...

**Temperature diz:** "Quanto voc√™ varia?"
**Top_P/Top_K dizem:** "QUAIS palavras voc√™ pode usar?"

---

## üî• PROBLEMA REAL DO CLIENTE

> **Bruno (ag√™ncia de atendimento corporativo B2B):**
>
> "Jos√©, constru√≠mos agente de atendimento pra cliente MUITO formal (banco tradicional).
>
> **Requisito do cliente:** Tom profissional, institucional, zero informalidade.
>
> **O que t√° acontecendo:**
> - Cliente pergunta sobre taxa: IA responde 'A taxa √© 2,5% ao m√™s.'  ‚úÖ OK
> - Outro cliente: IA responde 'A gente cobra 2,5% ao m√™s.' ‚ùå "A gente"?!
> - Outro: 'Fica 2,5% ao m√™s no seu bolso.' ‚ùå "Seu bolso"?!?!
>
> **Banco surtou:**
> - 'Por que usa "a gente" em vez de "n√≥s"?'
> - 'Por que fala "bolso" (informal)?'
> - 'Isso n√£o passa na compliance!'
>
> **Tentei:**
> - Mudei prompt: 'Use linguagem formal.' ‚Üí N√ÉO funcionou
> - Mudei temperature pra 0.0 ‚Üí Resposta SEMPRE igual, MAS ainda usa "a gente" √†s vezes
>
> **Como fa√ßo IA usar S√ì vocabul√°rio formal?**"

---

## üí° A MET√ÅFORA QUE EXPLICA TUDO

Vem comigo...

---

### Imagina um restaurante com 1.000 pratos no card√°pio.

Cliente pede: "Quero algo com frango."

**Chef (IA) tem 1.000 op√ß√µes de pratos com frango.**

---

**Sem Top_K/Top_P:**
```
Chef escolhe QUALQUER PRATO DOS 1.000
- Frango grelhado ‚úÖ
- Nuggets de frango ‚úÖ
- Frango √† passarinho ‚úÖ
- Franguinho no palitinho ‚úÖ (informal!)
- Frang√£o na brasa ‚úÖ (g√≠ria!)
```

---

**Com Top_K = 20:**
```
Chef BLOQUEIA 980 pratos
Pode escolher apenas os 20 MAIS POPULARES

- Frango grelhado ‚úÖ
- Frango assado ‚úÖ
- Peito de frango ‚úÖ
- [mais 17 pratos formais]
- ‚ùå "Franguinho no palitinho" (n√£o t√° no top 20)
- ‚ùå "Frang√£o na brasa" (bloqueado)
```

**Resultado:** Chef sempre escolhe prato FORMAL (topo do ranking).

---

**Com Top_K = 100:**
```
Chef tem 100 op√ß√µes

- Frango grelhado ‚úÖ
- Frango √† passarinho ‚úÖ
- Franguinho frito ‚úÖ (mais informal)
- Frango xadrez ‚úÖ
- [96 outras op√ß√µes]
```

**Resultado:** Mais varia√ß√£o, algumas informais aparecem.

---

**E a√≠ que t√°:**

**Top_K = Quantas palavras/frases a IA pode escolher**
- Top_K baixo (10-20) = Vocabul√°rio RESTRITO (formal, previs√≠vel)
- Top_K alto (80-100) = Vocabul√°rio AMPLO (criativo, informal)

---

## üß† DIFEREN√áA: Top_K vs Top_P

### Top_K (Top-K Sampling)

**"Escolha entre as K palavras MAIS PROV√ÅVEIS"**

Exemplo: Top_K = 3

```
IA precisa escolher pr√≥xima palavra:

Probabilidades:
1. "entrega" ‚Üí 45%
2. "envio" ‚Üí 30%
3. "despacho" ‚Üí 15%
4. "postagem" ‚Üí 5%
5. "mandado" ‚Üí 3%
6. "enviadinha" ‚Üí 2%

Com Top_K = 3:
- Considera apenas op√ß√µes 1, 2, 3 ‚úÖ
- Ignora op√ß√µes 4, 5, 6 ‚ùå

Escolhe entre: "entrega", "envio", "despacho"
```

**Uso:** Limitar QUANTIDADE de op√ß√µes.

---

### Top_P (Nucleus Sampling)

**"Escolha entre palavras que somam at√© P% de probabilidade"**

Exemplo: Top_P = 0.8 (80%)

```
Probabilidades:
1. "entrega" ‚Üí 45%
2. "envio" ‚Üí 30%
3. "despacho" ‚Üí 15%  [SOMA = 90%, ultrapassou 80%]
4. "postagem" ‚Üí 5%
5. "mandado" ‚Üí 3%

Com Top_P = 0.8:
- Soma probabilidades: 45% + 30% = 75% (ainda <80%, continua)
- Soma mais: 75% + 15% = 90% (ultrapassou 80%, PARA)
- Considera op√ß√µes 1, 2, 3 ‚úÖ
- Ignora op√ß√µes 4, 5 ‚ùå

Escolhe entre: "entrega", "envio", "despacho"
```

**Uso:** Limitar PROBABILIDADE acumulada.

---

**Qual a diferen√ßa pr√°tica?**

**Top_K = N√∫mero fixo**
- Top_K = 5 ‚Üí SEMPRE 5 palavras candidatas
- Simples de entender

**Top_P = Probabilidade acumulada**
- Top_P = 0.9 ‚Üí N√∫mero VARIA (√†s vezes 3, √†s vezes 10)
- Mais adaptativo
- Mais usado em produ√ß√£o

---

## üìä TABELA COMPARATIVA

| Par√¢metro | O que controla | Valor baixo | Valor alto | Uso t√≠pico |
|-----------|----------------|-------------|------------|------------|
| **Temperature** | Quanto varia | 0.0 (sempre igual) | 2.0 (muito diferente) | Determinismo |
| **Top_K** | Quantas palavras | 10 (vocabul√°rio restrito) | 100 (vocabul√°rio amplo) | Formalidade |
| **Top_P** | Probabilidade acumulada | 0.5 (conservador) | 0.95 (criativo) | Diversidade |

---

## üß™ EXPERIMENTO PR√ÅTICO

### TESTE: Mesmo Prompt, Temperature IGUAL, Top_K DIFERENTE

**Prompt (id√™ntico):**
```markdown
Voc√™ √© assistente de atendimento.

Cliente perguntou: "Qual o prazo de entrega?"

Responda de forma profissional.
```

**Configura√ß√£o base:**
```javascript
{
  "temperature": 0.7, // FIXO em todos testes
  "prompt": "[prompt acima]"
}
```

---

### TESTE 1: Top_K = 10 (Vocabul√°rio RESTRITO - Formal)

**Configura√ß√£o:**
```javascript
{
  "temperature": 0.7,
  "top_k": 10 // ‚Üê S√ì as 10 palavras mais formais
}
```

**10 Execu√ß√µes:**

```
Resposta 1: "O prazo de entrega √© de 7 dias √∫teis."
Resposta 2: "O prazo de entrega √© de 7 dias √∫teis."
Resposta 3: "O per√≠odo de entrega √© de 7 dias √∫teis."
Resposta 4: "O prazo de entrega √© de 7 dias √∫teis."
Resposta 5: "O prazo para entrega √© de 7 dias √∫teis."
[sempre vocabul√°rio FORMAL: "prazo", "per√≠odo", "entrega"]
```

**An√°lise:**
- ‚úÖ Vocabul√°rio FORMAL consistente
- ‚úÖ Usa "prazo", "per√≠odo", "entrega" (palavras top)
- ‚ùå Repetitivo (pouca varia√ß√£o)
- ‚úÖ Compliance-friendly

**Quando usar:** B2B corporativo, jur√≠dico, financeiro, sa√∫de

---

### TESTE 2: Top_K = 50 (Vocabul√°rio MODERADO - Profissional Acess√≠vel)

**Configura√ß√£o:**
```javascript
{
  "temperature": 0.7,
  "top_k": 50
}
```

**10 Execu√ß√µes:**

```
Resposta 1: "O prazo de entrega √© de 7 dias √∫teis."
Resposta 2: "A entrega leva 7 dias √∫teis."
Resposta 3: "Normalmente entregamos em 7 dias √∫teis."
Resposta 4: "O produto chega em 7 dias √∫teis."
Resposta 5: "O tempo de entrega √© de 7 dias √∫teis."
[vocabul√°rio MISTO: "prazo", "entrega", "chega", "normalmente"]
```

**An√°lise:**
- ‚úÖ Varia√ß√£o natural
- ‚úÖ Ainda profissional
- ‚úÖ Vocabul√°rio acess√≠vel ("chega", "normalmente")
- ‚ö†Ô∏è Leve informalidade (aceit√°vel na maioria dos casos)

**Quando usar:** Atendimento geral, e-commerce, SAC

---

### TESTE 3: Top_K = 100 (Vocabul√°rio AMPLO - Casual)

**Configura√ß√£o:**
```javascript
{
  "temperature": 0.7,
  "top_k": 100
}
```

**10 Execu√ß√µes:**

```
Resposta 1: "A gente entrega em 7 dias √∫teis."
Resposta 2: "Fica uns 7 dias √∫teis pra chegar."
Resposta 3: "Demora 7 dias √∫teis pra voc√™ receber."
Resposta 4: "Normalmente leva uma semaninha √∫til."
Resposta 5: "O prazo √© de 7 dias √∫teis."
[vocabul√°rio VARIADO: "a gente", "fica", "demora", "semaninha"]
```

**An√°lise:**
- ‚úÖ Natural e conversacional
- ‚úÖ Parece humano casual
- ‚ö†Ô∏è Usa "a gente", "semaninha" (informal)
- ‚ùå N√ÉO apropriado pra contexto formal

**Quando usar:** Startup descolada, redes sociais, atendimento jovem

---

## üéØ CASO PR√ÅTICO: RESOLVENDO O PROBLEMA DO BRUNO

**Problema:** Banco quer tom FORMAL, mas IA usa "a gente", "bolso", "semaninha".

**Diagn√≥stico:**

```javascript
// ANTES (configura√ß√£o padr√£o)
{
  "temperature": 0.7,
  "top_k": 40, // ‚ùå Padr√£o - permite vocabul√°rio informal
  "top_p": 0.9  // ‚ùå Padr√£o - muita diversidade
}
```

**Resultado:** IA escolhe entre 40 palavras, incluindo informais.

---

**Solu√ß√£o:**

```javascript
// DEPOIS (configura√ß√£o formal)
{
  "temperature": 0.3, // ‚Üê Reduz varia√ß√£o
  "top_k": 15,        // ‚Üê S√ì vocabul√°rio FORMAL
  "top_p": 0.7        // ‚Üê Reduz diversidade
}
```

**Prompt tamb√©m ajustado:**

```markdown
Voc√™ √© assistente institucional do [Banco].

**Tom obrigat√≥rio:**
- Use "n√≥s" (NUNCA "a gente")
- Use "cliente" (NUNCA "voc√™")
- Use vocabul√°rio banc√°rio formal (taxa, prazo, conta)
- Evite: g√≠rias, diminutivos, informalidades

Cliente perguntou: [pergunta]

Responda com tom institucional.
```

---

**Resultado ANTES vs DEPOIS:**

**ANTES (Top_K = 40):**
```
"A gente cobra 2,5% ao m√™s. Fica no seu bolso esse valor."
```
‚ùå Informal, compliance reprovou

**DEPOIS (Top_K = 15):**
```
"A taxa aplicada √© de 2,5% ao m√™s. O valor ser√° debitado da conta do cliente."
```
‚úÖ Formal, compliance aprovou

---

**Bruno relatou:**
> "Mudamos Top_K de 40 pra 15 + Top_P de 0.9 pra 0.7. Agente passou em 3 auditorias. Banco aprovou pra produ√ß√£o. 12.000 atendimentos/m√™s rodando."

---

## üîß RECEITAS: CONFIGURA√á√ïES POR CASO DE USO

### Receita 1: Agente FORMAL (Jur√≠dico, Financeiro, Sa√∫de)

```javascript
{
  "temperature": 0.2,  // Pouca varia√ß√£o
  "top_k": 15,         // Vocabul√°rio restrito
  "top_p": 0.7         // Baixa diversidade
}
```

**Resultado esperado:**
- Sempre vocabul√°rio top (palavras formais)
- Respostas consistentes
- Zero g√≠rias/informalidades

**Exemplo:**
```
"O prazo legal para contesta√ß√£o √© de 30 dias √∫teis contados da notifica√ß√£o."
```

---

### Receita 2: Agente PROFISSIONAL ACESS√çVEL (SAC, E-commerce)

```javascript
{
  "temperature": 0.7,  // Varia√ß√£o natural
  "top_k": 50,         // Vocabul√°rio moderado
  "top_p": 0.9         // Diversidade controlada
}
```

**Resultado esperado:**
- Tom profissional mas amig√°vel
- Varia√ß√£o natural
- Leve informalidade OK

**Exemplo:**
```
"Normalmente a entrega leva 7 dias √∫teis. Voc√™ recebe notifica√ß√£o quando despachar!"
```

---

### Receita 3: Agente CASUAL (Startup, Redes Sociais)

```javascript
{
  "temperature": 0.9,  // Alta varia√ß√£o
  "top_k": 80,         // Vocabul√°rio amplo
  "top_p": 0.95        // M√°xima diversidade
}
```

**Resultado esperado:**
- Conversacional
- Natural e humano
- Informalidade aceit√°vel

**Exemplo:**
```
"A gente entrega em uma semaninha! Qualquer coisa, s√≥ chamar. üòä"
```

---

### Receita 4: Agente CRIATIVO (Marketing, Copywriting)

```javascript
{
  "temperature": 1.0,  // Muita varia√ß√£o
  "top_k": 100,        // Vocabul√°rio criativo
  "top_p": 0.98        // M√°xima criatividade
}
```

**Resultado esperado:**
- √önico e original
- Palavras incomuns OK
- Criatividade valorizada

**Exemplo:**
```
"Prepare-se para receber seu pedido em 7 dias e descobrir por que nossos clientes ficam apaixonados! ‚ú®"
```

---

## üìä MATRIZ DE DECIS√ÉO

| Contexto | Temperature | Top_K | Top_P | Exemplo |
|----------|-------------|-------|-------|---------|
| **Compliance cr√≠tico** | 0.1 | 10 | 0.6 | "O prazo legal √©..." |
| **Corporativo B2B** | 0.3 | 15 | 0.7 | "Informamos que..." |
| **Atendimento geral** | 0.7 | 50 | 0.9 | "Claro! Posso ajudar..." |
| **E-commerce casual** | 0.8 | 70 | 0.92 | "A gente entrega..." |
| **Redes sociais** | 0.9 | 80 | 0.95 | "Opa! Demorou..." |
| **Copy criativo** | 1.0 | 100 | 0.98 | "Descubra o segredo..." |

---

## üß© EXPANS√ÉO FILOS√ìFICA

E talvez ‚Äî s√≥ talvez ‚Äî voc√™ percebeu uma coisa...

**Top_K e Top_P n√£o s√£o "par√¢metros t√©cnicos obscuros".**

**S√£o BOT√ïES DE BRAND VOICE.**

---

Porque pensa comigo:

Voc√™ n√£o escolhe Top_K "porque sim".

Voc√™ escolhe baseado em:
- ‚úÖ Como sua marca FALA
- ‚úÖ Quem √© seu p√∫blico (CEO vs adolescente)
- ‚úÖ Onde opera (LinkedIn vs TikTok)

---

**Banco tradicional:**
- Top_K: 15
- Raz√£o: Brand formal, institucional
- Voz: "Informamos que..."

**Startup de IA:**
- Top_K: 70
- Raz√£o: Brand acess√≠vel, tech-friendly
- Voz: "A gente usa IA pra..."

---

**E quando voc√™ domina isso, voc√™ n√£o √© mais "configurador de IA".**

**Voc√™ √© brand designer que codifica personalidade em par√¢metros.**

---

## ‚úÖ ENTREG√ÅVEL DESTA LESSON

**Matriz de Configura√ß√µes por Persona:**

```markdown
# Configura√ß√µes de Par√¢metros - [Seu Produto]

## Persona 1: [Nome/Contexto]
- **P√∫blico:** [quem]
- **Tom desejado:** [formal/casual/criativo]
- **Configura√ß√£o:**
  ```javascript
  {
    "temperature": ___,
    "top_k": ___,
    "top_p": ___
  }
  ```
- **Exemplo de resposta esperada:**
  [exemplo]

## Persona 2: [...]

## Justificativa de Escolha
- Por que esses valores?
- Como alinha com brand voice?
- Testes realizados:
```

Salvar em: `entregas/4.2-configuracoes-vocabulario.md`

---

## ‚úÖ CHECKLIST DE CONCLUS√ÉO

Antes de avan√ßar pra Lesson 4.3, confirme:

- [ ] Entendi diferen√ßa entre Top_K (quantidade) e Top_P (probabilidade)
- [ ] Testei diferentes valores de Top_K (10, 50, 100)
- [ ] Vi diferen√ßa pr√°tica no vocabul√°rio usado
- [ ] Sei configurar agente FORMAL vs CASUAL
- [ ] Documentei receitas por caso de uso

---

## ‚û°Ô∏è PR√ìXIMA LESSON (FINAL DO CURSO!)

**Lesson 4.3:** Receitas por Caso de Uso

Voc√™ dominou:
- Temperature (determinismo)
- Top_K/Top_P (vocabul√°rio)

**Agora voc√™ vai ter RECEITAS PRONTAS:**

- Agente de Agendamento: `{temp: 0.2, top_k: 20, top_p: 0.7}`
- Agente de Atendimento: `{temp: 0.7, top_k: 50, top_p: 0.9}`
- Agente de An√°lise: `{temp: 0.1, top_k: 10, top_p: 0.6}`
- Agente Criativo: `{temp: 0.9, top_k: 80, top_p: 0.95}`

**CHEAT SHEET** que voc√™ imprime e cola na parede.

√öltima lesson. Vamos fechar com chave de ouro.

---

*Lesson criada com voz de Jos√© Carlos Amorim (MMOS) | Fidelidade: 90%+*
