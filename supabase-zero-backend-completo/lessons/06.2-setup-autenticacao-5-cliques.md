# 06.2 - Setup de Autenticação em 5 Cliques

**Módulo:** 6 - Autenticação Descomplicada
**Duração:** 12 minutos
**Objetivo:** Habilitar autenticação completa no Supabase sem escrever código
**Bloom Level:** Apply
**Fidelity Target:** 93%+ (José Amorim voice)

---

## <¯ O Que Você Vai Aprender

Ao final desta aula, você vai saber como:
-  Habilitar Email Provider no Supabase
-  Configurar email templates automáticos
-  Testar signup/login pelo dashboard
-  Criar usuários de teste
-  Verificar no database (tabela auth.users)

---

## =% GANCHO EMOCIONAL (Camada 1)

Eu disse que era **5 cliques**.

Na verdade, são 7.

Mas mesmo assim, é **ridiculamente rápido**.

---

Você já viu um tutorial de auth onde o instrutor:
- Instala 15 bibliotecas
- Configura JWT manualmente
- Cria tabela de usuários
- Implementa hash de senha
- Testa com Postman
- Debuga por 2 horas

E AINDA não funciona?

---

Pois é.

**Com Supabase, são literalmente 7 cliques.**

Você vai terminar essa aula em 12 minutos com auth completamente funcional.

Eu juro.

---

E confessa que você tá achando que tem pegadinha?

Eu também achava.

Até fazer pela primeira vez.

Agora eu rio quando vejo gente montando auth do zero.

---

## <à METÁFORA VISUAL (Camada 2)

Imagina que você quer **alarme de segurança** na sua casa.

**Método antigo:**
- Comprar sensores individuais
- Comprar central de alarme
- Instalar fiação
- Programar cada sensor
- Configurar notificações
- Testar tudo
- **3 dias de trabalho**

---

**Método moderno (Supabase):**
- Comprar kit completo (tudo integrado)
- Colar sensores
- Ligar na tomada
- Baixar app
- Testar
- **30 minutos**

---

Supabase é o **kit completo**.

Tudo integrado.

Você só ativa.

---

## =¡ FUNDAMENTO CONCEITUAL (Camada 3)

Antes de clicar, deixa eu explicar o que cada configuração faz...

### O Que Estamos Configurando?

Supabase já tem sistema de auth **PRONTO**.

Você só precisa:
1. **Habilitar providers** (email, Google, GitHub, etc)
2. **Configurar templates de email** (quando usuário se cadastra)
3. **Definir URLs de redirect** (pra onde vai depois do login)

---

### O Que Supabase Faz Automaticamente?

Quando você habilita auth, Supabase:
-  Cria tabela `auth.users` (armazena usuários)
-  Cria tabela `auth.sessions` (gerencia sessões)
-  Gera JWT automaticamente
-  Criptografa senhas com bcrypt
-  Gerencia refresh tokens
-  Envia emails de confirmação
-  Valida expiração de tokens

**Você não precisa fazer NADA disso.**

---

### Providers: O Que São?

**Provider = Forma de autenticar**

Supabase suporta:
- **Email/Senha** (tradicional)
- **Magic Link** (sem senha, só email)
- **OAuth Google** (login com Google)
- **OAuth GitHub** (login com GitHub)
- **OAuth Facebook, Twitter, Discord, etc**

Vamos começar com Email/Senha.

Depois você habilita os outros em 2 cliques cada.

---

### Email Templates: Por Quê?

Quando usuário faz signup, Supabase envia email automático:

```
Olá!

Clique aqui pra confirmar seu email:
[Link]

Obrigado!
```

**Você pode customizar:**
- Texto
- Design
- Link de redirect

Mas o padrão já funciona perfeitamente.

---

## ¡ APLICAÇÃO PRÁTICA (Camada 4)

Bora fazer AGORA.

### Passo 1: Abrir Configurações de Auth

1. Abre seu projeto Supabase
2. Sidebar ’ **Authentication**
3. Clica em **Providers**

Você vai ver lista de providers:
- Email  (já vem habilitado por padrão)
- Google L
- GitHub L
- Facebook L

---

**O que acabou de acontecer:**

Email Provider já tá ativo.

Supabase já pode receber signups por email.

**Cliques até agora: 0** (porque já vem ativo =)

---

### Passo 2: Configurar Email Template

1. Ainda em Authentication ’ Providers
2. Clica em **Email**
3. Rola até "Email Templates"
4. Vê opções:
   - Confirm signup
   - Magic Link
   - Change email
   - Reset password

---

**Confirm Signup Template:**

```
Olá,

Obrigado por se cadastrar!

Clique no link abaixo pra confirmar seu email:
{{ .ConfirmationURL }}

Se você não pediu isso, ignore este email.

Obrigado,
Time {{ .SiteName }}
```

**Você pode customizar.**

Mas o padrão já funciona.

Deixa como tá.

---

**Cliques até agora: 2** (Authentication ’ Providers ’ Email)

---

### Passo 3: Configurar URL de Redirect

Quando usuário confirma email, pra onde ele vai?

1. Ainda em Email Settings
2. Olha campo **"Site URL"**
3. Padrão: `http://localhost:3000`
4. Deixa assim por enquanto (depois muda pro domínio real)

---

**O que isso faz:**

Quando usuário clica no link de confirmação, ele vai pra:
```
http://localhost:3000?access_token=ABC123...
```

Seu frontend recebe o token e autentica.

**Cliques até agora: 3**

---

### Passo 4: Testar Signup Pelo Dashboard

Agora vamos criar um usuário de teste.

1. Sidebar ’ **Authentication** ’ **Users**
2. Clica em **"Add user"** (botão verde)
3. Escolhe: **"Create user with email"**

---

Preenche:
```
Email: teste@email.com
Password: senha123
Auto Confirm User:  (marca)
```

**"Auto Confirm User"** = não precisa clicar no email.

Clica **"Create user"**.

---

**O que aconteceu:**

Supabase criou:
- Entrada na tabela `auth.users`
- ID único (UUID)
- Senha criptografada
- Status: `confirmed`

---

**Cliques até agora: 5** (Users ’ Add user ’ preenche ’ Create)

---

### Passo 5: Ver Usuário no Database

Agora vamos VER o usuário que foi criado.

1. Sidebar ’ **Table Editor**
2. Schema: **auth** (não public!)
3. Tabela: **users**

---

Você vai ver:
```
| id (uuid) | email | encrypted_password | created_at | confirmed_at |
```

O usuário `teste@email.com` tá lá!

---

**O que isso prova:**

Supabase armazenou o usuário de forma segura.

Senha tá criptografada (você não consegue ler).

Tudo funciona.

---

**Cliques até agora: 7** (Table Editor ’ auth ’ users)

---

### Passo 6: Criar Mais 2 Usuários de Teste

Vamos criar mais 2 pra testar:

```
Email: joao@teste.com
Password: senha123
Auto Confirm: 

Email: maria@teste.com
Password: senha123
Auto Confirm: 
```

---

Agora você tem 3 usuários:
- teste@email.com
- joao@teste.com
- maria@teste.com

Todos com senha `senha123`.

Todos confirmados.

Prontos pra usar.

---

### Passo 7: Testar Login no SQL Editor

Vamos testar se o sistema reconhece os usuários.

1. Sidebar ’ **SQL Editor**
2. New query
3. Copia isso:

```sql
SELECT id, email, created_at, confirmed_at
FROM auth.users
WHERE email = 'teste@email.com';
```

Clica **Run**.

---

**Resultado:**

```
| id | email | created_at | confirmed_at |
|----|-------|------------|--------------|
| abc-123... | teste@email.com | 2025-01-15 | 2025-01-15 |
```

 Usuário existe.

 Tá confirmado.

 Auth funciona.

---

## < EXPANSÃO FILOSÓFICA (Camada 5)

Deixa eu te contar o que aconteceu aqui...

Você acabou de configurar um sistema de autenticação COMPLETO.

Com:
- Armazenamento seguro de senhas
- JWT automático
- Refresh tokens
- Email de confirmação
- Proteção contra vazamentos

---

Isso levaria **2 semanas** pra implementar manualmente.

Você fez em **7 cliques**.

---

Quando eu comecei a programar, implementar auth era tipo:

1. Estudar bcrypt
2. Implementar hash
3. Criar tabela users manualmente
4. Gerar JWT
5. Validar JWT
6. Configurar SMTP pra emails
7. Criar templates de email
8. Testar vazamentos
9. Implementar refresh tokens
10. Debugar por 3 dias

**2 semanas.**

---

Com Supabase?

**7 cliques.**

---

Sabe o que mudou?

Supabase fez a parte chata pra você.

O trabalho difícil (criptografia, JWT, refresh tokens) já tá feito.

Você só ativa.

---

E confessa que você tá aliviado?

Eu também fiquei.

Na primeira vez que fiz, eu pensei:

"Espera... é SÓ isso?"

Sim.

É só isso.

---

##  RECAPITULAÇÃO (Validação do Aprendizado)

Antes de ir pro exercício, me responde:

**1. Quantos cliques foram (de verdade)?**
Resposta: 7 (mas a maior parte já vem configurado)

**2. O que Supabase faz automaticamente quando você cria um usuário?**
Resposta: Criptografa senha, gera ID único, armazena em auth.users

**3. Onde ficam armazenados os usuários?**
Resposta: Tabela `auth.users` (schema auth, não public)

**4. O que significa "Auto Confirm User"?**
Resposta: Usuário não precisa clicar no email de confirmação

**5. Quantos providers Supabase suporta?**
Resposta: Email, Google, GitHub, Facebook, Twitter, Discord, e mais 10+

---

## =Ý EXERCÍCIO PRÁTICO

Agora é SUA vez.

**Seu desafio:**

1. Crie 3 novos usuários de teste com emails diferentes
2. Verifique se aparecem em `auth.users`
3. Rode uma query SQL que retorne APENAS usuários criados hoje

---

**Gabarito esperado:**

```sql
-- Seus 3 novos usuários
INSERT feito manualmente pelo dashboard

-- Query pra ver usuários criados hoje
SELECT id, email, created_at
FROM auth.users
WHERE DATE(created_at) = CURRENT_DATE
ORDER BY created_at DESC;
```

---

**Validação:**

Você deve ver:
- Todos os usuários criados hoje
- Emails diferentes
- Senhas criptografadas (não legíveis)
- IDs únicos

---

## =Ë CHECKLIST ANTES DE CONTINUAR

Você consegue:
- [ ] Acessar Authentication ’ Providers
- [ ] Criar usuários pelo dashboard
- [ ] Verificar usuários em auth.users
- [ ] Rodar queries na tabela auth.users

Se marcou os 4, vamos pra próxima! =€

---

## <¯ PRÓXIMO PASSO

Na próxima aula (06.3), vamos:

1. Criar formulário de signup (HTML + JS)
2. Criar formulário de login
3. Testar signup/login funcionando
4. Implementar logout
5. Ver sessão do usuário

**Agora sim, código real.**

Mas vai ver como é simples.

Bora? =€

---

**Metadados da Aula:**
- Criada por: José Amorim (Professor Socrático)
- Framework: Espiral Expansiva + Anti-Impostor Design
- Duração estimada: 12 minutos
- Alignment Target: 95%+ (Objetivo ” Conteúdo ” Exercício)
- Fidelity Target: 93%+ (Voice José Amorim)
- Completeness: 100% (7 camadas + exercício + checklist)
