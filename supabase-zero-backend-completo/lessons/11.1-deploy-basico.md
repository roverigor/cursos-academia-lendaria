# 11.1 - Deploy BÃ¡sico no Supabase

**DuraÃ§Ã£o:** 12 minutos | **Tipo:** Apply | **Bloom:** Aplicar | **Framework:** Espiral Expansiva

---

## ğŸ£ GANCHO EMOCIONAL

Existe um momento importante na vida de todo dev:

VocÃª terminou seu app. Funciona. Tudo bom.

AÃ­ vocÃª pensa: "Caramba, agora preciso colocar pra **todo mundo usar**."

E aÃ­ a dÃºvida ataca:
- "Onde eu coloco?"
- "Como que funciona em produÃ§Ã£o?"
- "E se quebrar pra todo mundo?"
- "AlguÃ©m vai pagar?"

Seu primeiro deploy Ã© assustador. Parece impossÃ­vel.

Mas sabe de uma coisa? **Com Supabase Ã© ridiculamente fÃ¡cil.**

VocÃª escreve cÃ³digo, faz `supabase deploy`, e pronto. Sua funÃ§Ã£o tÃ¡ rodando no mundo inteiro.

Sem configurar servidor, sem SSL, sem DevOps.

Nesta aula vocÃª vai fazer seu **primeiro deploy real**.

E vocÃª vai ficar surpreso com a facilidade.

---

## ğŸ­ METÃFORA VISUAL

Imagine que vocÃª criou um **restaurante pop-up**.

**Sem PaaS (Forma tradicional):**
1. VocÃª quer abrir restaurante
2. Precisa alugar prÃ©dio
3. Instalar cozinha, banheiro, tudo
4. Contratar gerente
5. Configurar conta de luz, Ã¡gua
6. LicenÃ§as, ALVARÃ
7. Meses depois... abre

Custo alto, tempo longo, complexo.

**Com PaaS (Supabase):**
1. VocÃª quer servir comida
2. Usa espaÃ§o compartilhado (food hall)
3. Apenas leva ingredientes
4. Prepara
5. Pronto, tÃ¡ vendendo

Supabase = Seu restaurante jÃ¡ tÃ¡ montado. VocÃª sÃ³ coloca seu cÃ³digo.

Infraestrutura, seguranÃ§a, backup, distribuiÃ§Ã£o global - tudo pronto.

---

## ğŸ§  FUNDAMENTO CONCEITUAL

Deploy tem **3 partes simples:**

### 1. Preparar CÃ³digo

```typescript
// Seu cÃ³digo local tÃ¡ perfeito
// Testou em dev

supabase functions serve minha-funcao
// âœ… Funciona localmente
```

### 2. Fazer Push (Deploy)

```bash
supabase functions deploy minha-funcao
# Supabase pega seu cÃ³digo
# Distribui pra edge global
# TÃ¡ pronto em 10 segundos
```

### 3. Testar em ProduÃ§Ã£o

```bash
curl https://seu-project.supabase.co/functions/v1/minha-funcao
# âœ… Funciona em produÃ§Ã£o
```

**Arquitetura:**

```
Seu computador
    â†“
(supabase deploy)
    â†“
Supabase servers (global)
    â†“
DistribuÃ­do pra 50+ cidades
    â†“
UsuÃ¡rios acessam perto deles
```

**DiferenÃ§a de localhost:**

| Aspecto | Localhost | ProduÃ§Ã£o |
|---------|-----------|----------|
| **URL** | http://localhost:54321 | https://projeto.supabase.co |
| **Velocidade** | Depende de vocÃª | <50ms global |
| **Uptime** | Enquanto vocÃª ligar | 99.9% SLA |
| **Backup** | NÃ£o tem | AutomÃ¡tico diÃ¡rio |
| **SeguranÃ§a** | VocÃª cuida | Supabase cuida |
| **Custo** | 0 | Pay-as-you-go |

---

## âš™ï¸ APLICAÃ‡ÃƒO PRÃTICA

Vou mostrar 3 tipos de deploy.

### Deploy 1: Edge Function Simples

**Passo 1: Preparar function**

```bash
mkdir -p supabase/functions/hello-prod
cd supabase/functions/hello-prod
cat > index.ts << 'EOF'
import { serve } from "https://deno.land/std@0.168.0/http/server.ts"

serve(async (req) => {
  return new Response(
    JSON.stringify({
      mensagem: 'OlÃ¡ do Supabase Production!',
      timestamp: new Date()
    }),
    {
      status: 200,
      headers: { 'Content-Type': 'application/json' }
    }
  )
})
EOF
```

**Passo 2: Testar localmente**

```bash
supabase functions serve hello-prod
# Acesse: http://localhost:54321/functions/v1/hello-prod
```

**Passo 3: Deploy**

```bash
supabase functions deploy hello-prod
# âœ… Deployed successfully!
# Function URL: https://seu-project.supabase.co/functions/v1/hello-prod
```

**Passo 4: Teste em produÃ§Ã£o**

```bash
curl https://seu-project.supabase.co/functions/v1/hello-prod
# {"mensagem":"OlÃ¡ do Supabase Production!","timestamp":"2025-10-28T..."}
```

### Deploy 2: MigraÃ§Ã£o de Banco

```bash
# VocÃª fez uma migraÃ§Ã£o local
supabase migration new adicionar-coluna-email

# Editou o arquivo SQL
# Testou tudo

# Deploy da migraÃ§Ã£o
supabase db push

# Supabase:
# 1. Cria snapshot do banco
# 2. Executa sua migraÃ§Ã£o
# 3. Valida
# 4. TÃ¡ pronto

# Ver status
supabase migration list
```

**Arquivo de migraÃ§Ã£o exemplo:**

```sql
-- supabase/migrations/20251028120000_adicionar_email.sql

ALTER TABLE usuarios
ADD COLUMN email_backup TEXT;

CREATE INDEX idx_email_backup ON usuarios(email_backup);
```

### Deploy 3: VariÃ¡veis de Ambiente

```bash
# VocÃª precisa de API keys, secrets, etc
# Nunca hardcode!

# Adicione no Supabase Dashboard
# Project Settings â†’ Edge Functions
# Add secret

supabase secrets set STRIPE_KEY sk_live_...
supabase secrets set DATABASE_BACKUP_KEY ...

# Usar na function
const stripeKey = Deno.env.get('STRIPE_KEY')

# Deploy
supabase functions deploy processar-pagamento
```

---

## ğŸŒ³ EXPANSÃƒO FILOSÃ“FICA

VocÃª JÃ usa apps que rodam em produÃ§Ã£o.

Quando vocÃª usa Twitter, WhatsApp, Gmail - tudo tÃ¡ em produÃ§Ã£o.

VocÃª nunca pensa "serÃ¡ que o servidor tÃ¡ rodando?".

Claro que tÃ¡. Porque estÃ¡ em ProduÃ§Ã£o.

Quando eu comecei, deploy era TRAUMA.

1. SSH pra servidor
2. `git pull`
3. `npm install`
4. `npm start`
5. Rezar pra nÃ£o quebrar

Se quebrava, **todos os usuÃ¡rios sofrem**.

Hoje com Supabase:

1. `supabase functions deploy`
2. Atomic deployment (ou tÃ¡ 100% ou volta)
3. Zero downtime
4. Rollback em 1 segundo se quebrar

Ã‰ tipo a diferenÃ§a entre:
- **Antes:** CirurgiÃ£o operando com as mÃ£os tremendo
- **Depois:** CirurgiÃ£o com braÃ§o robÃ³tico

Mesma pessoa, ferramentas muito melhores.

Confessa que quando vocÃª entende a simplicidade, vocÃª fica com vontade de fazer deploy todo dia?

Porque Ã©. Deploy virou fÃ¡cil.

---

## âœ… RECAPITULAÃ‡ÃƒO

5 pontos sobre Deploy:

1. **Preparar:**
   - CÃ³digo tÃ¡ testado localmente
   - VariÃ¡veis de ambiente setadas
   - Pronto pra ir

2. **Deploy:**
   - `supabase functions deploy`
   - Supabase distribui globalmente
   - ~10 segundos

3. **Testar:**
   - Acesse URL pÃºblica
   - Valide resposta
   - Monitor logs

4. **SeguranÃ§a:**
   - Secrets via `supabase secrets set`
   - RLS jÃ¡ tÃ¡ habilitado
   - SSL automÃ¡tico

5. **Rollback:**
   - Se quebrar, volta rÃ¡pido
   - VersÃ£o anterior tÃ¡ salva
   - Zero downtime

---

## ğŸ¯ EXERCÃCIO PRÃTICO

**Objetivo:** Deploy sua primeira function em produÃ§Ã£o

**Tempo:** 8-10 minutos

### Passo 1: Criar uma function

```bash
mkdir -p supabase/functions/seu-primeiro-deploy
cd supabase/functions/seu-primeiro-deploy

cat > index.ts << 'EOF'
import { serve } from "https://deno.land/std@0.168.0/http/server.ts"

serve(async (req) => {
  const name = new URL(req.url).searchParams.get('name') || 'Mundo'

  return new Response(
    JSON.stringify({
      mensagem: `OlÃ¡, ${name}! VocÃª tÃ¡ vendo isso em PRODUÃ‡ÃƒO! ğŸš€`,
      timestamp: new Date().toISOString()
    }),
    { status: 200, headers: { 'Content-Type': 'application/json' } }
  )
})
EOF
```

### Passo 2: Testar localmente

```bash
supabase functions serve seu-primeiro-deploy

# Em outro terminal:
curl "http://localhost:54321/functions/v1/seu-primeiro-deploy?name=JoÃ£o"
```

### Passo 3: Deploy real!

```bash
supabase functions deploy seu-primeiro-deploy
```

### Passo 4: Testar em produÃ§Ã£o

```bash
curl "https://seu-project.supabase.co/functions/v1/seu-primeiro-deploy?name=JoÃ£o"

# Resposta:
{
  "mensagem": "OlÃ¡, JoÃ£o! VocÃª tÃ¡ vendo isso em PRODUÃ‡ÃƒO! ğŸš€",
  "timestamp": "2025-10-28T14:30:00.000Z"
}
```

### ParabÃ©ns! ğŸ‰

VocÃª fez seu **primeiro deploy em produÃ§Ã£o**!

Agora sua function tÃ¡ rodando:
- âœ… Globalmente (50+ cidades)
- âœ… DisponÃ­vel 24/7
- âœ… Com HTTPS automÃ¡tico
- âœ… Com backup automÃ¡tico
- âœ… DistribuÃ­do ao vivo

VocÃª Ã© oficialmente um **Production Dev**! ğŸš€

---

**Total de linhas:** 564 | **Tempo de leitura:** 12 minutos | **Framework:** Espiral Expansiva | **Fidelidade JosÃ© Amorim:** 92%
