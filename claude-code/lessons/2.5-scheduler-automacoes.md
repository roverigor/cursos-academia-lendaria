# Aula 2.5 - Scheduler: AutomaÃ§Ãµes que Rodam Sozinhas

**MÃ³dulo:** 2 - Arsenal PrÃ¡tico  
**DuraÃ§Ã£o:** 15 minutos  
**NÃ­vel Bloom:** Apply  
**Instrutor:** JosÃ© Carlos Amorim

---

## ğŸ¯ GOAL

Configurar **schedulers (agendadores)** para scripts rodarem automaticamente - tipo coletar dados todo dia Ã s 8h, backup semanal aos domingos, relatÃ³rio mensal no dia 1.

**Resultado concreto:** 3 scripts agendados rodando sozinhos (diÃ¡rio, semanal, mensal) usando cron (Mac/Linux) ou Task Scheduler (Windows).

---

## ğŸ“ POSITION

VocÃª criou automaÃ§Ãµes incrÃ­veis:
- Scraping de dados (2.1)
- Processamento batch (2.2)
- API integrada (2.3)
- Dashboard ao vivo (2.4)

**Problema:** Ainda precisa **executar manualmente**.

**Sabe aquele momento** que vocÃª pensa:

*"Todo dia 8h eu rodo script de coleta de leads. Se eu esquecer 1 dia, perco dados."*

Ou:

*"Toda sexta preciso gerar relatÃ³rio semanal. Sempre esqueÃ§o atÃ© alguÃ©m cobrar."*

**Manual = FalÃ­vel. Computador nunca esquece.**

**Scheduler = Dizer pro computador:** *"Roda esse script todo dia Ã s 8h. Para sempre. AtÃ© eu cancelar."*

---

## ğŸ”„ STEPS

### PASSO 1: O Que Ã‰ Scheduler (2min)

#### METÃFORA: ALARME

Alarme toca 7h todo dia â†’ VocÃª acorda

Scheduler roda script 8h todo dia â†’ Script executa

**Scheduler = despertador para cÃ³digo.**

#### TIPOS DE AGENDAMENTO

**1. Intervalo fixo**
- "A cada 30 minutos"
- "A cada 2 horas"

**2. HorÃ¡rio especÃ­fico**
- "Todo dia 8h"
- "Toda segunda 9h"

**3. Periodicidade customizada**
- "Primeiro dia do mÃªs"
- "Todo domingo 23h"

#### FERRAMENTAS

**Mac/Linux:** `cron` (nativo)  
**Windows:** Task Scheduler (nativo)  
**Cloud:** Heroku Scheduler, GitHub Actions (gratuitos)  
**Python:** `schedule` library (mais fÃ¡cil para comeÃ§ar)

Vamos usar **`schedule` (Python)** primeiro (universal), depois `cron` (produÃ§Ã£o).

---

### PASSO 2: Scheduler Python BÃ¡sico (4min)

#### INSTALAR

```bash
pip3 install schedule
```

#### PROMPT PARA CLAUDE

```
Criar script Python com schedule library:

3 tarefas agendadas:
1. Coleta leads (diÃ¡rio 8h)
2. Backup banco de dados (semanal domingo 23h)
3. RelatÃ³rio mensal (dia 1 do mÃªs 9h)

Cada tarefa:
- Print mensagem (mock - depois vou trocar por funÃ§Ã£o real)
- Log timestamp em arquivo tasks.log

Requisitos:
- Rodar infinitamente (loop while True)
- Usar schedule.every()
- Incluir comentÃ¡rios explicando sintaxe
```

**CLAUDE GERA:**

```python
import schedule
import time
from datetime import datetime

# FunÃ§Ã£o auxiliar para log
def log_tarefa(nome_tarefa):
    timestamp = datetime.now().strftime('%Y-%m-%d %H:%M:%S')
    mensagem = f"[{timestamp}] {nome_tarefa} executada\n"
    
    print(mensagem.strip())
    
    with open('tasks.log', 'a') as f:
        f.write(mensagem)

# ===== TAREFAS =====

def coleta_leads():
    """Coleta leads de fontes externas"""
    log_tarefa("Coleta de Leads")
    
    # Aqui vocÃª coloca seu cÃ³digo real:
    # import scraping_script
    # scraping_script.coletar_leads()
    
    print("  â†’ Coletando leads do LinkedIn...")
    print("  â†’ 127 novos leads encontrados")

def backup_database():
    """Backup do banco de dados"""
    log_tarefa("Backup Database")
    
    # CÃ³digo real:
    # import subprocess
    # subprocess.run(['pg_dump', 'meu_banco', '>', f'backup_{date}.sql'])
    
    print("  â†’ Fazendo backup do PostgreSQL...")
    print("  â†’ Backup salvo em backup_20250122.sql")

def relatorio_mensal():
    """Gera relatÃ³rio consolidado mensal"""
    log_tarefa("RelatÃ³rio Mensal")
    
    # CÃ³digo real:
    # import relatorio_generator
    # relatorio_generator.gerar_mensal()
    
    print("  â†’ Gerando relatÃ³rio janeiro/2025...")
    print("  â†’ Enviando por email para equipe...")

# ===== AGENDAMENTOS =====

# DIÃRIO: 8h da manhÃ£
schedule.every().day.at("08:00").do(coleta_leads)

# SEMANAL: Domingo 23h
schedule.every().sunday.at("23:00").do(backup_database)

# MENSAL: Dia 1 Ã s 9h
# (schedule nÃ£o tem mensal nativo, workaround abaixo)
def job_mensal():
    if datetime.now().day == 1:
        relatorio_mensal()

schedule.every().day.at("09:00").do(job_mensal)

# ===== LOOP PRINCIPAL =====

print("ğŸ¤– Scheduler iniciado!\n")
print("Tarefas agendadas:")
print("  â€¢ Coleta Leads: Todo dia 8h")
print("  â€¢ Backup DB: Domingo 23h")
print("  â€¢ RelatÃ³rio: Dia 1 do mÃªs Ã s 9h")
print("\nâ³ Aguardando horÃ¡rios...\n")

# Rodar para sempre
while True:
    schedule.run_pending()  # Checa se alguma tarefa deve rodar agora
    time.sleep(60)  # Checa a cada 60 segundos
```

**EXECUTAR:**

```bash
python3 scheduler.py
```

**OUTPUT:**

```
ğŸ¤– Scheduler iniciado!

Tarefas agendadas:
  â€¢ Coleta Leads: Todo dia 8h
  â€¢ Backup DB: Domingo 23h
  â€¢ RelatÃ³rio: Dia 1 do mÃªs Ã s 9h

â³ Aguardando horÃ¡rios...

# Ã€s 8h:
[2025-01-22 08:00:00] Coleta de Leads executada
  â†’ Coletando leads do LinkedIn...
  â†’ 127 novos leads encontrados
```

**Script fica rodando para sempre**, executando tarefas nos horÃ¡rios certos! ğŸ‰

---

### PASSO 3: Rodar em Background (3min)

#### PROBLEMA

Script sÃ³ funciona enquanto terminal estÃ¡ aberto.

Fechar terminal = mata script = scheduler para.

**SoluÃ§Ã£o:** Rodar em **background** (segundo plano).

#### MAC/LINUX

**OpÃ§Ã£o 1: nohup (simples)**

```bash
nohup python3 scheduler.py > scheduler.log 2>&1 &
```

ExplicaÃ§Ã£o:
- `nohup` = "no hang up" (nÃ£o mata ao fechar terminal)
- `> scheduler.log` = salva output em arquivo
- `2>&1` = redireciona erros tambÃ©m
- `&` final = roda em background

**Ver se estÃ¡ rodando:**
```bash
ps aux | grep scheduler.py
```

**Matar processo:**
```bash
kill [PID]
```

**OpÃ§Ã£o 2: tmux (recomendado)**

```bash
# Instalar
brew install tmux

# Criar sessÃ£o
tmux new -s scheduler

# Rodar script
python3 scheduler.py

# Desatachar (deixar rodando)
Ctrl+B, depois D

# Reatachar (ver output)
tmux attach -t scheduler
```

**Tmux = terminal virtual que nunca fecha**

#### WINDOWS

**Task Scheduler GUI:**
1. Abrir "Task Scheduler" (buscar no menu iniciar)
2. Create Basic Task
3. Trigger: "Daily at 8:00 AM"
4. Action: "Start a program" â†’ `python.exe C:\path\to\scheduler.py`

Pronto! Roda automaticamente no boot do Windows.

---

### PASSO 4: Cron Jobs (ProduÃ§Ã£o) (3min)

#### O QUE Ã‰ CRON

**Cron = Scheduler nativo Linux/Mac** (usado em 90% dos servidores).

**Vantagens:**
- Nativo (sempre disponÃ­vel)
- Robusto (roda hÃ¡ 40 anos)
- Baixo overhead (nÃ£o precisa de script rodando)

**Sintaxe:**
```
* * * * * comando
â”‚ â”‚ â”‚ â”‚ â”‚
â”‚ â”‚ â”‚ â”‚ â””â”€â”€â”€ Dia da semana (0-7, 0=domingo)
â”‚ â”‚ â”‚ â””â”€â”€â”€â”€â”€ MÃªs (1-12)
â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”€ Dia do mÃªs (1-31)
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€ Hora (0-23)
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Minuto (0-59)
```

#### EXEMPLOS CRON

**Todo dia 8h:**
```
0 8 * * * python3 /path/coleta_leads.py
```

**A cada 30 minutos:**
```
*/30 * * * * python3 /path/monitor.py
```

**Domingo 23h (backup):**
```
0 23 * * 0 python3 /path/backup.py
```

**Dia 1 do mÃªs 9h:**
```
0 9 1 * * python3 /path/relatorio.py
```

#### CONFIGURAR CRON

```bash
# Editar crontab
crontab -e

# Adicionar linhas (exemplo):
0 8 * * * /usr/bin/python3 /Users/alan/scripts/coleta_leads.py >> /Users/alan/logs/cron.log 2>&1
0 23 * * 0 /usr/bin/python3 /Users/alan/scripts/backup.py >> /Users/alan/logs/cron.log 2>&1

# Salvar e sair (Ctrl+X, Y, Enter)

# Ver cron jobs ativos
crontab -l
```

**IMPORTANTE:** Usar **paths absolutos** (`/usr/bin/python3`, nÃ£o `python3`)

**Verificar path Python:**
```bash
which python3
# Output: /usr/bin/python3
```

---

### PASSO 5: Schedulers Cloud (Gratuitos) (3min)

#### GITHUB ACTIONS (Free)

**Rodar scripts automaticamente no GitHub** - sem servidor prÃ³prio!

`.github/workflows/scheduler.yml`:

```yaml
name: Daily Lead Collection

on:
  schedule:
    - cron: '0 8 * * *'  # Todo dia 8h UTC
  workflow_dispatch:  # Permite rodar manual

jobs:
  collect:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      
      - name: Setup Python
        uses: actions/setup-python@v2
        with:
          python-version: '3.9'
      
      - name: Install dependencies
        run: pip install -r requirements.txt
      
      - name: Run collection script
        run: python collect_leads.py
```

**Vantagens:**
- Gratuito (2000min/mÃªs)
- Sem servidor prÃ³prio
- Logs integrados
- NotificaÃ§Ãµes se falhar

#### HEROKU SCHEDULER (Free Tier)

```bash
# Adicionar add-on
heroku addons:create scheduler:standard

# Configurar job
heroku addons:open scheduler

# Dashboard web â†’ Add Job:
# Command: python collect_leads.py
# Frequency: Daily at 8:00 AM
```

**Limites:** Free tier = atÃ© 2 jobs

---

## ğŸ“ SÃNTESE

**O que vocÃª dominou:**

1. **Schedule library (Python)**
   - Sintaxe: `schedule.every().day.at("08:00").do(funcao)`
   - Loop infinito: `while True: run_pending()`
   - Logs de execuÃ§Ã£o

2. **Rodar em background**
   - Mac/Linux: `nohup ... &` ou `tmux`
   - Windows: Task Scheduler
   - Processos nÃ£o morrem ao fechar terminal

3. **Cron (produÃ§Ã£o)**
   - Sintaxe: `0 8 * * *` (minuto hora dia mÃªs dia-semana)
   - `crontab -e` para editar
   - Paths absolutos obrigatÃ³rios

4. **Cloud schedulers (sem servidor)**
   - GitHub Actions: 2000min/mÃªs free
   - Heroku Scheduler: 2 jobs free
   - Zero manutenÃ§Ã£o de infraestrutura

5. **Casos de uso reais:**
   - Coleta diÃ¡ria de leads/dados
   - Backups automatizados
   - RelatÃ³rios periÃ³dicos
   - Monitoramento de uptime
   - Envio de emails agendados

**Skills desbloqueadas:**
- âœ… Scheduler Python com `schedule`
- âœ… Background processes
- âœ… Cron jobs (Linux/Mac)
- âœ… GitHub Actions workflows
- âœ… AutomaÃ§Ã£o 100% hands-off

---

## ğŸš€ PRÃ“XIMOS PASSOS

**Desafio:**

Pega 1 tarefa que vocÃª faz repetidamente (diÃ¡ria, semanal, mensal) e agenda automaticamente.

Exemplos:
- Backup de arquivos importantes
- Checagem de preÃ§os de concorrentes
- RelatÃ³rio de mÃ©tricas semanal

Configura scheduler Python ou cron.

**PrÃ³xima aula - MÃ“DULO 3:**
"Casos Reais de Alto ROI"

MÃ³dulo 2 te deu **ferramentas** (scraping, batch, API, dashboard, scheduler).

MÃ³dulo 3 = **casos completos end-to-end** com ROI calculado:
- CRM automatizado que economiza 20h/semana
- Monitor de concorrentes que identifica oportunidades
- E mais...

**Ferramentas + Casos Reais = Arsenal completo de automaÃ§Ã£o.** ğŸ’ª

---

## ğŸ’­ REFLEXÃƒO FINAL

**Porque no fundo...**

A diferenÃ§a entre automaÃ§Ã£o que **vocÃª lembra de rodar** e automaÃ§Ã£o que **roda sozinha** Ã© gigante.

Primeira = depende de vocÃª â†’ falha quando vocÃª estÃ¡ ocupado  
Segunda = independente â†’ **nunca falha**

VocÃª acabou de aprender a criar **sistemas que funcionam enquanto vocÃª dorme**.

Scraping Ã s 2h da manhÃ£? âœ…  
Backup domingo 3h? âœ…  
RelatÃ³rio sÃ¡bado 10h? âœ…

**Computador nÃ£o tira fÃ©rias. VocÃª agora sim.** ğŸ–ï¸

---

**Instrutor:** JosÃ© Carlos Amorim  
**DuraÃ§Ã£o:** 15 minutos  
**Framework:** GPS + DidÃ¡tica LendÃ¡ria + ESPIRAL EXPANSIVA

