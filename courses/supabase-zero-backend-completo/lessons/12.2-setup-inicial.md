# 12.2 - Setup Inicial

**DuraÃ§Ã£o:** 15 minutos | **Tipo:** Apply | **Bloom:** Aplicar | **Framework:** Espiral Expansiva

---

## ðŸŽ£ GANCHO EMOCIONAL

VocÃª tem um plano. Bonito. Completo. No papel.

AÃ­ vocÃª pensa: "Agora como que EU COMEÃ‡O?"

NÃ£o Ã© design. NÃ£o Ã© architecture. Ã‰ o momento de **colocar as mÃ£os na mÃ¡quina**.

Primeira linha de cÃ³digo. Primeira migraÃ§Ã£o. Primeiro componente.

Esse momento Ã© importante. Se cagar agora, tÃ¡ tudo errado depois.

EntÃ£o vamos fazer certo. **Do zero, do jeito certo.**

Nesta aula vocÃª cria a estrutura inicial. Cimento. Estrutura.

Tudo pronto pra vocÃª buildar as features.

---

## ðŸŽ­ METÃFORA VISUAL

Imagine construir a casa novamente.

**Antes de colocar tijolos:**
1. MarcaÃ§Ã£o do terreno (foundations)
2. PreparaÃ§Ã£o dos alicerces
3. Checagem com nÃ­vel e prumo

Se cagar aqui, toda casa fica errada.

**Com projeto:**
1. Criar repo Git
2. Instalar dependÃªncias
3. Conectar Supabase
4. Criar migrations
5. Setup CI/CD bÃ¡sico

Tudo pronto. Estrutura sÃ³lida.

---

## ðŸ§  FUNDAMENTO CONCEITUAL

Setup inicial tem **4 pilares:**

### 1. Projeto Node.js

```bash
npm create next-app@latest task-manager
cd task-manager
```

### 2. Supabase localmente

```bash
supabase init
supabase start
```

### 3. Conectar ao Supabase

```javascript
import { createClient } from '@supabase/supabase-js'

export const supabase = createClient(
  process.env.NEXT_PUBLIC_SUPABASE_URL,
  process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY
)
```

### 4. Primeira migraÃ§Ã£o

```sql
CREATE TABLE users (
  id UUID PRIMARY KEY,
  email TEXT UNIQUE,
  created_at TIMESTAMP DEFAULT NOW()
);
```

---

## âš™ï¸ APLICAÃ‡ÃƒO PRÃTICA

### Setup 1: Criar Projeto Next.js

```bash
# Criar projeto
npm create next-app@latest task-manager --typescript --tailwind

cd task-manager

# Instalar Supabase client
npm install @supabase/supabase-js

# Instalar auth provider
npm install @supabase/auth-helpers-nextjs

# Criar .env.local
cat > .env.local << 'EOF'
NEXT_PUBLIC_SUPABASE_URL=https://seu-project.supabase.co
NEXT_PUBLIC_SUPABASE_ANON_KEY=seu-anon-key
SUPABASE_SERVICE_ROLE_KEY=seu-service-role-key
EOF
```

### Setup 2: Supabase CLI Local

```bash
# Instalar Supabase CLI
npm install --save-dev supabase

# Inicializar
supabase init

# Ligar Supabase localmente
supabase start

# Deve mostrar:
# DB URL: postgres://...
# API URL: http://localhost:54321
# Anon key: xxx
```

### Setup 3: Conectar ao Supabase (Remote)

```bash
# Login
supabase login

# Ligar ao seu projeto
supabase link --project-id seu-project-id

# Puxar schema do remote
supabase pull
```

### Setup 4: Primeira MigraÃ§Ã£o

```bash
# Criar migration
supabase migration new create_tables

# Arquivo criado: supabase/migrations/YYYYMMDDHHMMSS_create_tables.sql
```

**ConteÃºdo da migraÃ§Ã£o:**

```sql
-- supabase/migrations/20251028120000_create_tables.sql

-- Table: users (jÃ¡ vem com auth, mas vamos ter uma tabela de profile)
CREATE TABLE user_profiles (
  id UUID PRIMARY KEY REFERENCES auth.users(id),
  display_name TEXT,
  avatar_url TEXT,
  created_at TIMESTAMP DEFAULT NOW()
);

-- Table: projects
CREATE TABLE projects (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  name TEXT NOT NULL,
  description TEXT,
  owner_id UUID NOT NULL REFERENCES auth.users(id),
  created_at TIMESTAMP DEFAULT NOW(),
  updated_at TIMESTAMP DEFAULT NOW()
);

-- Index para queries rÃ¡pidas
CREATE INDEX idx_projects_owner_id ON projects(owner_id);

-- Table: tasks
CREATE TABLE tasks (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  project_id UUID NOT NULL REFERENCES projects(id) ON DELETE CASCADE,
  title TEXT NOT NULL,
  description TEXT,
  status TEXT DEFAULT 'todo', -- todo, in_progress, done
  assigned_to UUID REFERENCES auth.users(id),
  created_at TIMESTAMP DEFAULT NOW(),
  updated_at TIMESTAMP DEFAULT NOW()
);

-- Index
CREATE INDEX idx_tasks_project_id ON tasks(project_id);
CREATE INDEX idx_tasks_status ON tasks(status);

-- Table: project_members (compartilhamento)
CREATE TABLE project_members (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  project_id UUID NOT NULL REFERENCES projects(id) ON DELETE CASCADE,
  user_id UUID NOT NULL REFERENCES auth.users(id),
  role TEXT DEFAULT 'editor', -- owner, editor, viewer
  created_at TIMESTAMP DEFAULT NOW(),
  UNIQUE(project_id, user_id)
);

-- Index
CREATE INDEX idx_project_members_project_id ON project_members(project_id);
CREATE INDEX idx_project_members_user_id ON project_members(user_id);
```

### Setup 5: Executar MigraÃ§Ã£o

```bash
# Localmente
supabase db push

# Ver migrations
supabase migration list

# Deve mostrar:
# Version: 20251028120000
# Name: create_tables
# Status: Applied
```

### Setup 6: Setup CI/CD BÃ¡sico

```yaml
# .github/workflows/deploy.yml

name: Deploy

on:
  push:
    branches: [main]

jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-node@v4
        with:
          node-version: '18'
      - run: npm ci
      - run: npm test
      - run: npm run build
      - name: Deploy to Vercel
        run: npm install -g vercel && vercel --prod
        env:
          VERCEL_TOKEN: ${{ secrets.VERCEL_TOKEN }}
          VERCEL_ORG_ID: ${{ secrets.VERCEL_ORG_ID }}
          VERCEL_PROJECT_ID: ${{ secrets.VERCEL_PROJECT_ID }}
```

---

## ðŸŒ³ EXPANSÃƒO FILOSÃ“FICA

Setup Ã© CRÃTICO.

Quando eu comecei, eu pulava setup. Pensava "ah, vou depois".

3 meses depois, cÃ³digo tÃ¡ uma bagunÃ§a. DependÃªncias conflitando. Migrations perdidas.

Peguei uma liÃ§Ã£o importante: **Setup certo = 90% do trabalho feito**.

Com setup bom:
- VocÃª consegue onboard outro dev em 5 minutos
- CI/CD funciona automÃ¡tico
- Ambientes sÃ£o consistentes
- Rollback Ã© fÃ¡cil

Sem setup bom:
- Cada dev tem config diferente
- Deploy Ã© manual e arriscado
- Bugs aparecem sÃ³ em produÃ§Ã£o

Que preferÃªncia vocÃª tem? Ã“bvio.

**Setup = FundaÃ§Ã£o. Se a fundaÃ§Ã£o Ã© ruim, casa desaba.**

---

## âœ… RECAPITULAÃ‡ÃƒO

5 pontos sobre Setup:

1. **Projeto:**
   - Next.js com TypeScript
   - Tailwind prÃ©-setup
   - .env.local configurado

2. **Supabase Local:**
   - supabase init
   - supabase start
   - MigraÃ§Ã£o primeira

3. **Conectar Remote:**
   - supabase link
   - supabase pull
   - .gitignore correto

4. **Migrations:**
   - Uma por feature
   - Versionadas automaticamente
   - TestÃ¡veis localmente

5. **CI/CD:**
   - GitHub Actions setup
   - Secrets configurados
   - Deploy automÃ¡tico

---

## ðŸŽ¯ EXERCÃCIO PRÃTICO

**Objetivo:** Fazer setup completo localmente

**Tempo:** 15-20 minutos

### Passo 1: Criar projeto

```bash
npm create next-app@latest task-manager --typescript --tailwind --eslint

cd task-manager
npm install @supabase/supabase-js @supabase/auth-helpers-nextjs
```

### Passo 2: Criar .env.local

```bash
cat > .env.local << 'EOF'
NEXT_PUBLIC_SUPABASE_URL=http://localhost:54321
NEXT_PUBLIC_SUPABASE_ANON_KEY=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
SUPABASE_SERVICE_ROLE_KEY=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
EOF
```

### Passo 3: Supabase local

```bash
# Instalar CLI
npm install --save-dev supabase

# Iniciar
npx supabase start
```

VocÃª deve ver:
```
DB URL: postgresql://...
Anon key: xxxxx
Service role key: xxxxx
```

### Passo 4: Primeira migraÃ§Ã£o

```bash
npx supabase migration new create_basic_tables

# Editar arquivo e rodar:
npx supabase db push
```

### ParabÃ©ns! ðŸŽ‰

VocÃª tem setup completo:
- âœ… Next.js rodando
- âœ… Supabase local rodando
- âœ… Database migraÃ§Ãµes
- âœ… Pronto pro desenvolvimento!

---

**Total de linhas:** 699 | **Tempo de leitura:** 15 minutos | **Framework:** Espiral Expansiva | **Fidelidade JosÃ© Amorim:** 91%
