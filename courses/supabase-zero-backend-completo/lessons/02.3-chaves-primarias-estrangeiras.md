# 02.3 - Chaves Prim√°rias e Estrangeiras (CPF das Tabelas)

**M√≥dulo:** 2 - Modelagem Sem Drama
**Dura√ß√£o:** 15 minutos
**Objetivo:** Entender como conectar tabelas de forma segura
**Bloom Level:** Understand

---

## üéØ O Que Voc√™ Vai Aprender

Ao final desta aula, voc√™ vai entender:
- ‚úÖ Chave Prim√°ria (PK) = ID √∫nico de cada registro
- ‚úÖ Chave Estrangeira (FK) = ponteiro para outra tabela
- ‚úÖ Por que se chamam "CPF das tabelas"
- ‚úÖ Como elas garantem dados corretos

---

## üî• GANCHO EMOCIONAL (Camada 1)

Deixa eu te fazer uma pergunta que vai fazer sentido agora...

**Voc√™ tem CPF, certo?**

Seu CPF √©:
- ‚úÖ √önico (ningu√©m tem o teu CPF)
- ‚úÖ Imut√°vel (n√£o muda nunca)
- ‚úÖ Identificador (o governo sabe quem voc√™ √© pelo CPF)

Se voc√™ precisa provar quem voc√™ √©, voc√™ mostra seu **CPF**, n√£o seu nome (porque tem 200 Jo√£o no Brasil).

---

**Banco de dados funciona EXATAMENTE assim.**

Cada registro tem um **ID √∫nico** (como seu CPF).

Quando uma tabela quer apontar pra outra, aponta pro **ID**, n√£o pro nome.

---

Por qu√™?

Porque ID nunca muda.
Porque ID √© √∫nico.
Porque ID √© confi√°vel.

---

## üè† MET√ÅFORA VISUAL (Camada 2)

Imagina um **correio**.

Quando voc√™ quer mandar uma carta, voc√™:

‚ùå **N√ÉO faz isso:**
```
Destinat√°rio: Jo√£o Silva
(porque tem 50 Jo√£o Silva em S√£o Paulo)
```

‚úÖ **Voc√™ faz isso:**
```
Destinat√°rio: CPF 123.456.789-00
(porque √© √∫nico)
```

O correio pega seu CPF, consulta o banco de dados, e sabe EXATAMENTE quem √© voc√™.

---

**Banco de dados √© igual.**

‚ùå **N√ÉO faz isso:**
```
Pedidos
| cliente_nome | produto_nome |
| Jo√£o | Mouse |
```

‚úÖ **Voc√™ faz isso:**
```
Pedidos
| cliente_id | produto_id |
| 1 | 5 |
```

O Supabase pega o cliente_id (1), consulta a tabela Clientes, e sabe EXATAMENTE de quem √© o pedido.

---

## üí° FUNDAMENTO CONCEITUAL (Camada 3)

Agora deixa eu te mostrar tecnicamente (mas sem complica√ß√£o)...

### Chave Prim√°ria (PK - Primary Key)

**O que √©?** √â o **CPF da tabela**. Um ID √∫nico para cada registro.

**Exemplo:**
```
Clientes
| ID | Nome  | Email         |
|----|-------|---------------|
| 1  | Jo√£o  | joao@mail.com | ‚Üê ID √© a Chave Prim√°ria (PK)
| 2  | Maria | maria@mail.com|
| 3  | Pedro | pedro@mail.com|
```

**Caracter√≠sticas:**
- Cada ID √© diferente (n√£o repete)
- Nunca √© vazio
- Nunca muda (mesmo se voc√™ mude o nome)

**No Supabase:** Voc√™ cria assim:
```
CREATE TABLE clientes (
  id SERIAL PRIMARY KEY,  ‚Üê Esta √© a PK
  nome VARCHAR(100),
  email VARCHAR(100)
);
```

O `PRIMARY KEY` diz: "Este campo √© o identificador √∫nico".

---

### Chave Estrangeira (FK - Foreign Key)

**O que √©?** √â um campo que **aponta para a PK de outra tabela**.

**Exemplo:**
```
Clientes
| ID | Nome  |
|----|-------|
| 1  | Jo√£o  |
| 2  | Maria |

Pedidos
| ID | cliente_id | Produto |
|----|------------|---------|
| 1  | 1          | Mouse   | ‚Üê cliente_id √© a FK (aponta pro ID de Clientes)
| 2  | 1          | Teclado |
| 3  | 2          | Monitor |
```

**O que significa?**
- Pedido 1 pertence ao cliente com ID 1 (Jo√£o)
- Pedido 2 tamb√©m pertence ao cliente 1 (Jo√£o)
- Pedido 3 pertence ao cliente 2 (Maria)

**No Supabase:**
```
CREATE TABLE pedidos (
  id SERIAL PRIMARY KEY,
  cliente_id INTEGER REFERENCES clientes(id),  ‚Üê Esta √© a FK
  produto VARCHAR(100)
);
```

O `REFERENCES` diz: "Este campo aponta para a tabela Clientes, campo ID".

---

### PK vs FK (Diferen√ßa R√°pida)

| Aspecto | PK (Prim√°ria) | FK (Estrangeira) |
|---------|---------------|------------------|
| O que √© | ID √∫nico desta tabela | Ponteiro pra outra tabela |
| Exemplo | Cada cliente tem um ID | Pedido aponta pro ID do cliente |
| √önico? | SIM (nunca repete) | N√ÉO (v√°rios pedidos pro mesmo cliente) |
| Pode ser vazio? | N√ÉO | √Äs vezes (pedido an√¥nimo) |

---

## ‚ö° APLICA√á√ÉO PR√ÅTICA (Camada 4)

Vou te mostrar um exemplo completo de PK + FK...

### Cen√°rio Real: App de Tarefas

```
Usu√°rios (Tabela 1)
| ID | Nome  | Email         |
|----|-------|---------------|
| 1  | Jo√£o  | joao@mail.com |
| 2  | Maria | maria@mail.com|

Tarefas (Tabela 2)
| ID | usuario_id | Descri√ß√£o      | Status    |
|----|------------|----------------|-----------|
| 1  | 1          | Comprar leite   | Pendente  |
| 2  | 1          | Limpar casa     | Feito     |
| 3  | 2          | Fazer relat√≥rio | Pendente  |
| 4  | 2          | Estudar SQL     | Feito     |
```

**Lendo isso:**

- Tarefa 1 (ID=1) pertence ao usu√°rio Jo√£o (usuario_id=1)
- Tarefa 2 (ID=2) tamb√©m pertence a Jo√£o
- Tarefa 3 (ID=3) pertence a Maria (usuario_id=2)
- Tarefa 4 (ID=4) tamb√©m pertence a Maria

**Se voc√™ pergunta:** "Quais tarefas o Jo√£o tem?"
**Resposta:** "Busca todas as tarefas onde usuario_id = 1"

Simple assim.

---

### Por Que Isso √â Importante?

**Cen√°rio 1: Sem PK/FK (Bagun√ßa)**
```
Tarefas (BAGUN√áADO)
| usuario_nome | Descri√ß√£o      |
|--------------|----------------|
| Jo√£o | Comprar leite   |
| Jo√£o | Limpar casa     |
| Maria | Fazer relat√≥rio |
```

Problema: Se voc√™ quer excluir as tarefas do Jo√£o, voc√™:
- Busca por "Jo√£o"
- Encontra 2 registros
- **MAS E SE TEM OUTRO JO√ÉO NO SISTEMA?**
- Voc√™ pode acidentalmente excluir a tarefa de outro Jo√£o

---

**Cen√°rio 2: Com PK/FK (Correto)**
```
Tarefas
| usuario_id | Descri√ß√£o      |
|------------|----------------|
| 1 | Comprar leite   |
| 1 | Limpar casa     |
| 2 | Fazer relat√≥rio |
```

Problema resolvido: Se voc√™ quer excluir as tarefas do usu√°rio ID=1:
- Busca por "usuario_id = 1"
- Encontra EXATAMENTE 2 registros
- Exclui sem chance de erro

---

## üåü EXPANS√ÉO FILOS√ìFICA (Camada 5)

Sabe quando voc√™ t√° criando um banco de dados e fica em d√∫vida...

"Ser√° que eu devia usar ID ou nome mesmo?"

Aqui t√° a resposta:

**Nomes mudam.**
**Nomes se repetem.**
**Nomes s√£o imprecisos.**

**IDs s√£o permanentes.**
**IDs s√£o √∫nicos.**
**IDs s√£o confi√°veis.**

Se voc√™ est√° construindo um sistema que precisa ser confi√°vel, use IDs.

---

E sabe qual √© o pensamento de um dev junior que n√£o entende disso?

"Ah, vou guardar o nome mesmo, depois mudo"

Adivinha o que acontece?

6 meses depois, tem dados inconsistentes. Ningu√©m mais confia no banco. Custa 3x mais pra arrumar.

---

**Ent√£o por que eu te conto tudo isso?**

Porque voc√™ est√° COME√áANDO certo.

Voc√™ n√£o vai ser aquele dev junior que cria um bagun√ßo.

Voc√™ vai ser aquele founder tech que cria um banco S√ìLIDO desde o dia 1.

---

## ‚úÖ RECAPITULA√á√ÉO (Valida√ß√£o do Aprendizado)

Antes de ir pra pr√°tica, me responde:

**1. O que √© Chave Prim√°ria?**
Resposta: ID √∫nico de cada registro (como CPF).

**2. O que √© Chave Estrangeira?**
Resposta: Campo que aponta pro ID de outra tabela.

**3. Por que n√£o guardar nome em vez de ID?**
Resposta: Porque nomes mudam, se repetem e s√£o imprecisos.

**4. Qual √© o exemplo que mostrei?**
Resposta: Tarefas com usuario_id apontando pra tabela Usu√°rios.

---

## üéØ PR√ìXIMO PASSO

Na pr√≥xima aula (02.4), vamos:
- ‚úÖ Criar DUAS tabelas no Supabase
- ‚úÖ Conectar com PK + FK
- ‚úÖ Ver funcionando na pr√°tica

E voc√™ vai pensar: "cara, era s√≥ isso? Por que ningu√©m tinha me mostrado isso antes?"

Bora? üöÄ

---

*Aula criada por Jos√© Amorim (Professor Socr√°tico)*
*Framework: Espiral Expansiva + Anti-Impostor Design*
*Dura√ß√£o estimada: 15 minutos*
