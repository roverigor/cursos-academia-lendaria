# 06.5 - OAuth: Login com Google em 3 Passos

**Módulo:** 6 - Autenticação Descomplicada
**Duração:** 12 minutos
**Objetivo:** Configurar e implementar login com Google, GitHub e outros providers OAuth
**Bloom Level:** Apply
**Fidelity Target:** 93%+ (José Amorim voice)

---

## <¯ O Que Você Vai Aprender

Ao final desta aula, você vai saber como:
-  Configurar OAuth Google no Google Cloud
-  Habilitar Google Provider no Supabase
-  Implementar botão "Login com Google"
-  Testar fluxo OAuth completo
-  Fazer o mesmo com GitHub/Facebook

---

## =% GANCHO EMOCIONAL (Camada 1)

Você já viu esse botão:

```
[ =5 Continuar com Google ]
```

E pensou:

"Nossa, isso deve ser super complexo de implementar..."

---

Relaxa.

**São literalmente 3 passos.**

1. Criar OAuth app no Google Cloud
2. Copiar credenciais pro Supabase
3. Adicionar 1 botão no seu HTML

---

Quando você terminar essa aula, você vai ter:
- Login com Google 
- Login com GitHub  (mesmo processo)
- Login com Facebook  (mesmo processo)

---

E confessa que você achava que OAuth era coisa de empresa grande?

Eu também achava.

Até fazer pela primeira vez.

Agora todos meus apps têm.

---

**Você JÁ usou isso.**

Toda vez que você clica em "Continuar com Google" no Notion, Figma, ChatGPT...

É **exatamente** o que vamos implementar.

---

## <à METÁFORA VISUAL (Camada 2)

Imagina um **clube exclusivo com portaria**.

**Método 1: Email/Senha (tradicional)**
```
Você: "Quero entrar"
Porteiro: "Me dá seu nome e senha"
Você: (digita)
Porteiro: (confere) "Ok, pode entrar"
```

---

**Método 2: OAuth Google (atalho)**
```
Você: "Quero entrar"
Porteiro: "Tem conta do Google?"
Você: "Tenho"
Porteiro: "Mostra pro Google que é você"
Você: (confirma no Google)
Google: (fala pro porteiro) "É ele sim"
Porteiro: "Ok, pode entrar"
```

---

**OAuth = Terceiro confiável faz a autenticação.**

Você não precisa criar senha nova.

Usa a do Google, GitHub, Facebook, etc.

---

Google, GitHub, Facebook = **Porteiros de confiança**.

Seu app pergunta pra eles: "É ele mesmo?"

Eles respondem: "Sim, é ele."

Pronto.

---

## =¡ FUNDAMENTO CONCEITUAL (Camada 3)

Deixa eu explicar como OAuth funciona...

### O Que É OAuth?

**OAuth = Open Authorization**

É um protocolo que permite que um app (seu) peça permissão pra outro app (Google) autenticar o usuário.

---

### Fluxo OAuth (Simplificado)

```
Usuário clica em "Login com Google"
  “
App redireciona pra Google
  “
Google pergunta: "Você autoriza este app?"
  “
Usuário clica "Sim"
  “
Google redireciona de volta pro app com código
  “
App envia código pro Supabase
  “
Supabase valida com Google
  “
Google confirma: "É ele mesmo"
  “
Supabase cria sessão
  “
Usuário logado
```

---

### Por Que Usar OAuth?

**Vantagens:**
-  Usuário não precisa criar senha nova
-  Menos fricção (1 clique)
-  Mais seguro (Google gerencia senha)
-  Menos preocupação com vazamentos

**Desvantagens:**
- L Depende de terceiro (se Google cair, login cai)
- L Precisa configurar (mas é fácil)

---

### Providers Que Supabase Suporta

- Google 
- GitHub 
- Facebook 
- Twitter 
- Discord 
- LinkedIn 
- Slack 
- Spotify 
- E mais 15+

**Todos funcionam igual.**

Você só muda o nome do provider.

---

## ¡ APLICAÇÃO PRÁTICA (Camada 4)

Agora vamos configurar Google OAuth do zero.

### Passo 1: Criar OAuth App no Google Cloud

1. Abre [Google Cloud Console](https://console.cloud.google.com)
2. Cria novo projeto (ou usa existente)
3. Vai em **APIs & Services ’ Credentials**
4. Clica **"Create Credentials" ’ "OAuth 2.0 Client ID"**

---

5. Preenche:
   - **Application type:** Web application
   - **Name:** Meu App Supabase
   - **Authorized redirect URIs:**
     ```
     https://SEU_PROJETO.supabase.co/auth/v1/callback
     ```
     (Pega essa URL no Supabase em Authentication ’ Providers ’ Google)

6. Clica **"Create"**

---

7. Google vai te dar:
   ```
   Client ID: 123456789-abc.apps.googleusercontent.com
   Client Secret: GOCSPX-abc123...
   ```

**Copia os dois.**

---

### Passo 2: Configurar Google Provider no Supabase

1. Abre seu projeto Supabase
2. Vai em **Authentication ’ Providers**
3. Procura **Google**
4. Clica pra expandir

---

5. Preenche:
   ```
   Client ID: (cola aqui)
   Client Secret: (cola aqui)
   ```

6. Marca **"Enable Sign in with Google"**

7. Clica **"Save"**

---

**Pronto.**

Google OAuth configurado.

**Tempo: 3 minutos.**

---

### Passo 3: Implementar Botão "Login com Google"

```html
<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Login com Google</title>
</head>
<body>

  <h2>Entrar</h2>

  <button onclick="handleGoogleLogin()">
    =5 Continuar com Google
  </button>

  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script>
    const supabase = window.supabase.createClient('URL', 'KEY')

    async function handleGoogleLogin() {
      const { data, error } = await supabase.auth.signInWithOAuth({
        provider: 'google'
      })

      if (error) {
        alert('Erro: ' + error.message)
      }
    }
  </script>
</body>
</html>
```

---

**O que acontece:**

1. Usuário clica no botão
2. `signInWithOAuth({ provider: 'google' })` é chamado
3. Supabase redireciona pra Google
4. Usuário autoriza no Google
5. Google redireciona de volta
6. Supabase cria sessão automaticamente
7. Usuário logado

---

### Passo 4: Verificar Usuário Logado Após Redirect

Quando Google redireciona de volta, você precisa capturar a sessão:

```javascript
// Verifica se usuário tá logado
supabase.auth.getSession().then(({ data: { session } }) => {
  if (session) {
    console.log('Usuário logado:', session.user.email)
    // Redireciona pro dashboard
    window.location.href = '/dashboard.html'
  }
})

// Ou escuta mudanças de sessão
supabase.auth.onAuthStateChange((event, session) => {
  if (event === 'SIGNED_IN') {
    console.log('Logou com:', session.user.email)
    window.location.href = '/dashboard.html'
  }
})
```

---

### Passo 5: Login com GitHub (Mesmo Processo)

**Google Cloud ’ GitHub Settings:**

1. Vai em [GitHub Developer Settings](https://github.com/settings/developers)
2. Clica **"New OAuth App"**
3. Preenche:
   ```
   Application name: Meu App
   Homepage URL: https://seusite.com
   Authorization callback URL: https://SEU_PROJETO.supabase.co/auth/v1/callback
   ```
4. Copia **Client ID** e **Client Secret**

---

**Supabase:**

1. Authentication ’ Providers ’ **GitHub**
2. Cola Client ID e Secret
3. Marca "Enable Sign in with GitHub"
4. Salva

---

**HTML:**

```html
<button onclick="handleGitHubLogin()">
  = Continuar com GitHub
</button>

<script>
async function handleGitHubLogin() {
  await supabase.auth.signInWithOAuth({
    provider: 'github'
  })
}
</script>
```

---

### Exemplo Completo: Múltiplos Providers

```html
<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Login</title>
  <style>
    button {
      padding: 10px 20px;
      margin: 10px;
      font-size: 16px;
      cursor: pointer;
      border: none;
      border-radius: 5px;
    }
    .google { background: #4285f4; color: white; }
    .github { background: #333; color: white; }
    .facebook { background: #1877f2; color: white; }
  </style>
</head>
<body>

  <h2>Escolha como entrar:</h2>

  <button class="google" onclick="login('google')">
    =5 Continuar com Google
  </button>

  <button class="github" onclick="login('github')">
    = Continuar com GitHub
  </button>

  <button class="facebook" onclick="login('facebook')">
    =Ø Continuar com Facebook
  </button>

  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script>
    const supabase = window.supabase.createClient('URL', 'KEY')

    async function login(provider) {
      const { error } = await supabase.auth.signInWithOAuth({
        provider: provider
      })

      if (error) {
        alert('Erro: ' + error.message)
      }
    }

    // Detecta quando usuário volta logado
    supabase.auth.onAuthStateChange((event, session) => {
      if (event === 'SIGNED_IN') {
        console.log('Logou com:', session.user.email)
        console.log('Provider usado:', session.user.app_metadata.provider)
        window.location.href = '/dashboard.html'
      }
    })
  </script>
</body>
</html>
```

---

### Exemplo Avançado: Pegar Dados do Google

Quando usuário loga com Google, você pode pegar dados extras:

```javascript
supabase.auth.onAuthStateChange((event, session) => {
  if (event === 'SIGNED_IN') {
    const user = session.user

    console.log('Email:', user.email)
    console.log('Nome:', user.user_metadata.full_name)
    console.log('Foto:', user.user_metadata.avatar_url)
    console.log('Provider:', user.app_metadata.provider) // 'google'
  }
})
```

---

## < EXPANSÃO FILOSÓFICA (Camada 5)

Sabe o que acabou de acontecer?

Você implementou **login social**.

O mesmo que:
- Notion usa
- Figma usa
- ChatGPT usa
- Vercel usa

---

Antigamente, implementar OAuth levava **3 dias**.

Porque você tinha que:
- Estudar protocolo OAuth 2.0
- Registrar app no Google Cloud
- Implementar callback
- Trocar código por token
- Validar token
- Criar sessão manualmente

**3 dias.**

---

Agora?

**1 método.**

`signInWithOAuth({ provider: 'google' })`.

---

E confessa que você achou mais fácil do que esperava?

Eu também.

Na primeira vez que fiz, eu pensei:

"Espera... isso TÁ funcionando?"

Sim.

---

Porque Supabase:
- Já tem integração com 20+ providers
- Gerencia tokens automaticamente
- Cria sessões
- Armazena usuários
- Renova tokens

**Tudo automático.**

---

**Você JÁ usou isso.**

Toda vez que você clica em "Continuar com Google" no Notion, Figma, ChatGPT...

É **exatamente** esse fluxo.

Só que agora VOCÊ é quem tá implementando.

---

##  RECAPITULAÇÃO (Validação do Aprendizado)

Antes de ir pro exercício, me responde:

**1. Quantos passos tem pra configurar OAuth Google?**
Resposta: 3 (Google Cloud ’ Supabase ’ HTML)

**2. Qual método implementa login social?**
Resposta: `signInWithOAuth({ provider: 'nome' })`

**3. Supabase suporta quantos providers OAuth?**
Resposta: 20+ (Google, GitHub, Facebook, Twitter, Discord, etc)

**4. Você precisa gerenciar tokens OAuth manualmente?**
Resposta: Não, Supabase faz automaticamente

**5. Como você detecta quando usuário volta logado?**
Resposta: `supabase.auth.onAuthStateChange()`

---

## =Ý EXERCÍCIO PRÁTICO

Agora é SUA vez.

**Seu desafio:**

1. Configura OAuth Google no Google Cloud
2. Habilita Google Provider no Supabase
3. Cria página com botão "Login com Google"
4. Testa o fluxo completo
5. (Bonus) Adiciona GitHub também

---

**Gabarito esperado:**

```html
<!DOCTYPE html>
<html>
<head>
  <title>Login Social</title>
  <style>
    button {
      padding: 15px 30px;
      margin: 10px;
      font-size: 16px;
      cursor: pointer;
      border: none;
      border-radius: 8px;
    }
    .google { background: #4285f4; color: white; }
    .github { background: #333; color: white; }
  </style>
</head>
<body>
  <h1>Entrar</h1>

  <button class="google" onclick="loginGoogle()">
    =5 Continuar com Google
  </button>

  <button class="github" onclick="loginGitHub()">
    = Continuar com GitHub
  </button>

  <div id="user-info" style="display: none;">
    <h2>Bem-vindo!</h2>
    <p id="email"></p>
    <p id="name"></p>
    <img id="avatar" width="100" />
  </div>

  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script>
    const supabase = window.supabase.createClient('URL', 'KEY')

    async function loginGoogle() {
      await supabase.auth.signInWithOAuth({ provider: 'google' })
    }

    async function loginGitHub() {
      await supabase.auth.signInWithOAuth({ provider: 'github' })
    }

    // Detecta login
    supabase.auth.onAuthStateChange((event, session) => {
      if (event === 'SIGNED_IN') {
        const user = session.user
        document.getElementById('user-info').style.display = 'block'
        document.getElementById('email').textContent = user.email
        document.getElementById('name').textContent = user.user_metadata.full_name
        document.getElementById('avatar').src = user.user_metadata.avatar_url
      }
    })
  </script>
</body>
</html>
```

---

**Teste:**

1. Abre no navegador
2. Clica em "Login com Google"
3. Autoriza no Google
4. Volta pro app
5. Vê informações aparecendo (email, nome, foto)

---

## =Ë CHECKLIST ANTES DE CONTINUAR

Você consegue:
- [ ] Criar OAuth app no Google Cloud
- [ ] Configurar provider no Supabase
- [ ] Implementar botão de login social
- [ ] Detectar quando usuário volta logado
- [ ] Pegar dados extras (nome, foto)

Se marcou os 5, vamos pra próxima! =€

---

## <¯ PRÓXIMO PASSO

Na próxima aula (06.6), vamos:

1. Proteger páginas (só logados acessam)
2. Criar middleware de autenticação
3. Implementar RLS (Row Level Security) básico
4. Redirecionar usuários não autenticados

**Segurança completa.**

Bora? =€

---

**Metadados da Aula:**
- Criada por: José Amorim (Professor Socrático)
- Framework: Espiral Expansiva + Anti-Impostor Design
- Duração estimada: 12 minutos
- Alignment Target: 95%+ (Objetivo ” Conteúdo ” Exercício)
- Fidelity Target: 93%+ (Voice José Amorim)
- Completeness: 100% (7 camadas + exercício + checklist)
