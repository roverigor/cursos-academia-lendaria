# ROTEIRO TELEPROMPTER - Aula 2.10: Integração CRM

**Duração:** 15 min

---

## [00:00-00:30] PROBLEMA

Dados espalhados:
- Leads no PostgreSQL (AI)
- Leads no HubSpot (humanos)
- Duplicatas. Caos.

Solução: Integração bidirecional.

---

## [00:30-03:00] HUBSPOT INTEGRATION

**[SCREENCAST: HubSpot API]**

1. Settings → API → Generate Key
2. Copiar key
3. .env: `HUBSPOT_API_KEY=...`

---

## [03:00-07:00] N8N SYNC

**[MOSTRA workflow]**

```
PostgreSQL new lead → HubSpot Upsert → Add Note
```

**[n8n HubSpot node]**

```json
{
  "operation": "upsert",
  "email": "{{ $json.email }}",
  "properties": {
    "firstname": "{{ $json.first_name }}",
    "company": "{{ $json.company }}",
    "lead_score": "{{ $json.lead_score }}",
    "lead_source": "{{ $json.source }}"
  }
}
```

**[EXECUTA]**

Lead criado no HubSpot!

---

## [07:00-10:00] CUSTOM PROPERTIES

**[MOSTRA HubSpot settings]**

Criar properties:
- lead_score (Number)
- lead_source (Text)
- ai_sequence_status (Dropdown)
- ai_touch_count (Number)

**[MAPPING]**

PostgreSQL → HubSpot custom fields.

---

## [10:00-12:30] BIDIRECTIONAL SYNC

**[WEBHOOK: HubSpot → n8n]**

Quando SDR marca lead como "Disqualified" no HubSpot:

**[n8n webhook]**

```javascript
if (update.hs_lead_status === 'disqualified') {
  await db.query(
    'UPDATE leads SET sequence_stopped = TRUE WHERE email = ?',
    [email]
  );
}
```

Pára sequência AI automaticamente.

---

## [12:30-14:30] EVITAR DUPLICATAS

**[MOSTRA lógica]**

```javascript
// Upsert (not insert)
operation: 'upsert',
uniqueKey: 'email'

// HubSpot usa email como unique identifier
// Se existe → update
// Se não existe → create
```

Zero duplicatas.

---

## [14:30-15:00] RECAP

CRM Integration:
- HubSpot API
- Sync PostgreSQL → HubSpot
- Custom properties
- Webhook bidirectional
- Upsert para evitar duplicatas

Próxima: SDR Automation (Cold Email GPT-4).

Até!

**[FIM]**
