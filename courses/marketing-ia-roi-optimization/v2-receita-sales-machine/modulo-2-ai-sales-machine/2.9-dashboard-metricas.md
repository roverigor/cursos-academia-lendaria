# Aula 2.9: Dashboard de MÃ©tricas (Real-Time Analytics)

**MÃ³dulo:** 2 - AI Sales Machine
**NÃ­vel:** 2 (FuncionÃ¡rio Aprendendo)
**DuraÃ§Ã£o:** 15 minutos

---

## ðŸŽ¯ Objetivos

1. Criar dashboard real-time com mÃ©tricas-chave
2. Visualizar funil completo (1.500 leads â†’ 9 vendas)
3. Monitorar ROI em tempo real
4. Alertas automÃ¡ticos (quando mÃ©trica cai)
5. Usar Metabase/Grafana (open-source)

---

## ðŸ“Š MÃ©tricas-Chave (North Star Metrics)

### Tier 1: Revenue Metrics
```
1. Receita Mensal: R$ 45.000
2. Vendas Fechadas: 9/mÃªs
3. Ticket MÃ©dio: R$ 5.000
4. ROI Total: R$ 58.000/mÃªs
```

### Tier 2: Funnel Metrics
```
5. Leads Gerados: 1.500/mÃªs
6. Leads Qualificados (score > 70): 450/mÃªs (30%)
7. Outreach Iniciado: 450/mÃªs
8. Respostas: 90/mÃªs (20% reply rate)
9. ReuniÃµes Agendadas: 45/mÃªs (10% meeting rate)
10. Propostas Enviadas: 18/mÃªs (40% proposal rate)
11. Vendas Fechadas: 9/mÃªs (50% close rate)
```

### Tier 3: Efficiency Metrics
```
12. CAC (Customer Acquisition Cost): R$ 667
13. LTV/CAC Ratio: 7.5x
14. Payback Period: 1.3 meses
15. Custo por Lead: R$ 1.33
16. Custo por ReuniÃ£o: R$ 133
```

---

## ðŸ—ï¸ Stack de Dashboard

### OpÃ§Ã£o 1: Metabase (Recomendado - GrÃ¡tis)

**Por quÃª Metabase?**
- âœ… Open-source (grÃ¡tis)
- âœ… Conecta direto no PostgreSQL
- âœ… Drag-and-drop interface
- âœ… Auto-refresh (real-time)
- âœ… Mobile-friendly

**Setup:**
```bash
# Docker Metabase
docker run -d -p 3000:3000 \
  -e MB_DB_TYPE=postgres \
  -e MB_DB_HOST=seu-postgres-host \
  -e MB_DB_PORT=5432 \
  -e MB_DB_USER=postgres \
  -e MB_DB_PASS=senha \
  metabase/metabase
```

### OpÃ§Ã£o 2: Grafana + PostgreSQL

**Setup:**
```bash
# Docker Grafana
docker run -d -p 3001:3000 grafana/grafana

# Adicionar PostgreSQL datasource
# Importar dashboard template
```

---

## ðŸ“ˆ Queries SQL para Dashboard

### Query 1: Funil Completo

```sql
WITH funnel AS (
    SELECT
        COUNT(*) FILTER (WHERE stage = 'prospected') as leads_gerados,
        COUNT(*) FILTER (WHERE lead_score >= 70) as leads_qualificados,
        COUNT(*) FILTER (WHERE stage = 'sdr_outreach') as outreach_iniciado,
        COUNT(*) FILTER (WHERE replied = true) as respostas,
        COUNT(*) FILTER (WHERE meeting_booked = true) as reunioes,
        COUNT(*) FILTER (WHERE stage = 'proposal_sent') as propostas,
        COUNT(*) FILTER (WHERE stage = 'closed_won') as vendas
    FROM leads
    WHERE created_at >= DATE_TRUNC('month', CURRENT_DATE)
)
SELECT
    leads_gerados,
    leads_qualificados,
    ROUND(leads_qualificados::NUMERIC / leads_gerados * 100, 1) as qualify_rate,
    outreach_iniciado,
    respostas,
    ROUND(respostas::NUMERIC / outreach_iniciado * 100, 1) as reply_rate,
    reunioes,
    ROUND(reunioes::NUMERIC / respostas * 100, 1) as meeting_rate,
    propostas,
    ROUND(propostas::NUMERIC / reunioes * 100, 1) as proposal_rate,
    vendas,
    ROUND(vendas::NUMERIC / propostas * 100, 1) as close_rate
FROM funnel;
```

### Query 2: ROI Mensal

```sql
SELECT
    DATE_TRUNC('month', closed_at) as mes,
    COUNT(*) as vendas,
    SUM(closed_value) as receita,
    SUM(closed_value) - 2000 as lucro_liquido, -- R$ 2k custo AI system
    ROUND((SUM(closed_value) - 2000) / 2000 * 100, 0) as roi_pct
FROM leads
WHERE stage = 'closed_won'
AND closed_at >= DATE_TRUNC('month', CURRENT_DATE - INTERVAL '6 months')
GROUP BY DATE_TRUNC('month', closed_at)
ORDER BY mes DESC;
```

### Query 3: Performance por Fonte

```sql
SELECT
    source,
    COUNT(*) as leads,
    COUNT(*) FILTER (WHERE lead_score >= 70) as qualificados,
    COUNT(*) FILTER (WHERE replied = true) as respostas,
    COUNT(*) FILTER (WHERE meeting_booked = true) as reunioes,
    COUNT(*) FILTER (WHERE stage = 'closed_won') as vendas,
    ROUND(COUNT(*) FILTER (WHERE stage = 'closed_won')::NUMERIC / COUNT(*) * 100, 2) as conversion_rate,
    SUM(closed_value) FILTER (WHERE stage = 'closed_won') as receita
FROM leads
WHERE created_at >= DATE_TRUNC('month', CURRENT_DATE)
GROUP BY source
ORDER BY receita DESC NULLS LAST;
```

**Resultado esperado:**
```
source        | leads | qualificados | respostas | reunioes | vendas | conversion | receita
--------------|-------|--------------|-----------|----------|--------|------------|--------
apollo        |   200 |          180 |        50 |       25 |      5 |      2.50% | R$ 25k
linkedin      |   500 |          300 |        70 |       15 |      3 |      0.60% | R$ 15k
google_maps   |   800 |          150 |        30 |        5 |      1 |      0.12% | R$  5k
```

**Insight:** Apollo tem menor volume mas melhor conversÃ£o (2.5% vs 0.6%)

### Query 4: Lead Score Distribution

```sql
SELECT
    CASE
        WHEN lead_score >= 90 THEN '90-100 (Hot)'
        WHEN lead_score >= 70 THEN '70-89 (Warm)'
        WHEN lead_score >= 50 THEN '50-69 (Qualified)'
        WHEN lead_score >= 30 THEN '30-49 (Cold)'
        ELSE '0-29 (Disqualified)'
    END as score_bucket,
    COUNT(*) as leads,
    COUNT(*) FILTER (WHERE stage = 'closed_won') as vendas,
    ROUND(COUNT(*) FILTER (WHERE stage = 'closed_won')::NUMERIC / COUNT(*) * 100, 1) as close_rate
FROM leads
WHERE created_at >= DATE_TRUNC('month', CURRENT_DATE)
GROUP BY score_bucket
ORDER BY score_bucket DESC;
```

### Query 5: Custo por AquisiÃ§Ã£o (CAC)

```sql
SELECT
    DATE_TRUNC('month', created_at) as mes,
    COUNT(*) FILTER (WHERE stage = 'closed_won') as clientes,
    2000 as custo_mensal, -- R$ 2k (ferramentas)
    ROUND(2000.0 / COUNT(*) FILTER (WHERE stage = 'closed_won'), 0) as cac
FROM leads
GROUP BY DATE_TRUNC('month', created_at)
ORDER BY mes DESC
LIMIT 6;
```

---

## ðŸ“Š Layout do Dashboard

### Tela 1: Overview (Homepage)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ðŸ“Š AI SALES MACHINE - Dashboard                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ Leads    â”‚ ReuniÃµes â”‚ Vendas   â”‚ Receita  â”‚   â”‚
â”‚  â”‚ 1.500    â”‚ 45       â”‚ 9        â”‚ R$ 45k   â”‚   â”‚
â”‚  â”‚ â†‘ 400%   â”‚ â†‘ 650%   â”‚ â†‘ 800%   â”‚ â†‘ 800%   â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                     â”‚
â”‚  FUNIL DE VENDAS                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ 1,500 leads â”€â”€â”€â”€â”€â†’ 30% â”€â”€â”€â”€â†’ 450 qualif.    â”‚ â”‚
â”‚  â”‚ 450 outreach â”€â”€â”€â”€â†’ 20% â”€â”€â”€â”€â†’ 90 respostas   â”‚ â”‚
â”‚  â”‚ 90 respostas â”€â”€â”€â”€â†’ 50% â”€â”€â”€â”€â†’ 45 reuniÃµes    â”‚ â”‚
â”‚  â”‚ 45 reuniÃµes â”€â”€â”€â”€â”€â†’ 40% â”€â”€â”€â”€â†’ 18 propostas   â”‚ â”‚
â”‚  â”‚ 18 propostas â”€â”€â”€â”€â†’ 50% â”€â”€â”€â”€â†’ 9 vendas       â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                     â”‚
â”‚  ROI                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ Receita: +R$ 40.000                          â”‚ â”‚
â”‚  â”‚ Economia: +R$ 18.000                         â”‚ â”‚
â”‚  â”‚ Custo: -R$ 2.000                             â”‚ â”‚
â”‚  â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                     â”‚ â”‚
â”‚  â”‚ LÃQUIDO: +R$ 56.000/mÃªs (2.800% ROI)        â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Tela 2: Detalhamento por Fonte

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Performance por Fonte de Leads                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                     â”‚
â”‚  ðŸ“Š GrÃ¡fico de Barras (Horizontal)                 â”‚
â”‚                                                     â”‚
â”‚  Apollo       â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ 200 leads â†’ 5 vendas    â”‚
â”‚  LinkedIn     â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ 500 â†’ 3 vendas    â”‚
â”‚  Google Maps  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ 800 â†’ 1 vda â”‚
â”‚                                                     â”‚
â”‚  ConversÃ£o:                                         â”‚
â”‚  Apollo: 2.5% â­â­â­â­â­                            â”‚
â”‚  LinkedIn: 0.6% â­â­â­                              â”‚
â”‚  Google Maps: 0.12% â­                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Tela 3: Real-Time Activity Feed

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ðŸ”´ LIVE Activity Feed                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                     â”‚
â”‚  âœ… 10:23 - JoÃ£o Silva abriu email (3x)            â”‚
â”‚  ðŸ“§ 10:21 - Maria Costa respondeu positivamente     â”‚
â”‚  ðŸ“… 10:18 - Pedro Santos agendou reuniÃ£o            â”‚
â”‚  ðŸ’° 10:15 - Ana Lima assinou contrato (R$ 5k)      â”‚
â”‚  âŒ 10:12 - Carlos Dias deu unsubscribe            â”‚
â”‚  ðŸ“§ 10:10 - 50 emails enviados (batch)             â”‚
â”‚                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ðŸš¨ Alertas AutomÃ¡ticos

### Setup: n8n â†’ Slack Alerts

```javascript
// Check metrics every hour
const metrics = await db.query(`
    SELECT
        COUNT(*) FILTER (WHERE created_at > NOW() - INTERVAL '24 hours') as leads_24h,
        COUNT(*) FILTER (WHERE replied = true AND reply_time > NOW() - INTERVAL '1 hour') as replies_1h,
        COUNT(*) FILTER (WHERE meeting_booked = true AND meeting_date > NOW() - INTERVAL '1 hour') as meetings_1h
    FROM leads
`);

// Alert if leads drop below threshold
if (metrics.leads_24h < 50) {
    await slack.send({
        channel: '#alerts',
        message: `âš ï¸ ALERTA: Apenas ${metrics.leads_24h} leads nas Ãºltimas 24h (esperado: 60+)\nVerificar:\n- Phantom Buster rodando?\n- Apollo API funcionando?\n- Google Maps scraper ativo?`
    });
}

// Alert on positive events
if (metrics.meetings_1h > 0) {
    await slack.send({
        channel: '#sales',
        message: `ðŸŽ‰ ${metrics.meetings_1h} reuniÃ£o(Ãµes) agendada(s) na Ãºltima hora!`
    });
}
```

---

## âœ… EntregÃ¡vel

```
dashboard/
â”œâ”€â”€ metabase-dashboard-config.json
â”œâ”€â”€ sql-queries/
â”‚   â”œâ”€â”€ funnel-metrics.sql
â”‚   â”œâ”€â”€ roi-calculation.sql
â”‚   â”œâ”€â”€ source-performance.sql
â”‚   â””â”€â”€ lead-score-distribution.sql
â””â”€â”€ alerts/
    â””â”€â”€ n8n-slack-alerts.json
```

---

## ðŸŽ¯ Checklist

- [ ] Metabase instalado e conectado ao PostgreSQL
- [ ] Dashboard homepage com mÃ©tricas principais
- [ ] Funil de vendas visual (1.500 â†’ 9)
- [ ] Performance por fonte (Apollo vs LinkedIn vs Google Maps)
- [ ] ROI em tempo real (+R$ 56k/mÃªs)
- [ ] Alertas Slack configurados
- [ ] Mobile-friendly (acessar do celular)

---

**ðŸŽ“ Conceito-chave:** Dashboard nÃ£o Ã© sÃ³ bonito - Ã© ferramenta de decisÃ£o. Se Apollo converte 2.5% e Google Maps 0.12%, invista mais em Apollo.
