# Aula 2.5: Apollo Search & Enrich

**MÃ³dulo:** 2 - AI Sales Machine
**NÃ­vel:** 2 (FuncionÃ¡rio Aprendendo - construir do zero)
**DuraÃ§Ã£o:** 15 minutos
**Ferramentas:** Apollo.io, n8n, PostgreSQL

---

## ðŸŽ¯ Objetivos de Aprendizagem

Ao final desta aula, vocÃª serÃ¡ capaz de:

1. **Buscar leads diretamente no Apollo** (200+ milhÃµes de contatos B2B)
2. **Enriquecer leads existentes** (adicionar email, telefone, tech stack)
3. **Usar filtros avanÃ§ados** (funding, hiring, technologies, intent signals)
4. **Integrar Apollo â†’ n8n â†’ PostgreSQL** automaticamente
5. **Otimizar crÃ©ditos Apollo** para mÃ¡ximo ROI

---

## ðŸ“Š Contexto: Por Que Apollo?

### Apollo.io = Maior Database B2B + Enriquecimento

**Dados:**
- ðŸ“Š **275 milhÃµes** de contatos
- ðŸ¢ **70 milhÃµes** de empresas
- ðŸŒŽ **Cobertura global** (foco EUA, mas tem Brasil)
- ðŸŽ¯ **95%+ accuracy** em emails verificados
- ðŸ” **65+ filtros** de busca (tech stack, funding, hiring, intent)

### Apollo vs Outras Ferramentas

| Feature | Apollo | ZoomInfo | Hunter | Snov.io |
|---------|--------|----------|--------|---------|
| **Database size** | 275M | 135M | 100M | 50M |
| **Email accuracy** | 95% | 93% | 87% | 82% |
| **Tech stack data** | âœ… 10k+ techs | âœ… 5k+ | âŒ | âŒ |
| **Funding data** | âœ… | âœ… | âŒ | âŒ |
| **API access** | âœ… | âœ… Premium | âœ… | âœ… |
| **PreÃ§o** | R$ 499/mÃªs | R$ 8k+/mÃªs | R$ 199/mÃªs | R$ 189/mÃªs |

**ConclusÃ£o:** Apollo = melhor custo-benefÃ­cio para B2B tech.

---

## ðŸ—ï¸ Estrutura da Aula (15 min)

```
00:00 - 02:00 | IntroduÃ§Ã£o: Apollo database vs scraping
02:00 - 05:00 | Setup Apollo + obter API key
05:00 - 08:00 | Busca avanÃ§ada (Search API)
08:00 - 11:00 | Enriquecimento (Enrichment API)
11:00 - 13:00 | IntegraÃ§Ã£o n8n completa
13:00 - 15:00 | OtimizaÃ§Ã£o de crÃ©ditos + ROI
```

---

## ðŸ”§ Setup Inicial

### 1. Criar Conta Apollo

1. Ir para [apollo.io](https://www.apollo.io/)
2. **Free trial:** 50 crÃ©ditos/mÃªs grÃ¡tis
3. **Plano recomendado:** Basic (R$ 499/mÃªs) = 10.000 crÃ©ditos/mÃªs

**O que sÃ£o crÃ©ditos?**
- 1 crÃ©dito = 1 email revelado
- 1 crÃ©dito = 1 enriquecimento de lead
- Busca sem revelar email = 0 crÃ©ditos

**CÃ¡lculo:**
- 10.000 crÃ©ditos Ã· 200 leads/mÃªs = 50 crÃ©ditos/lead (reveal + 49 data points)
- TÃ­pico: 2-5 crÃ©ditos/lead (email + phone + company data)

### 2. Obter API Key

1. Apollo â†’ **Settings** â†’ **API**
2. **Generate API Key**
3. Copiar key: `xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx`

**âš ï¸ SEGURANÃ‡A:** Nunca commitar API key no GitHub. Use `.env`:

```bash
# .env file
APOLLO_API_KEY=your_key_here_xxxxxxxxxxxxx
```

---

## ðŸ” Apollo Search API (Buscar Leads)

### Use Case: Buscar 200 CTOs de SaaS com funding

**Endpoint:** `POST https://api.apollo.io/v1/mixed_people/search`

### Exemplo: n8n HTTP Request

```json
{
  "name": "Apollo Search - CTOs SaaS",
  "type": "n8n-nodes-base.httpRequest",
  "parameters": {
    "url": "https://api.apollo.io/v1/mixed_people/search",
    "method": "POST",
    "authentication": "headerAuth",
    "headerParameters": {
      "parameters": [
        {
          "name": "X-Api-Key",
          "value": "={{ $env.APOLLO_API_KEY }}"
        }
      ]
    },
    "bodyParameters": {
      "parameters": [
        {
          "name": "person_titles",
          "value": ["CTO", "VP Engineering", "Head of Engineering"]
        },
        {
          "name": "organization_num_employees_ranges",
          "value": ["51-200", "201-500"]
        },
        {
          "name": "organization_industry_tag_ids",
          "value": ["5567cd4773696439b10b0000"]
        },
        {
          "name": "organization_locations",
          "value": ["Brazil"]
        },
        {
          "name": "organization_latest_funding_stage_cd",
          "value": ["seed", "series_a", "series_b"]
        },
        {
          "name": "page", "value": 1
        },
        {
          "name": "per_page", "value": 100
        }
      ]
    },
    "options": {
      "response": {
        "response": {
          "fullResponse": false,
          "neverError": true
        }
      }
    }
  }
}
```

### Filtros Mais Importantes

#### 1. **Pessoa (Person)**

```javascript
{
  "person_titles": ["CEO", "Founder", "CMO"],
  "person_seniorities": ["owner", "c_suite", "vp"],
  "person_locations": ["SÃ£o Paulo, Brazil", "Rio de Janeiro, Brazil"]
}
```

#### 2. **Empresa (Organization)**

```javascript
{
  "organization_num_employees_ranges": ["11-50", "51-200"],
  "organization_industry_tag_ids": ["5567cd4773696439b10b0000"], // SaaS
  "organization_locations": ["Brazil"],
  "organization_latest_funding_stage_cd": ["seed", "series_a"]
}
```

#### 3. **Tecnologias Usadas (ðŸ”¥ Game changer)**

```javascript
{
  "currently_using_any_of_technology_uids": [
    "salesforce", // CRM Salesforce
    "hubspot",    // HubSpot
    "stripe",     // Pagamentos Stripe
    "intercom"    // Live chat
  ]
}
```

**Use case:** "Buscar empresas que usam Salesforce" = elas jÃ¡ investem em sales tech!

#### 4. **Sinais de IntenÃ§Ã£o (Intent Signals)**

```javascript
{
  "organization_latest_funding_stage_cd": ["seed", "series_a"], // Levantou funding
  "organization_is_hiring": true,                               // EstÃ¡ contratando
  "person_extrapolated_email_confidence": 95                    // Email high confidence
}
```

**Por que isso importa:**
- Levantou funding = tem budget
- Contratando = crescendo = precisa de ferramentas
- Email alta confianÃ§a = menos bounce

### Processar Resultados

```json
{
  "name": "Extract Apollo Results",
  "type": "n8n-nodes-base.function",
  "parameters": {
    "functionCode": "const response = $input.first().json;\nconst people = response.people;\n\nreturn people.map(person => ({\n  json: {\n    // Person\n    name: person.name,\n    email: person.email,\n    phone: person.phone_numbers?.[0]?.sanitized_number,\n    linkedin_url: person.linkedin_url,\n    title: person.title,\n    seniority: person.seniority,\n    \n    // Organization\n    company: person.organization?.name,\n    company_size: person.organization?.estimated_num_employees,\n    industry: person.organization?.industry,\n    website: person.organization?.website_url,\n    funding_stage: person.organization?.latest_funding_stage,\n    funding_amount: person.organization?.total_funding,\n    technologies: person.organization?.current_technologies?.map(t => t.name),\n    \n    // Source\n    source: 'apollo',\n    source_id: person.id,\n    \n    // Enrichment\n    enrichment_data: person\n  }\n}));"
  }
}
```

---

## ðŸ”¬ Apollo Enrichment API (Enriquecer Leads)

### Use Case: VocÃª tem email do Google Maps, quer adicionar cargo + empresa

**Endpoint:** `POST https://api.apollo.io/v1/people/match`

### Exemplo: Enriquecer Lead do Google Maps

```json
{
  "name": "Apollo Enrich - Match Person",
  "type": "n8n-nodes-base.httpRequest",
  "parameters": {
    "url": "https://api.apollo.io/v1/people/match",
    "method": "POST",
    "authentication": "headerAuth",
    "headerParameters": {
      "parameters": [
        { "name": "X-Api-Key", "value": "={{ $env.APOLLO_API_KEY }}" }
      ]
    },
    "bodyParameters": {
      "parameters": [
        { "name": "email", "value": "={{ $json.email }}" },
        { "name": "organization_name", "value": "={{ $json.company }}" }
      ]
    }
  }
}
```

**Input:**
```json
{
  "email": "joao@techcorp.com",
  "company": "TechCorp"
}
```

**Output Apollo:**
```json
{
  "person": {
    "id": "5f5e2b4a4d3b2a001f3e4d5c",
    "first_name": "JoÃ£o",
    "last_name": "Silva",
    "title": "CEO",
    "seniority": "owner",
    "linkedin_url": "https://linkedin.com/in/joaosilva",
    "phone_numbers": [
      { "sanitized_number": "+5511999999999" }
    ],
    "organization": {
      "name": "TechCorp",
      "num_employees": 120,
      "industry": "Computer Software",
      "website_url": "https://techcorp.com",
      "current_technologies": [
        { "name": "salesforce" },
        { "name": "hubspot" }
      ]
    }
  }
}
```

**Agora vocÃª tem:**
- âœ… Cargo (CEO)
- âœ… Senioridade (owner)
- âœ… LinkedIn
- âœ… Telefone
- âœ… Tecnologias que a empresa usa

### Enriquecimento por Domain (Empresa)

Se nÃ£o tem email, mas tem domain:

```json
{
  "name": "Apollo Enrich - Organization",
  "type": "n8n-nodes-base.httpRequest",
  "parameters": {
    "url": "https://api.apollo.io/v1/organizations/enrich",
    "method": "POST",
    "bodyParameters": {
      "parameters": [
        { "name": "domain", "value": "={{ $json.website }}" }
      ]
    }
  }
}
```

**Input:**
```json
{
  "website": "techcorp.com"
}
```

**Output:**
```json
{
  "organization": {
    "name": "TechCorp",
    "num_employees": 120,
    "industry": "Computer Software",
    "linkedin_url": "https://linkedin.com/company/techcorp",
    "founded_year": 2018,
    "total_funding": 5000000,
    "latest_funding_stage": "series_a",
    "current_technologies": ["salesforce", "hubspot", "stripe"]
  }
}
```

---

## ðŸ”— IntegraÃ§Ã£o n8n Completa

### Workflow: Apollo Search â†’ Enrich â†’ Database

```
[Daily Cron 10am] â†’
[Apollo Search: 100 CTOs] â†’
[Loop: Enrich cada lead] â†’
[GPT-4 Lead Score] â†’
[Insert PostgreSQL]
```

### n8n Nodes (Full Workflow)

**1. Trigger DiÃ¡rio**

```json
{
  "name": "Daily Apollo Search",
  "type": "n8n-nodes-base.scheduleTrigger",
  "parameters": {
    "rule": {
      "interval": [
        { "field": "cronExpression", "expression": "0 10 * * *" }
      ]
    }
  }
}
```

**2. Apollo Search**

(jÃ¡ vimos acima)

**3. Loop Enriquecimento**

```json
{
  "name": "Loop Each Lead",
  "type": "n8n-nodes-base.splitInBatches",
  "parameters": {
    "batchSize": 10,
    "options": {}
  }
}
```

Por que loop de 10?
- API Apollo rate limit: 60 calls/min
- 10 leads/batch = 6 batches/min = safe

**4. Enrich Person**

```json
{
  "name": "Apollo Enrich Person",
  "type": "n8n-nodes-base.httpRequest",
  "parameters": {
    "url": "https://api.apollo.io/v1/people/match",
    "method": "POST",
    "bodyParameters": {
      "email": "={{ $json.email }}",
      "organization_name": "={{ $json.company }}"
    }
  }
}
```

**5. GPT-4 Lead Scoring**

```json
{
  "name": "Score with GPT-4",
  "type": "@n8n/n8n-nodes-langchain.openAi",
  "parameters": {
    "model": "gpt-4",
    "prompt": "Score this B2B lead 0-100:\n\nTitle: {{ $json.title }}\nSeniority: {{ $json.seniority }}\nCompany size: {{ $json.company_size }}\nFunding: {{ $json.funding_stage }}\nTech stack: {{ $json.technologies }}\n\nScoring:\n- C-level: +30\n- Company 50-200: +20\n- Has funding: +20\n- Uses Salesforce/HubSpot: +15\n- High-growth industry: +15\n\nJSON: { \"lead_score\": 85, \"fit_score\": 90, \"intent_score\": 80 }"
  }
}
```

**6. Insert PostgreSQL**

```json
{
  "name": "Insert to Database",
  "type": "n8n-nodes-base.postgres",
  "parameters": {
    "operation": "insert",
    "table": "leads",
    "columns": "name, email, phone, linkedin_url, title, seniority, company, company_size, industry, website, funding_stage, technologies, lead_score, fit_score, intent_score, source, source_id, enrichment_data",
    "onConflict": "DO UPDATE SET enrichment_data = EXCLUDED.enrichment_data, updated_at = NOW()"
  }
}
```

**Note:** `ON CONFLICT DO UPDATE` = se lead jÃ¡ existe (mesmo email), atualizar enrichment data.

---

## ðŸ’° OtimizaÃ§Ã£o de CrÃ©ditos Apollo

### Problema: CrÃ©ditos SÃ£o Caros

Plano Basic (R$ 499/mÃªs) = 10.000 crÃ©ditos

Se gastar 5 crÃ©ditos/lead:
- 10.000 Ã· 5 = 2.000 leads/mÃªs
- Custo por lead = R$ 0,25

**Como reduzir custo?**

### 1. SÃ³ Revelar Email de Leads Qualificados

**EstratÃ©gia:**
1. Buscar 500 leads no Apollo (0 crÃ©ditos - sÃ³ metadata)
2. Filtrar com GPT-4 os melhores 100 (baseado em cargo, empresa, tech stack)
3. Revelar email dos 100 (100 crÃ©ditos)

```javascript
// Search sem revelar email
const searchResults = await apolloSearch({
  reveal_personal_emails: false, // ðŸ”‘ NÃ£o gasta crÃ©dito!
  person_titles: ["CEO", "CTO"],
  per_page: 500
});

// Filtrar com GPT-4
const qualifiedLeads = await gpt4Filter(searchResults); // 100 leads

// Revelar email sÃ³ dos qualificados
for (let lead of qualifiedLeads) {
  const enriched = await apolloEnrich({ email: lead.email }); // 1 crÃ©dito cada
}
```

**Economia:** 500 crÃ©ditos â†’ 100 crÃ©ditos (80% de economia)

### 2. Cache de Enriquecimento (Redis)

Se jÃ¡ enriqueceu um lead, nÃ£o enriquecer de novo:

```javascript
// Check Redis cache
const cached = await redis.get(`apollo:${email}`);
if (cached) {
  return JSON.parse(cached); // 0 crÃ©ditos
}

// Se nÃ£o tem cache, enriquecer
const enriched = await apolloEnrich({ email }); // 1 crÃ©dito

// Salvar no cache (1 mÃªs)
await redis.setex(`apollo:${email}`, 2592000, JSON.stringify(enriched));
```

### 3. Priorizar Leads com Email Confidence > 95%

Apollo mostra `email_confidence` (0-100). SÃ³ revelar se > 95%:

```javascript
const highConfidenceLeads = searchResults.filter(lead =>
  lead.email_confidence > 95
);
```

**Por quÃª?**
- Email confidence < 80% = 30-50% bounce rate
- Email confidence > 95% = <5% bounce rate

NÃ£o vale gastar crÃ©dito em email que vai dar bounce.

---

## ðŸ§ª Teste PrÃ¡tico

### ValidaÃ§Ã£o Step-by-Step

**1. Teste Apollo Search (API)**

```bash
curl -X POST https://api.apollo.io/v1/mixed_people/search \
  -H "Content-Type: application/json" \
  -H "X-Api-Key: YOUR_API_KEY" \
  -d '{
    "person_titles": ["CEO"],
    "organization_locations": ["Brazil"],
    "page": 1,
    "per_page": 10
  }'
```

**Validar resposta:**
- `people` array tem 10 leads? âœ…
- Todos tÃªm `email`? âœ…
- Todos tÃªm `organization.name`? âœ…

**2. Teste Enrichment (API)**

```bash
curl -X POST https://api.apollo.io/v1/people/match \
  -H "Content-Type: application/json" \
  -H "X-Api-Key: YOUR_API_KEY" \
  -d '{
    "email": "joao@techcorp.com",
    "organization_name": "TechCorp"
  }'
```

**Validar:**
- Retornou `person.title`? âœ…
- Retornou `person.phone_numbers`? âœ…
- Retornou `organization.current_technologies`? âœ…

**3. Teste n8n Workflow Completo**

1. Ativar workflow no n8n
2. Aguardar execuÃ§Ã£o (ou trigger manual)
3. Verificar logs:
   - Apollo search retornou 100 leads?
   - Enrichment loop processou todos?
   - Leads inseridos no PostgreSQL?

**Query de validaÃ§Ã£o:**

```sql
SELECT
  COUNT(*) as total,
  COUNT(phone) as with_phone,
  COUNT(enrichment_data->'organization'->'current_technologies') as with_tech_stack,
  AVG(lead_score) as avg_score
FROM leads
WHERE source = 'apollo'
AND created_at > NOW() - INTERVAL '1 day';
```

**Resultado esperado:**
```
total | with_phone | with_tech_stack | avg_score
------|------------|-----------------|----------
 100  |     75     |       90        |    82
```

---

## âœ… EntregÃ¡vel PrÃ¡tico

Ao final desta aula, vocÃª terÃ¡:

```
apollo-integration/
â”œâ”€â”€ search-config.json              (filtros de busca)
â”œâ”€â”€ enrichment-strategy.md          (quando enriquecer vs quando nÃ£o)
â””â”€â”€ credit-optimization.md          (como economizar crÃ©ditos)

n8n-workflows/
â””â”€â”€ apollo-search-enrich-db.json    (workflow completo)

database/
â””â”€â”€ leads table                     (100-200 Apollo leads enriched)
```

---

## ðŸŽ¯ Checklist de ValidaÃ§Ã£o

Antes de prosseguir:

- [ ] **Apollo account criado** com plano Basic (10k crÃ©ditos/mÃªs)
- [ ] **API key obtida** e salva em `.env`
- [ ] **Search API testada** via curl/Postman
- [ ] **Enrichment API testada** com 1 lead
- [ ] **n8n workflow funcionando** (Apollo â†’ PostgreSQL)
- [ ] **100 leads enriched** com phone + tech stack
- [ ] **Lead score calculado** com GPT-4
- [ ] **CrÃ©ditos monitorados** (Apollo dashboard mostra usage)

---

## ðŸš€ PrÃ³ximos Passos

Agora que tem 3 fontes de prospecting (Google Maps + LinkedIn + Apollo):

1. **Aula 2.6** â†’ Lead Scoring Inteligente (combinar dados das 3 fontes)
2. **Aula 2.7** â†’ SequÃªncias Multi-Canal (email + LinkedIn + WhatsApp)
3. **Aula 2.8** â†’ Testes A/B AutomÃ¡ticos (qual fonte converte melhor?)

---

## ðŸ“š Recursos Adicionais

- [Apollo API Documentation](https://apolloio.github.io/apollo-api-docs/)
- [Apollo Search Filters List](https://apolloio.github.io/apollo-api-docs/?shell#search-for-people)
- [Credit Optimization Guide](https://www.apollo.io/blog/optimize-credits)
- [Tech Stack Database](https://apollo.io/technologies)

---

**ðŸŽ“ Conceito-chave:** Apollo nÃ£o Ã© sÃ³ para encontrar emails - o verdadeiro valor estÃ¡ nos dados de intent (funding, hiring, tech stack). Use esses sinais para priorizar leads que tÃªm alta probabilidade de comprar.
