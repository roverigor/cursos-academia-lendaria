# ROTEIRO TELEPROMPTER - Aula 2.15: Reply Detection + Routing Inteligente

**Dura√ß√£o Total:** 15 minutos
**Formato:** Screencast (tela principal) + Picture-in-picture (c√¢mera quando necess√°rio)
**Equipamento:** Tela em 1080p, √°udio limpo, teleprompter vis√≠vel

---

## üìã PREPARA√á√ÉO PR√â-GRAVA√á√ÉO

### Setup T√©cnico:
- [ ] Gmail aberto com inbox de exemplos de replies
- [ ] n8n aberto com workflow de reply detection
- [ ] OpenAI API dashboard
- [ ] PostgreSQL database com leads
- [ ] Slack aberto (para mostrar notifica√ß√µes)
- [ ] Calendly aberto

### Materiais Visuais:
- [ ] Diagrama de 5 tipos de reply (POSITIVE, QUESTION, OBJECTION, NEGATIVE, OOO)
- [ ] Fluxograma de routing logic
- [ ] Screenshot GPT-4 classifier output
- [ ] Exemplos de replies reais (anonimizados)
- [ ] Tabela de a√ß√µes por tipo de reply

---

## [00:00 - 01:00] ABERTURA + HOOK CR√çTICO

**[C√ÇMERA: Close-up, energia ALTA, olhando direto]**

**[TOM: Urgente, importante]**

Fala pessoal!

Cen√°rio real:

Voc√™ manda 1.000 cold emails.

50 pessoas respondem (5% reply rate).

**[PAUSA - 1 segundo]**

Dessas 50 replies:

10 dizem: "Sim, tenho interesse!"
15 fazem perguntas: "Quanto custa?"
20 t√™m obje√ß√µes: "N√£o tenho budget"
5 pedem: "Me tira da lista"

**[PAUSA - deixa pender]**

**[TOM: Problema]**

Voc√™ l√™ TODAS as 50 manualmente?

Demora 2 horas.

E se tiver 500 replies?

**[TOM: Revela√ß√£o - mostra na tela]**

**[MOSTRA SOLU√á√ÉO]**

```
MANUAL REPLY HANDLING:
50 replies = 2 horas/dia üò∞
500 replies = 20 horas/dia (imposs√≠vel!)

AUTOMATED REPLY HANDLING:
50 replies = 5 minutos ‚ö°
500 replies = 50 minutos
+ 80% handled automaticamente
+ S√≥ escala POSITIVE para humano
```

**[VOLTA para c√¢mera - TOM: Enf√°tico]**

80% das replies podem ser handled AUTOMATICAMENTE.

Voc√™ s√≥ precisa ver as **POSITIVE** (quentes!).

**[TOM: Preview]**

Hoje voc√™ vai aprender:

‚úÖ Detectar replies automaticamente (Gmail API)
‚úÖ Classificar em 5 tipos com GPT-4 (95% accuracy)
‚úÖ Rotear para a√ß√£o correta (auto-reply, human, calendly)
‚úÖ Parar sequ√™ncia quando lead responde
‚úÖ Escalar apenas leads quentes para humano

**[TRANSI√á√ÉO]**

Vamos come√ßar!

---

## [01:00 - 04:00] 5 TIPOS DE REPLY + A√á√ïES

**[SCREENCAST: Mostrando classifica√ß√£o na tela]**

**[TOM: Educativo, did√°tico]**

Primeiro, entender os 5 tipos de reply.

**[MOSTRA DIAGRAMA COMPLETO]**

### **1. POSITIVE (15-20% das replies)**

**[MOSTRA exemplos reais]**

```
"Sim, tenho interesse!"
"Pode me mandar mais informa√ß√µes?"
"Vamos agendar uma call?"
"Gostei da proposta!"
```

**ACTION:** üî• Escalate para humano + Enviar Calendly

**Priority:** URGENT

---

### **2. QUESTION (30-40% das replies)**

**[MOSTRA exemplos]**

```
"Quanto custa?"
"Funciona para meu nicho?"
"Tem case de empresas de tecnologia?"
"Qual o tempo de implementa√ß√£o?"
```

**ACTION:** ü§ñ GPT-4 auto-response + FAQ

**Priority:** MEDIUM

---

### **3. OBJECTION (20-30% das replies)**

**[MOSTRA exemplos]**

```
"N√£o tenho budget agora"
"J√° usamos outra ferramenta"
"N√£o √© prioridade este trimestre"
"Muito caro para n√≥s"
```

**ACTION:** üìß Objection handling template

**Priority:** MEDIUM

---

### **4. NEGATIVE (10-15% das replies)**

**[MOSTRA exemplos]**

```
"N√£o tenho interesse"
"Tira meu email da lista"
"N√£o me mande mais emails"
"STOP"
```

**ACTION:** üõë Stop sequence + Disqualify

**Priority:** LOW

---

### **5. OUT_OF_OFFICE (5-10% das replies)**

**[MOSTRA exemplos]**

```
"Estou de f√©rias at√© 15/02"
"Respondo em 10 dias"
"Out of office: retorno dia 20"
```

**ACTION:** ‚è∏Ô∏è Pause + Retry em X dias

**Priority:** LOW

**[TOM: Resumo visual]**

**[MOSTRA TABELA]**

| Tipo | % | A√ß√£o | Autom√°tico? |
|------|---|------|-------------|
| POSITIVE | 15-20% | Escalate + Calendly | ‚ùå Humano |
| QUESTION | 30-40% | GPT-4 FAQ | ‚úÖ Auto |
| OBJECTION | 20-30% | Template obje√ß√£o | ‚úÖ Auto |
| NEGATIVE | 10-15% | Stop sequence | ‚úÖ Auto |
| OUT_OF_OFFICE | 5-10% | Wait + Retry | ‚úÖ Auto |

**[TOM: √änfase]**

Apenas POSITIVE vai para humano (15-20%).

Resto = **100% autom√°tico**.

---

## [04:00 - 09:00] GPT-4 SENTIMENT CLASSIFIER

**[SCREENCAST: n8n aberto]**

**[TOM: M√£o na massa, implementa√ß√£o]**

Agora vamos implementar o classificador.

**[MOSTRA workflow]**

```
[Cron: Check Gmail Every 1h] ‚Üí [Gmail Get Replies] ‚Üí [GPT-4 Classify] ‚Üí [Switch by Category] ‚Üí [Actions]
```

**[ADICIONA nodes]**

### **Node 1: Cron Trigger**

**[ARRASTA Cron node]**

```
Interval: Every 1 hour
```

**[TOM: Explicativo]**

A cada 1 hora, workflow roda automaticamente.

Checa se tem replies novas.

### **Node 2: PostgreSQL - Get Active Leads**

**[ARRASTA PostgreSQL node]**

**[MOSTRA query]**

```sql
SELECT
  lead_id,
  email,
  first_name,
  company,
  last_email_sent_at
FROM leads
WHERE
  stage = 'sdr_outreach'
  AND sequence_stopped = FALSE
  AND replied = FALSE
  AND last_email_sent_at > NOW() - INTERVAL '14 days'
LIMIT 500;
```

**[TOM: Breakdown]**

Pega leads:
- Em sequ√™ncia ativa
- Que ainda n√£o responderam
- Que receberam email nos √∫ltimos 14 dias

### **Node 3: Gmail - Check for Replies**

**[ARRASTA Gmail node]**

**[CONFIGURA]**

```json
{
  "operation": "search",
  "q": "from:{{ $json.email }} after:{{ $json.last_email_sent_date }}",
  "maxResults": 10
}
```

**[TOM: Explicativo]**

Busca emails:
- **FROM** o lead (reply)
- **AFTER** data do √∫ltimo email enviado

**[EXECUTA]**

**[MOSTRA resultado - exemplo]**

```json
{
  "hasReply": true,
  "from": "john@example.com",
  "subject": "Re: AI Sales Machine",
  "body": "Gostei da proposta! Quanto custa?",
  "date": "2025-02-01T14:30:00Z"
}
```

**[TOM: Empolgado]**

Tem reply!

Agora vamos classificar.

### **Node 4: GPT-4 - Classify Reply Sentiment**

**[ARRASTA OpenAI node]**

**[MOSTRA prompt COMPLETO]**

```
You are an expert email reply classifier for sales outreach.

Classify this email reply into ONE category with high accuracy.

EMAIL REPLY:
---
From: {{ $json.from }}
Subject: {{ $json.subject }}
Body: {{ $json.body }}
---

CATEGORIES (choose ONE):

1. **POSITIVE**
   - Interested, wants to book meeting, wants more info
   - Examples: "Yes, interested!", "Let's schedule", "Send me details"

2. **QUESTION**
   - Has questions about price, features, case studies, implementation
   - Examples: "How much?", "Do you have case for X industry?", "What's the timeline?"

3. **OBJECTION**
   - Budget concerns, timing issues, already has solution, not decision maker
   - Examples: "No budget", "Not priority now", "We use competitor", "Talk to my boss"

4. **NEGATIVE**
   - Not interested, unsubscribe, stop emails, rude
   - Examples: "Not interested", "Remove me", "STOP", angry tone

5. **OUT_OF_OFFICE**
   - Auto-reply, on vacation, will respond later
   - Examples: "Out of office until...", "On vacation", "Will respond in X days"

CLASSIFICATION RULES:
- If reply contains "yes", "interested", "schedule", "call", "demo" ‚Üí POSITIVE
- If reply asks "how much", "price", "cost", "case study" ‚Üí QUESTION
- If reply mentions "budget", "timing", "already have", "not priority" ‚Üí OBJECTION
- If reply says "not interested", "stop", "unsubscribe" ‚Üí NEGATIVE
- If auto-reply or mentions vacation/absence ‚Üí OUT_OF_OFFICE

OUTPUT (JSON only, no explanation):
{
  "category": "POSITIVE",
  "confidence": 0.95,
  "key_phrase": "gostei da proposta",
  "suggested_action": "send_calendly",
  "urgency": "high",
  "reasoning": "Lead explicitly showed interest and asked follow-up question"
}
```

**[TOM: Importante]**

Elementos do prompt:

1. **Context**: "You are expert classifier"
2. **5 categorias claras** com exemplos
3. **Regras expl√≠citas**: Se X ent√£o Y
4. **Output estruturado**: JSON

**[CONFIGURA node]**

```
Model: gpt-4
Temperature: 0.1 (baixo = determin√≠stico)
```

**[EXECUTA]**

**[MOSTRA output GPT-4]**

```json
{
  "category": "QUESTION",
  "confidence": 0.92,
  "key_phrase": "quanto custa",
  "suggested_action": "gpt4_auto_reply_faq",
  "urgency": "medium",
  "reasoning": "Lead is interested but needs price info before booking"
}
```

**[TOM: Satisfeito]**

Perfect!

GPT-4 classificou: **QUESTION** (92% confidence).

A√ß√£o sugerida: Auto-reply com FAQ.

**[MOSTRA breakdown visual]**

```
INPUT:
"Gostei da proposta! Quanto custa?"

GPT-4 ANALYSIS:
‚úÖ "Gostei" = Positive sentiment
‚úÖ "Quanto custa?" = Price question
‚Üí Category: QUESTION
‚Üí Action: Send FAQ with pricing
‚Üí Confidence: 92%
```

---

## [09:00 - 12:00] ROUTING LOGIC + AUTO-RESPONSES

**[SCREENCAST: Continua no n8n]**

**[TOM: Implementa√ß√£o das a√ß√µes]**

Agora vamos rotear para a√ß√£o correta.

### **Node 5: Switch (by Category)**

**[ARRASTA Switch node]**

**[CONFIGURA]**

```javascript
Mode: Expression

Rules:
1. {{ $json.category }} = "POSITIVE" ‚Üí Output 0
2. {{ $json.category }} = "QUESTION" ‚Üí Output 1
3. {{ $json.category }} = "OBJECTION" ‚Üí Output 2
4. {{ $json.category }} = "NEGATIVE" ‚Üí Output 3
5. {{ $json.category }} = "OUT_OF_OFFICE" ‚Üí Output 4
```

**[MOSTRA visualmente - 5 caminhos]**

Cada categoria = caminho diferente.

### **OUTPUT 0: POSITIVE ‚Üí Escalate + Calendly**

**[CONECTA para Slack node]**

**[MOSTRA configura√ß√£o]**

```
Channel: #sales-hot-leads

Message:
üî• HOT LEAD REPLIED!

Name: {{ $json.first_name }}
Company: {{ $json.company }}
Reply: "{{ $json.body }}"

Confidence: {{ $json.confidence }}
Urgency: {{ $json.urgency }}

üìû Action: SDR should call NOW
üóìÔ∏è Or send Calendly: {{ calendly_link }}
```

**[TAMB√âM CONECTA para Gmail node]**

**[MOSTRA email autom√°tico]**

```
To: {{ $json.email }}
Subject: Re: AI Sales Machine

---

{{ first_name }}, √≥timo!

Aqui est√° meu Calendly para agendar 15 min:
{{ calendly_link }}

Escolhe o melhor hor√°rio pra voc√™.

Qualquer d√∫vida antes da call, √© s√≥ responder.

Abs,
{{ sender }}
```

**[TOM: Importante]**

Dupla a√ß√£o:
1. Notifica SDR no Slack (urgente!)
2. Envia Calendly automaticamente

### **OUTPUT 1: QUESTION ‚Üí GPT-4 Auto-Reply**

**[CONECTA para OpenAI node]**

**[MOSTRA prompt FAQ]**

```
Answer this sales question professionally and concisely.

QUESTION FROM LEAD:
"{{ $json.body }}"

LEAD INFO:
- Name: {{ $json.first_name }}
- Company: {{ $json.company }}
- Industry: {{ $json.industry }}

OUR PRODUCT INFO:
- Price: R$ 5k/month
- Setup time: 7 business days
- ROI: Average R$ 58k/month (2,800%)
- Support: 24/7 included
- Guarantee: 60 days risk-free
- Case studies: Available for SaaS, Agencies, E-commerce
- Tech stack: n8n + PostgreSQL + GPT-4

INSTRUCTIONS:
1. Answer the specific question asked
2. Be concise (max 100 words)
3. Include 1-2 relevant stats/numbers
4. End with soft CTA (offer Calendly if appropriate)
5. Tone: Professional but friendly, Portuguese

OUTPUT (plain text only):
```

**[EXECUTA]**

**[MOSTRA output]**

```
Jo√£o, boa pergunta!

O investimento √© R$ 5k/m√™s.

Nossos clientes geram em m√©dia R$ 58k/m√™s de retorno (ROI de 2.800%).

Setup leva 7 dias √∫teis e voc√™ fica livre para escalar.

Tem garantia de 60 dias - se n√£o funcionar, devolvemos 100%.

Quer ver um case de empresa similar √† sua? Posso agendar 15 min: [Calendly]

Abs,
Igor
```

**[CONECTA para Gmail - envia reply]**

**[TOM: Satisfeito]**

Auto-reply personalizado!

Respondeu a pergunta + ofereceu Calendly.

### **OUTPUT 2: OBJECTION ‚Üí Template**

**[CONECTA para Gmail node]**

**[MOSTRA template de obje√ß√£o]**

```
{{ first_name }}, entendo!

[Specific objection response based on type]

Se "budget":
‚Üí "Vamos aos n√∫meros: investimento R$ 5k/m√™s, retorno R$ 58k.
   Payback em 3 dias. Vale a pena conversar?"

Se "timing":
‚Üí "Sem problema! Quando seria melhor? Q2? Q3?
   Te coloco em nurture e retomo no trimestre certo."

Se "already have solution":
‚Üí "Legal! Qual ferramenta voc√™s usam?
   Muitos clientes nossos usavam [competitor] e migraram.
   Quer saber por qu√™?"

[Link Calendly se apropriado]
```

### **OUTPUT 3: NEGATIVE ‚Üí Stop Sequence**

**[CONECTA para PostgreSQL Update]**

**[MOSTRA query]**

```sql
UPDATE leads
SET
  stage = 'disqualified',
  disqualified_reason = 'lead_replied_negative',
  sequence_stopped = TRUE,
  replied = TRUE,
  reply_sentiment = 'negative',
  unsubscribed = TRUE
WHERE email = '{{ $json.email }}';
```

**[TOM: Importante]**

Respeita opt-out!

Lead pediu para parar ‚Üí PARA IMEDIATAMENTE.

### **OUTPUT 4: OUT_OF_OFFICE ‚Üí Wait + Retry**

**[CONECTA para PostgreSQL Update]**

**[MOSTRA query]**

```sql
UPDATE leads
SET
  sequence_stopped = TRUE,
  sequence_resume_at = NOW() + INTERVAL '{{ days_to_wait }} days',
  out_of_office = TRUE
WHERE email = '{{ $json.email }}';
```

**[TOM: Explicativo]**

Pausa sequ√™ncia.

Retoma automaticamente quando lead voltar.

**[MOSTRA workflow completo conectado]**

**[EXECUTA workflow com 10 leads]**

**[MOSTRA resultados - timelapse]**

```
Processing 10 replies...

‚úÖ 2 POSITIVE ‚Üí Slack notification sent + Calendly sent
‚úÖ 4 QUESTION ‚Üí GPT-4 auto-reply sent
‚úÖ 2 OBJECTION ‚Üí Objection template sent
‚úÖ 1 NEGATIVE ‚Üí Sequence stopped
‚úÖ 1 OUT_OF_OFFICE ‚Üí Paused, retry in 7 days
```

**[TOM: Empolgado]**

10 replies processadas em 30 segundos!

80% handled automaticamente.

S√≥ 2 (POSITIVE) precisaram de humano.

---

## [12:00 - 13:30] STOP SEQUENCE TRIGGER + DATABASE

**[SCREENCAST: Mostrando l√≥gica de stop]**

**[TOM: Importante - regras cr√≠ticas]**

Quando parar sequ√™ncia?

**[MOSTRA L√ìGICA]**

```javascript
const shouldStopSequence = (reply) => {
    // SEMPRE para se:
    if (reply.category === 'POSITIVE') return true;
    // ‚Üí Lead interessado, humano assume

    if (reply.category === 'NEGATIVE') return true;
    // ‚Üí Lead pediu para parar, respeita

    if (reply.meeting_booked) return true;
    // ‚Üí Meeting agendado, objetivo alcan√ßado

    // √ÄS VEZES para se:
    if (reply.category === 'QUESTION' && reply.answered_satisfactorily) {
        return true;
        // ‚Üí Respondeu pergunta, espera lead agendar
    }

    // NUNCA para se:
    if (reply.category === 'OUT_OF_OFFICE') return false;
    // ‚Üí S√≥ pausar, n√£o parar

    if (reply.category === 'OBJECTION' && !reply.hard_no) {
        return false;
        // ‚Üí Obje√ß√£o pode ser superada, continua nurture
    }

    return false;
};
```

**[TOM: Explica√ß√£o]**

Regra de ouro:

**POSITIVE ou NEGATIVE** ‚Üí Para imediatamente.

**QUESTION ou OBJECTION** ‚Üí Responde e monitora.

**OUT_OF_OFFICE** ‚Üí Pausa temporariamente.

**[MOSTRA update database]**

```sql
UPDATE leads
SET
    sequence_stopped = TRUE,
    sequence_stop_reason = '{{ reason }}',
    sequence_stop_channel = 'email',
    replied = TRUE,
    reply_date = NOW(),
    reply_sentiment = '{{ category }}',
    stage = CASE
        WHEN '{{ category }}' = 'POSITIVE' THEN 'meeting_booked'
        WHEN '{{ category }}' = 'NEGATIVE' THEN 'disqualified'
        ELSE stage
    END,
    assigned_to = CASE
        WHEN '{{ category }}' = 'POSITIVE' THEN 'human_SDR'
        ELSE 'ai_sdr'
    END
WHERE email = '{{ email }}';
```

**[TOM: Importante]**

Dados salvos:
- Reply sentiment
- Stop reason
- Stage updated
- Assigned to (human ou AI)

---

## [13:30 - 14:30] BATCH PROCESSING VS REAL-TIME

**[C√ÇMERA: Estrat√©gico, comparando op√ß√µes]**

**[TOM: Did√°tico]**

Duas abordagens:

**[MOSTRA COMPARA√á√ÉO]**

### **Op√ß√£o 1: Batch Processing (Recomendado para come√ßar)**

```
Cron: Every 1 hour
‚Üí Check all active leads
‚Üí Query Gmail for replies
‚Üí Classify with GPT-4
‚Üí Route accordingly
```

**PROS:**
‚úÖ Simples de implementar
‚úÖ Menos API calls (custo menor)
‚úÖ F√°cil de debugar

**CONS:**
‚ùå Lat√™ncia de at√© 1h
‚ùå Lead pode esperar 1h para reply

**[TOM: Opini√£o]**

Para come√ßar: **Batch √© suficiente**.

1h de lat√™ncia n√£o afeta muito.

### **Op√ß√£o 2: Real-Time (Avan√ßado)**

```
Gmail Webhook
‚Üí n8n Webhook Trigger
‚Üí Instant classification
‚Üí Instant routing
```

**PROS:**
‚úÖ Resposta instant√¢nea (< 1 min)
‚úÖ Melhor experi√™ncia para lead

**CONS:**
‚ùå Setup complexo (Gmail API webhooks)
‚ùå Mais API calls (custo maior)

**[TOM: Recomenda√ß√£o]**

Comece com Batch.

Quando escalar para 1.000+ leads/m√™s ‚Üí migre para Real-Time.

---

## [14:30 - 14:50] RECAP COMPLETO

**[C√ÇMERA: Resumindo]**

Recap:

‚úÖ **5 Tipos de Reply:**
   - POSITIVE (15-20%) ‚Üí Escalate para humano
   - QUESTION (30-40%) ‚Üí GPT-4 auto-reply
   - OBJECTION (20-30%) ‚Üí Template obje√ß√£o
   - NEGATIVE (10-15%) ‚Üí Stop sequence
   - OUT_OF_OFFICE (5-10%) ‚Üí Pause + retry

‚úÖ **GPT-4 Classifier:**
   - 95% accuracy
   - Confidence score
   - Suggested action

‚úÖ **Routing Logic:**
   - Switch by category
   - 5 caminhos diferentes
   - 80% handled automaticamente

‚úÖ **Stop Sequence:**
   - POSITIVE/NEGATIVE ‚Üí Para
   - QUESTION/OBJECTION ‚Üí Continua
   - Database updated

‚úÖ **Batch Processing:**
   - Every 1h (suficiente)
   - Real-time (avan√ßado)

---

## [14:50 - 15:00] PR√ìXIMOS PASSOS

**[C√ÇMERA: Call to action]**

**Pr√≥xima aula: Meeting Booking Autom√°tico**

Calendly integration, reminders, no-show handling.

**Antes da pr√≥xima aula:**

- [ ] Configura Gmail API (OAuth)
- [ ] Implementa GPT-4 classifier
- [ ] Cria routing logic (5 categorias)
- [ ] Testa com 10 replies reais
- [ ] Mede accuracy (GPT-4 acertou?)

Qualquer d√∫vida, comenta!

At√©! üëã

**[FADE OUT]**

**[FIM DA GRAVA√á√ÉO]**
