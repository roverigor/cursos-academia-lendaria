# 2.3 - Push e Pull

**Duração:** 10 min | **Nível:** Iniciante

## Objetivo

Sincronizar repositório local com GitHub usando push (enviar) e pull (receber), entendendo quando usar cada comando.

## Por que isso importa

Seus commits locais só existem no seu computador até você fazer push. Se o HD queimar, você perde tudo. Push é backup + colaboração. Pull mantém seu código atualizado com mudanças do time.

## Conteúdo

### O Modelo Local ↔ Remoto

```
┌─────────────────────────┐
│   Seu Computador        │
│                         │
│   Local Repository      │
│   ├── Commit A          │
│   ├── Commit B          │
│   └── Commit C (novo)   │
│                         │
└────────┬────────────────┘
         │
         │ git push (enviar)
         │ git pull (receber)
         │
         ▼
┌─────────────────────────┐
│   GitHub (nuvem)        │
│                         │
│   Remote Repository     │
│   ├── Commit A          │
│   ├── Commit B          │
│   └── (esperando C)     │
│                         │
└─────────────────────────┘
```

### git push: Enviando Commits para GitHub

**O que faz:** Envia commits locais para repositório remoto.

#### Push básico

```bash
# Push para branch atual
git push

# Push especificando remote e branch
git push origin main
```

**Estrutura:** `git push <remote> <branch>`
- `origin` = Nome padrão do repositório remoto (GitHub)
- `main` = Nome da branch que está enviando

#### Primeiro push (configurar upstream)

Quando você cria repo local ou branch nova:

```bash
git push -u origin main
# Ou
git push --set-upstream origin main
```

**O que `-u` faz:**
- Estabelece conexão entre branch local e remota
- Depois disso, pode usar só `git push` (sem especificar origem)

**Saída típica:**
```
Enumerating objects: 5, done.
Counting objects: 100% (5/5), done.
Delta compression using up to 8 threads
Compressing objects: 100% (3/3), done.
Writing objects: 100% (3/3), 342 bytes | 342.00 KiB/s, done.
Total 3 (delta 1), reused 0 (delta 0)
To github.com:username/repo.git
   abc1234..def5678  main -> main
```

#### Push forçado (CUIDADO!)

```bash
git push --force
# Ou forma curta
git push -f
```

**⚠️ Quando NÃO usar:**
- Branch compartilhada com outras pessoas
- Branch main/master de produção
- Quando não tem certeza do que está fazendo

**Quando usar (raramente):**
- Branch pessoal que você reescreveu histórico
- Depois de `git rebase` em branch sua

**Alternativa mais segura:**
```bash
git push --force-with-lease
```

Falha se alguém fez push entre seu último pull e seu push.

### git pull: Recebendo Mudanças do GitHub

**O que faz:** Baixa commits do GitHub e integra com seu trabalho local.

#### Pull básico

```bash
# Pull da branch atual
git pull

# Pull especificando remote e branch
git pull origin main
```

**Pull = fetch + merge**

```bash
# Equivalente a:
git fetch origin
git merge origin/main
```

#### Pull com rebase (recomendado)

```bash
git pull --rebase
# Ou configurar globalmente (já fizemos em 1.2)
git config --global pull.rebase true
```

**Diferença:**

**Pull normal (merge):**
```
A - B - C (seu local)
     \
      D - E (GitHub)
       \
        M (merge commit criado)
```

**Pull com rebase:**
```
A - B - D - E - C' (seu commit aplicado após commits do GitHub)
```

Histórico mais limpo, sem merge commits desnecessários.

### Quando Usar Cada Comando

| Situação | Comando | Razão |
|----------|---------|-------|
| Acabei de commitar | `git push` | Backup + compartilhar |
| Começo do dia | `git pull` | Atualizar com trabalho do time |
| Antes de criar PR | `git pull` | Garantir que está atualizado |
| Erro ao push | `git pull` primeiro | Resolver conflitos localmente |
| Alguém mudou GitHub | `git pull` | Sincronizar |

### Workflow Diário Completo

```bash
# Manhã: Atualizar repo
git pull

# Trabalhar: Fazer mudanças
# ... editar arquivos ...

# Salvar versão local
git add .
git commit -m "Add feature X"

# Enviar para GitHub
git push

# Fim do dia: Garantir que está sincronizado
git push
```

### Ver Status de Sincronização

```bash
# Ver conexões remotas
git remote -v
```

Saída:
```
origin  git@github.com:username/repo.git (fetch)
origin  git@github.com:username/repo.git (push)
```

```bash
# Ver diferença entre local e remoto
git status
```

Saída quando local está à frente:
```
Your branch is ahead of 'origin/main' by 2 commits.
  (use "git push" to publish your local commits)
```

Saída quando remoto está à frente:
```
Your branch is behind 'origin/main' by 1 commit.
  (use "git pull" to update your local branch)
```

Saída quando divergiram:
```
Your branch and 'origin/main' have diverged,
and have 1 and 1 different commits each, respectively.
  (use "git pull" to merge the remote branch into yours)
```

### Troubleshooting Comum

#### Erro: "rejected - non-fast-forward"

```
! [rejected]        main -> main (non-fast-forward)
error: failed to push some refs to 'github.com:username/repo.git'
```

**Causa:** GitHub tem commits que você não tem localmente.

**Solução:**
```bash
git pull --rebase
git push
```

#### Erro: "Please commit your changes or stash them"

```
error: Your local changes would be overwritten by merge.
Please commit your changes or stash them before you merge.
```

**Causa:** Você tem mudanças não commitadas e pull iria sobrescrevê-las.

**Solução 1 - Commitar:**
```bash
git add .
git commit -m "Work in progress"
git pull
```

**Solução 2 - Guardar temporariamente (stash):**
```bash
git stash
git pull
git stash pop  # Recupera mudanças
```

#### Erro: "Permission denied (publickey)"

**Causa:** SSH não configurado ou chave errada.

**Solução:**
```bash
# Testar SSH
ssh -T git@github.com

# Se falhar, revisar lição 1.3
```

### Boas Práticas

**✅ Faça:**
- Pull no início do dia
- Push ao final de cada feature/fix
- Commit pequeno → push frequente (várias vezes ao dia)
- Pull antes de criar Pull Request

**❌ Evite:**
- Deixar commits só localmente por dias
- Push de código quebrado para branch principal
- Force push em branches compartilhadas
- Pull sem commitar mudanças (use stash)

### Verificação Rápida

```bash
# Antes de sair do computador
git status  # Tudo commitado?
git push    # Tudo no GitHub?

# Chegou em casa/outro computador
git pull    # Atualizar com último trabalho
```

## Exercício Prático

Use o repo `github-practice-repo`:

```bash
cd github-practice-repo

# 1. Veja status atual
git status

# 2. Faça mudança local
echo "// Push and pull practice" >> index.js
git add index.js
git commit -m "Add comment about push/pull"

# 3. Veja que local está à frente
git status
# Saída: Your branch is ahead of 'origin/main' by 1 commit

# 4. Push para GitHub
git push

# 5. Veja que sincronizou
git status
# Saída: Your branch is up to date with 'origin/main'

# 6. Faça mudança direto no GitHub
# - Acesse github.com/seu-usuario/github-practice-repo
# - Clique em README.md → Edit (ícone lápis)
# - Adicione linha: "Edited on GitHub web interface"
# - Commit changes (botão verde)

# 7. De volta ao terminal, veja status
git status
# Saída: Your branch is behind 'origin/main' by 1 commit

# 8. Pull para atualizar local
git pull

# 9. Veja que arquivo foi atualizado
cat README.md
# Deve mostrar linha que adicionou no GitHub

# 10. Confirme sincronização
git status
# Saída: Your branch is up to date
```

## Checkpoint

- [ ] Entendo que push envia, pull recebe
- [ ] Sei usar `git push` para enviar commits
- [ ] Sei usar `git pull` para atualizar local
- [ ] Configurei `pull.rebase true` para histórico limpo
- [ ] Entendo erros comuns e como resolver
- [ ] Pratico push/pull frequente (várias vezes ao dia)

## Próxima lição

Você já sabe o ciclo completo: commit local e sincronizar. Agora vamos aprender a escrever commits que realmente comunicam. → **2.4 - Commits que comunicam**
