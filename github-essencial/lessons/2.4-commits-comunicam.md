# 2.4 - Commits que comunicam

**Duração:** 10 min | **Nível:** Iniciante

## Objetivo

Escrever mensagens de commit claras, específicas e atômicas que comunicam mudanças efetivamente para o time e seu futuro eu.

## Por que isso importa

Commits são documentação viva do projeto. Em 6 meses, você não vai lembrar por que mudou aquela linha. Mensagens ruins dificultam code review, causam bugs e frustram colegas. Commits profissionais comunicam intenção, não apenas o que mudou.

## Conteúdo

### O Que Torna um Commit Profissional

**Commit profissional = Atômico + Mensagem clara + Mudanças relacionadas**

#### 1. Commits Atômicos

**Atômico:** Uma mudança lógica completa, testável isoladamente.

**✅ Bom - Commits separados:**
```bash
git commit -m "Add user authentication"
git commit -m "Update README with auth instructions"
git commit -m "Fix typo in login form"
```

**❌ Ruim - Tudo junto:**
```bash
git commit -m "Add auth, update readme, fix typos, refactor utils"
```

**Regra:** Se precisa de "e" ou "," na mensagem, provavelmente deveria ser 2 commits.

#### 2. Mensagens Claras

**Anatomia de mensagem profissional:**

```
Título: O que + Onde (50 caracteres)

Corpo: Por que + Como (wrap 72 caracteres)
```

**Exemplo:**
```
Add password reset functionality

Users were unable to recover accounts after forgetting passwords.
Implements email-based reset flow with token expiration (1 hour).

- Create /api/reset-password endpoint
- Add email template for reset link
- Implement token generation and validation
```

#### 3. Mudanças Relacionadas

**✅ Relacionadas:** Tudo no commit contribui para a mesma funcionalidade
```bash
# Um commit:
- src/auth/login.js
- src/auth/session.js
- tests/auth.test.js
```

**❌ Não relacionadas:**
```bash
# Commits misturados:
- src/auth/login.js (feature nova)
- src/utils/format.js (refactor aleatório)
- README.md (typo fix)
```

### Convenções de Mensagem

#### Formato Imperativo

Use como se completasse: "If applied, this commit will..."

**✅ Correto:**
```
Add login form
Fix navbar alignment
Update dependencies
Remove deprecated API
```

**❌ Errado:**
```
Added login form (passado)
Fixing navbar (gerúndio)
Updated some stuff (vago)
Changes (genérico demais)
```

#### Estrutura do Título

```
[type]: [subject]
```

**Types comuns:**
- `feat:` Nova funcionalidade
- `fix:` Correção de bug
- `docs:` Apenas documentação
- `style:` Formatação (não muda lógica)
- `refactor:` Reescrita sem mudar comportamento
- `test:` Adicionar/corrigir testes
- `chore:` Tarefas de manutenção (deps, build)

**Exemplos:**
```bash
git commit -m "feat: add user profile page"
git commit -m "fix: resolve memory leak in image upload"
git commit -m "docs: update API documentation"
git commit -m "refactor: extract validation logic to utils"
git commit -m "test: add unit tests for auth service"
git commit -m "chore: update dependencies"
```

**Nota:** Conventional Commits é padrão em muitos projetos open source.

### Tamanho da Mensagem

#### Título (primeira linha)

**Máximo:** 50 caracteres
**Por quê:** GitHub trunca em 72, mas 50 fica legível em todos os lugares

```bash
# Ver tamanho
echo "feat: add user authentication system" | wc -c
# 38 caracteres ✓
```

**Se não couber em 50:** Seu commit provavelmente não é atômico.

#### Corpo (linhas seguintes)

**Wrap:** 72 caracteres por linha
**Quando usar:** Mudanças complexas que precisam contexto

```bash
git commit
```

No editor:
```
Fix race condition in payment processing

Payment requests were occasionally processed twice when users
clicked submit button rapidly. Added request debouncing and
server-side idempotency check.

- Implement 300ms debounce on submit button
- Add unique transaction ID to each request
- Check for duplicate transactions in API

Closes #245
```

### Exemplos Reais: Ruim vs Bom

#### Exemplo 1: Vago vs Específico

**❌ Ruim:**
```bash
git commit -m "fix bug"
```

**❓ Qual bug? Onde? Como?**

**✅ Bom:**
```bash
git commit -m "fix: resolve null pointer in user profile display"
```

#### Exemplo 2: Genérico vs Descritivo

**❌ Ruim:**
```bash
git commit -m "updates"
```

**❓ Atualizou o quê?**

**✅ Bom:**
```bash
git commit -m "docs: update installation instructions for Windows"
```

#### Exemplo 3: Múltiplas mudanças vs Atômico

**❌ Ruim:**
```bash
git commit -m "Add feature, fix bugs, update readme"
```

**❓ Deveria ser 3 commits separados!**

**✅ Bom:**
```bash
git commit -m "feat: add dark mode toggle"
git commit -m "fix: correct button alignment on mobile"
git commit -m "docs: add dark mode usage to README"
```

#### Exemplo 4: Passado vs Imperativo

**❌ Ruim:**
```bash
git commit -m "Added user authentication"
```

**✅ Bom:**
```bash
git commit -m "Add user authentication"
```

### Referências em Mensagens

#### Linkando Issues

```bash
git commit -m "Fix login redirect loop

Users were stuck in infinite redirect after OAuth login.
Refactored callback handling to break the loop.

Fixes #123"
```

GitHub automaticamente fecha issue #123 quando merge acontecer.

**Palavras-chave que fecham issues:**
- `Fixes #123`
- `Closes #123`
- `Resolves #123`

#### Mencionando Pull Requests

```bash
git commit -m "Implement feedback from PR #45"
```

#### Mencionando Pessoas

```bash
git commit -m "Add API rate limiting

Implements rate limiting suggested by @john-developer.
Uses sliding window algorithm, 100 req/min limit."
```

### Quando Quebrar as Regras

**Work in Progress (WIP) commits:**

Durante desenvolvimento ativo em branch pessoal:

```bash
git commit -m "WIP: building user dashboard"
git commit -m "WIP: still debugging auth flow"
```

**Antes de merge:** Squash esses commits em um só ou reescreva histórico.

```bash
# Squash últimos 3 commits
git rebase -i HEAD~3
```

### Ferramentas de Ajuda

#### Ver tamanho da mensagem

```bash
git log --oneline
```

Linhas longas ficam óbvias.

#### Template de commit

Crie `~/.gitmessage`:
```
# <type>: <subject> (max 50 chars)
# |<----  Using a Maximum Of 50 Characters  ---->|

# Explain why this change is being made
# |<----   Try To Limit Each Line to a Maximum Of 72 Characters   ---->|

# Provide links or keys to any relevant tickets, articles or other resources
# Example: Closes #123

# --- COMMIT END ---
# Type can be:
#   feat     (new feature)
#   fix      (bug fix)
#   refactor (refactoring code)
#   style    (formatting, missing semi colons, etc; no code change)
#   doc      (changes to documentation)
#   test     (adding or refactoring tests; no production code change)
#   chore    (updating build tasks, package manager configs, etc)
```

Configure:
```bash
git config --global commit.template ~/.gitmessage
```

Agora `git commit` abre com template.

### Checklist de Commit Profissional

Antes de commitar, pergunte:

- [ ] Título tem max 50 caracteres?
- [ ] Uso imperativo (Add, Fix, Update)?
- [ ] Mensagem é específica, não genérica?
- [ ] Todas mudanças são relacionadas?
- [ ] Commit é atômico (uma mudança lógica)?
- [ ] Outro dev entenderia sem contexto?
- [ ] Se bug, explico a causa?
- [ ] Referencio issue/PR se relevante?

## Exercício Prático

```bash
cd github-practice-repo

# 1. Faça mudanças não relacionadas
echo "function login() { }" >> auth.js
echo "function formatDate() { }" >> utils.js
echo "## Setup" >> README.md

# 2. Commit separado para cada mudança lógica
git add auth.js
git commit -m "feat: add login function placeholder"

git add utils.js
git commit -m "feat: add date formatting utility"

git add README.md
git commit -m "docs: add setup section to README"

# 3. Ver histórico limpo
git log --oneline

# 4. Faça commit com corpo detalhado
echo "export { login, logout }" >> auth.js
git add auth.js
git commit
```

No editor:
```
feat: export authentication functions

Make login and logout available for import in other modules.
Part of refactoring to modular architecture.

- Export login function
- Export logout function (to be implemented)
```

Salve e feche.

```bash
# 5. Ver commit completo
git show

# 6. Push commits profissionais
git push
```

Vá no GitHub e veja como commits ficaram claros no histórico.

## Checkpoint

- [ ] Escrevo commits atômicos (uma mudança lógica)
- [ ] Uso imperativo: Add, Fix, Update
- [ ] Mensagens são específicas, não vagas
- [ ] Título tem max 50 caracteres
- [ ] Sei quando usar corpo detalhado
- [ ] Referencio issues quando relevante
- [ ] Meu histórico conta uma história clara

## Próxima lição

Commits profissionais prontos! Agora vamos garantir que você nunca commite acidentalmente senhas ou arquivos temporários. → **2.5 - .gitignore essencial**
