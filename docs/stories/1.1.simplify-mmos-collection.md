# Story 1.1: Simplify MMOS Collection with One-Command Tools

## Status
**InProgress** âš¡

## Story

**As a** MMOS Mind Mapper (researcher creating AI mind clones),
**I want** a single command to discover and collect all source materials automatically,
**so that** I can focus on cognitive analysis instead of tedious manual data collection setup.

## Context

**Problem:** Current MMOS Phase 2 (Research Collection) is complex, manual, and error-prone:
- Requires creating tier1_batch.yaml files manually
- Multi-step ETL process needs multiple commands
- No built-in validation of collected files
- Debugging failures is difficult (unclear error messages)
- Requires deep technical knowledge of ETL internals

**Solution:** New one-command tools that automate discovery + collection:
- `collect-blog.js` - Blogs (âœ… PROVEN: 100% success on Sam Altman - 30/30 posts)
- `collect-youtube.js` - YouTube videos/podcasts (TO BUILD)
- `collect-pdf.js` - PDF documents (TO BUILD)
- `collect-all.js` - Orchestrates all sources (TO BUILD)

**Impact:**
- Reduce Phase 2 time from ~2 hours to ~15 minutes
- Increase success rate from ~80% to ~95%+
- Lower barrier to entry for MMOS users
- Better error reporting and validation

## Acceptance Criteria

### 1. Blog Collection Simplified
- [x] `collect-blog.js` tool created and tested
- [ ] MMOS `research-collection.md` task updated to use collect-blog.js
- [ ] Remove manual tier1_batch.yaml creation steps for blogs
- [ ] Single command replaces multi-step blog collection
- [ ] Built-in validation confirms files created with slug names

### 2. YouTube Collection Simplified
- [x] `collect-youtube.js` tool created
- [x] Auto-discovers playlists or channels
- [x] Handles transcription via AssemblyAI or yt-dlp fallback
- [x] Progress bar and validation built-in
- [ ] Integrated into MMOS task

### 3. PDF Collection Simplified
- [x] `collect-pdf.js` tool created
- [x] Handles direct URLs (Z-Library integration deferred)
- [x] OCR support for scanned documents
- [x] Progress bar and validation built-in
- [ ] Integrated into MMOS task

### 4. Unified Collection Orchestrator
- [x] `collect-all.js` master command created
- [x] Accepts sources.yaml with mixed types (blog/youtube/pdf)
- [x] Runs appropriate collector for each type
- [x] Consolidated report across all source types
- [x] Error recovery and retry logic

### 5. MMOS Integration Complete
- [ ] `research-collection.md` completely refactored
- [ ] Old multi-step process removed (deprecated)
- [ ] New process documented with examples
- [ ] Migration guide for existing users
- [ ] README updated with new simplified workflow

### 6. Documentation & Validation
- [ ] ETL README updated with all new tools
- [ ] Usage examples for each collector
- [ ] Troubleshooting guide added
- [ ] Integration tested with 3 different minds:
  - [ ] Sam Altman (blogs)
  - [ ] Test mind with YouTube (videos/podcasts)
  - [ ] Test mind with PDFs (documents)

## Tasks / Subtasks

### âœ… Phase 1: Blog Collection (COMPLETE)
- [x] Create `collect-blog.js` tool (AC: 1)
  - [x] Integrate BlogDiscovery for auto-discovery
  - [x] Integrate ParallelCollector for collection
  - [x] Add validation step
  - [x] Add progress bar
- [x] Test with Sam Altman blog (AC: 1)
  - [x] Verify 100% success rate
  - [x] Confirm slug filenames
  - [x] Validate file contents

### âœ… Phase 2: YouTube Collection (COMPLETE)
- [x] Create `collect-youtube.js` tool (AC: 2)
  - [x] Add channel/playlist discovery
  - [x] Integrate YouTubeCollector
  - [x] Add transcription orchestration
  - [x] Add progress bar and validation
  - [x] Handle yt-dlp fallback for captions
- [x] YouTube Discovery utility created
  - [x] Single video, channel, and playlist support
  - [x] Smart rules applied (3 years, < 50 videos = 100%)
  - [x] Slug generation for filenames

### âœ… Phase 3: PDF Collection (COMPLETE)
- [x] Create `collect-pdf.js` tool (AC: 3)
  - [x] Add URL download support
  - [x] Single PDF and batch modes
  - [x] Integrate PDFCollector with OCR
  - [x] Add progress bar and validation
- [x] Supports direct URLs and local paths
  - [x] OCR support via Tesseract
  - [x] Chapter detection
  - [x] Quality assessment

### âœ… Phase 4: Unified Orchestrator (COMPLETE)
- [x] Create `collect-all.js` master tool (AC: 4)
  - [x] Parse mixed sources.yaml
  - [x] Route to appropriate collectors
  - [x] Consolidate reports by type
  - [x] Add retry logic for failures
- [x] Comprehensive validation and reporting
  - [x] Breakdown by source type
  - [x] Retry failed sources option
  - [x] Consolidated success/failure report

### â³ Phase 5: MMOS Integration (PENDING)
- [ ] Refactor `research-collection.md` task (AC: 5)
  - [ ] Remove tier1_batch.yaml creation steps
  - [ ] Replace with collect-all.js invocation
  - [ ] Update validation steps
  - [ ] Add troubleshooting section
- [ ] Update MMOS README (AC: 5)
  - [ ] Show new simplified workflow
  - [ ] Add migration guide
  - [ ] Deprecate old process
- [ ] Update ETL README (AC: 6)
  - [ ] Document all 4 new tools
  - [ ] Add usage examples
  - [ ] Add troubleshooting

### â³ Phase 6: Final Validation (PENDING)
- [ ] Integration test with 3 minds (AC: 6)
  - [ ] Sam Altman (blogs) - already done âœ…
  - [ ] Test mind with YouTube
  - [ ] Test mind with PDFs
- [ ] Performance validation (AC: 6)
  - [ ] Verify Phase 2 time < 15 min
  - [ ] Verify success rate > 95%
  - [ ] Confirm no regressions

## Dev Notes

### Current State
**âœ… WORKING:** `collect-blog.js`
- Location: `expansion-packs/etl-data-collector/collect-blog.js`
- Tested: 30/30 Sam Altman posts (100% success)
- Features: Auto-discovery, smart rules, progress bar, validation
- Output: Slug-based filenames (e.g., `how-to-be-successful.md`)

**ğŸ“ Related Files:**
```
expansion-packs/etl-data-collector/
â”œâ”€â”€ bin/                      âœ… NEW STRUCTURE
â”‚   â”œâ”€â”€ collect-blog.js       âœ… COMPLETE
â”‚   â”œâ”€â”€ collect-youtube.js    âœ… COMPLETE
â”‚   â”œâ”€â”€ collect-pdf.js        âœ… COMPLETE
â”‚   â””â”€â”€ collect-all.js        âœ… COMPLETE
â”œâ”€â”€ scripts/
â”‚   â”œâ”€â”€ utils/
â”‚   â”‚   â”œâ”€â”€ blog-discovery.js    âœ… COMPLETE
â”‚   â”‚   â””â”€â”€ youtube-discovery.js âœ… COMPLETE
â”‚   â”œâ”€â”€ collectors/
â”‚   â”‚   â”œâ”€â”€ web-collector.js     âœ… Updated (slug support)
â”‚   â”‚   â”œâ”€â”€ youtube-collector.js âœ… Updated (no metadata.json)
â”‚   â”‚   â”œâ”€â”€ pdf-collector.js     âœ… Updated (no metadata.json)
â”‚   â”‚   â””â”€â”€ ...
â”‚   â””â”€â”€ orchestrator/
â”‚       â””â”€â”€ parallel-collector.js âœ… Updated (outputDir pattern)
â””â”€â”€ docs/
    â””â”€â”€ BLOG_DISCOVERY.md     âœ… COMPLETE

expansion-packs/mmos-mind-mapper/
â””â”€â”€ tasks/
    â””â”€â”€ research-collection.md ğŸ”¨ TO UPDATE
```

### Architecture Pattern

All `collect-*.js` tools follow same pattern:

```javascript
// 1. DISCOVER sources (auto-detect what to collect)
const discovery = new SourceDiscovery(url);
const sources = await discovery.discover();

// 2. COLLECT sources (parallel with progress)
const collector = new ParallelCollector(config);
const report = await collector.collectAll(sources, outputDir);

// 3. VALIDATE results (confirm files created)
const validation = await validateCollection(sources, outputDir);

// 4. REPORT (consolidated summary)
console.log(`âœ… ${validation.valid}/${sources.length} collected`);
```

### Smart Rules (Blog Discovery)
1. **Featured Posts** - If blog has TOP/featured â†’ collect only those
2. **Recent Posts** - If no featured â†’ collect last 3 years
3. **Small Blogs** - If total < 50 posts â†’ collect 100%

### Key Dependencies
- `BlogDiscovery` - RSS/HTML scraping + smart rules
- `ParallelCollector` - Concurrent collection with progress
- Individual collectors - `web-collector.js`, `youtube-collector.js`, etc.
- Progress tracking - Built-in progress bars
- Validation - File existence + size checks

### Integration Points

**MMOS `research-collection.md` - BEFORE (Complex):**
```bash
# Step 1: Manual tier1_batch.yaml creation
# Step 2: node run-collection.js tier1_batch.yaml output/
# Step 3: Manual validation
# Step 4: Debug failures
# Step 5: Reprocess...
```

**MMOS `research-collection.md` - AFTER (Simple):**
```bash
# ONE COMMAND:
node collect-all.js https://blog.samaltman.com ./output
```

### Testing Standards
- **Unit tests:** Not required (scripts, not library)
- **Integration tests:** Manual testing with real blogs/videos
- **Validation:** Built into each tool (file checks, size checks)
- **Success criteria:**
  - 95%+ success rate on real-world sources
  - Clear error messages for failures
  - Progress visible in real-time

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-10-11 | 1.0 | Story created - MMOS collection simplification | Sarah (PO) |
| 2025-10-11 | 1.1 | Phase 1 (blog collection) marked complete | Sarah (PO) |

## Dev Agent Record

### Agent Model Used
_To be filled by dev agent during implementation_

### Debug Log References
_To be filled by dev agent during implementation_

### Completion Notes List
**Phase 1 Complete (2025-10-11):**
- âœ… `collect-blog.js` created and tested
- âœ… Validated with Sam Altman blog (30/30 posts, 100% success)
- âœ… Slug filenames working correctly
- âœ… Progress bar and validation integrated
- âœ… Documentation created (BLOG_DISCOVERY.md)

**Phase 2 Complete (2025-10-11):**
- âœ… `collect-youtube.js` created in `bin/`
- âœ… `youtube-discovery.js` utility created
- âœ… Supports single videos, channels, and playlists
- âœ… Smart rules: < 50 videos = 100%, else last 3 years
- âœ… yt-dlp integration for audio download
- âœ… AssemblyAI transcription with speaker diarization
- âœ… Progress tracking and validation built-in

**Phase 3 Complete (2025-10-11):**
- âœ… `collect-pdf.js` created in `bin/`
- âœ… Single PDF and batch modes supported
- âœ… URL download with streaming
- âœ… OCR support via Tesseract for scanned PDFs
- âœ… Chapter detection and quality assessment
- âœ… Progress tracking and validation built-in

**Phase 4 Complete (2025-10-11):**
- âœ… `collect-all.js` unified orchestrator created in `bin/`
- âœ… Handles mixed source types (blog, youtube, pdf, podcast)
- âœ… Routes to appropriate collectors automatically
- âœ… Consolidated reporting by type
- âœ… Retry failed sources option (--retry-failures)
- âœ… Comprehensive validation with breakdown by type

**Scripts Reorganization (2025-10-11):**
- âœ… All collection tools moved to `bin/` directory
- âœ… Updated imports to use relative paths from bin/
- âœ… Maintained backward compatibility with existing collectors

**Next:** Phase 5 - MMOS Integration (update research-collection.md task)

### File List
**Created:**
- `expansion-packs/etl-data-collector/bin/collect-blog.js` (moved from root)
- `expansion-packs/etl-data-collector/bin/collect-youtube.js`
- `expansion-packs/etl-data-collector/bin/collect-pdf.js`
- `expansion-packs/etl-data-collector/bin/collect-all.js`
- `expansion-packs/etl-data-collector/scripts/utils/blog-discovery.js`
- `expansion-packs/etl-data-collector/scripts/utils/youtube-discovery.js`
- `expansion-packs/etl-data-collector/docs/BLOG_DISCOVERY.md`
- `docs/stories/1.1.simplify-mmos-collection.md` (this file)

**Modified:**
- `expansion-packs/etl-data-collector/scripts/collectors/web-collector.js` (added slug support, removed metadata.json)
- `expansion-packs/etl-data-collector/scripts/collectors/youtube-collector.js` (removed metadata.json)
- `expansion-packs/etl-data-collector/scripts/collectors/pdf-collector.js` (removed metadata.json)
- `expansion-packs/etl-data-collector/scripts/collectors/podcast-collector.js` (removed metadata.json)
- `expansion-packs/etl-data-collector/scripts/collectors/social-collector.js` (removed metadata.json)
- `expansion-packs/etl-data-collector/scripts/orchestrator/parallel-collector.js` (outputDir pattern)
- `expansion-packs/etl-data-collector/run-collection.js` (AIOS-compliant CLI args)

**To Update:**
- `expansion-packs/mmos-mind-mapper/tasks/research-collection.md`
- `expansion-packs/mmos-mind-mapper/README.md`
- `expansion-packs/etl-data-collector/README.md`

## QA Results
_To be filled by QA agent after implementation_

---

**Story Status:** Phase 1 âœ… | Phase 2-6 â³
**Next Action:** Build `collect-youtube.js` or update MMOS task
**Priority:** ğŸ”´ HIGH
**Target:** Complete this session
