{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Discovery Agent v3.2 HYBRID Output Schema",
  "description": "Complete source discovery output with dual-lens assessment and collection readiness",
  "type": "object",
  "required": [
    "discovery_metadata",
    "signature_analysis",
    "sources",
    "portfolio_analysis",
    "gaps_identified",
    "collection_readiness",
    "pre_evaluation_readiness"
  ],
  "properties": {
    "discovery_metadata": {
      "type": "object",
      "required": ["person_name", "discovery_date", "agent_version", "total_sources_found"],
      "properties": {
        "person_name": { "type": "string" },
        "target_role": { "type": "string" },
        "discovery_date": { "type": "string", "format": "date-time" },
        "agent_version": { "type": "string", "const": "3.2_hybrid" },
        "search_duration_minutes": { "type": "number", "minimum": 0 },
        "total_sources_found": { "type": "integer", "minimum": 0 }
      }
    },
    
    "signature_analysis": {
      "type": "object",
      "required": ["visibility_level", "content_abundance", "communication_style"],
      "properties": {
        "visibility_level": {
          "type": "string",
          "enum": ["mainstream", "thought_leader", "niche_expert", "emerging"]
        },
        "content_abundance": {
          "type": "string",
          "enum": ["abundant", "moderate", "scarce"]
        },
        "peak_periods": {
          "type": "array",
          "items": { "type": "string", "pattern": "^\\d{4}-\\d{4}$" }
        },
        "communication_style": {
          "type": "string",
          "enum": ["longform", "essayist", "thinker_in_public", "private", "mixed"]
        },
        "platforms_primary": {
          "type": "array",
          "items": { "type": "string" }
        },
        "vulnerability_assessment": {
          "type": "string",
          "enum": ["open", "moderate", "guarded"]
        },
        "expertise_assessment": {
          "type": "string",
          "enum": ["technical", "high_level", "mixed"]
        },
        "career_phases": {
          "type": "object",
          "properties": {
            "formative": { "type": ["string", "null"], "pattern": "^\\d{4}-\\d{4}$|^null$" },
            "growth": { "type": ["string", "null"], "pattern": "^\\d{4}-\\d{4}$|^null$" },
            "maturity": { "type": ["string", "null"], "pattern": "^\\d{4}-\\d{4}$|^null$" },
            "current": { "type": "string", "pattern": "^\\d{4}-present$" }
          }
        },
        "social_media_presence": {
          "type": "object",
          "properties": {
            "active": { "type": "boolean" },
            "platforms": { "type": "array", "items": { "type": "string" } },
            "content_quality": {
              "type": "string",
              "enum": ["substantive", "promotional", "mixed"]
            }
          }
        },
        "public_records_available": {
          "type": "object",
          "properties": {
            "patents": { "type": "boolean" },
            "academic": { "type": "boolean" },
            "corporate": { "type": "boolean" },
            "legal": { "type": "boolean" }
          }
        },
        "controversial_material_exists": { "type": "boolean" }
      }
    },
    
    "sources": {
      "type": "array",
      "items": {
        "type": "object",
        "required": ["id", "category", "title", "dual_lens_assessment", "legacy_quality_scores", "classification", "collection_specs"],
        "properties": {
          "id": { "type": "string", "pattern": "^source_\\d{3,}$" },
          "category": {
            "type": "string",
            "enum": [
              "primary_longform",
              "primary_shortform",
              "social_media",
              "public_record",
              "thirdparty_bio",
              "controversial",
              "contextual",
              "tertiary"
            ]
          },
          "title": { "type": "string", "minLength": 1 },
          "url": { "type": ["string", "null"], "format": "uri" },
          "date_published": { "type": ["string", "null"], "format": "date" },
          
          "dual_lens_assessment": {
            "type": "object",
            "required": ["psychological", "expertise"],
            "properties": {
              "psychological": {
                "type": "object",
                "required": ["layer_potential", "authenticity_confidence"],
                "properties": {
                  "layer_potential": { "type": "string", "enum": ["high", "mid", "low"] },
                  "vulnerability_signals": { "type": "array", "items": { "type": "string" } },
                  "performance_mode_flags": { "type": "array", "items": { "type": "string" } },
                  "authenticity_confidence": { "type": "string", "enum": ["high", "medium", "low"] }
                }
              },
              "expertise": {
                "type": "object",
                "required": ["expertise_level", "expertise_confidence"],
                "properties": {
                  "domains_covered": { "type": "array", "items": { "type": "string" } },
                  "expertise_level": { "type": "integer", "minimum": 1, "maximum": 5 },
                  "practical_signals": { "type": "array", "items": { "type": "string" } },
                  "expertise_confidence": { "type": "string", "enum": ["high", "medium", "low"] }
                }
              }
            }
          },
          
          "legacy_quality_scores": {
            "type": "object",
            "required": ["authenticity", "relevance", "technical_quality", "score_total"],
            "properties": {
              "authenticity": { "type": "number", "minimum": 1, "maximum": 10 },
              "relevance": { "type": "number", "minimum": 1, "maximum": 10 },
              "technical_quality": { "type": "number", "minimum": 1, "maximum": 10 },
              "score_total": { "type": "number", "minimum": 1, "maximum": 10 }
            }
          },
          
          "classification": {
            "type": "object",
            "required": ["temporal_phase", "context_type", "evidence_type"],
            "properties": {
              "temporal_phase": {
                "type": "string",
                "enum": ["current", "recent", "context", "formative"]
              },
              "years_ago": { "type": "number", "minimum": 0 },
              "context_type": {
                "type": "string",
                "enum": ["professional", "philosophical", "personal", "casual"]
              },
              "evidence_type": {
                "type": "string",
                "enum": ["self_report", "third_party"]
              }
            }
          },
          
          "metadata": {
            "type": "object",
            "properties": {
              "platform": { "type": "string" },
              "author_interviewer": { "type": ["string", "null"] },
              "duration_minutes": { "type": ["number", "null"], "minimum": 0 },
              "word_count_estimate": { "type": ["integer", "null"], "minimum": 0 },
              "language": { "type": "string" },
              "has_transcript": { "type": "boolean" },
              "format": {
                "type": "string",
                "enum": ["book", "podcast", "essay", "video", "article", "interview", "conference_talk", "social_post", "patent", "paper", "profile", "other"]
              }
            }
          },
          
          "collection_specs": {
            "type": "object",
            "required": ["access_method", "difficulty", "priority"],
            "properties": {
              "access_method": {
                "type": "string",
                "enum": ["free", "paywall", "purchase", "institutional", "restricted"]
              },
              "difficulty": { "type": "string", "enum": ["easy", "medium", "hard"] },
              "estimated_time_hours": { "type": "number", "minimum": 0 },
              "tools_needed": { "type": "array", "items": { "type": "string" } },
              "estimated_cost": { "type": ["number", "null"], "minimum": 0 },
              "priority": { "type": "string", "enum": ["CRITICAL", "HIGH", "MEDIUM", "LOW"] },
              "priority_rationale": { "type": "string" }
            }
          },
          
          "concerns": { "type": "array", "items": { "type": "string" } },
          "notes": { "type": ["string", "null"] }
        }
      }
    },
    
    "portfolio_analysis": {
      "type": "object",
      "required": [
        "category_distribution",
        "dual_lens_scores",
        "temporal_distribution",
        "context_distribution",
        "evidence_distribution",
        "legacy_aggregates"
      ],
      "properties": {
        "category_distribution": {
          "type": "object",
          "properties": {
            "primary_longform": { "type": "integer", "minimum": 0 },
            "primary_shortform": { "type": "integer", "minimum": 0 },
            "social_media": { "type": "integer", "minimum": 0 },
            "public_records": { "type": "integer", "minimum": 0 },
            "thirdparty_bio": { "type": "integer", "minimum": 0 },
            "controversial": { "type": "integer", "minimum": 0 },
            "contextual": { "type": "integer", "minimum": 0 },
            "tertiary": { "type": "integer", "minimum": 0 }
          }
        },
        
        "dual_lens_scores": {
          "type": "object",
          "required": ["psychological_depth", "expertise_coverage"],
          "properties": {
            "psychological_depth": {
              "type": "object",
              "required": ["estimated_depth_score", "assessment"],
              "properties": {
                "high_layer_sources_count": { "type": "integer", "minimum": 0 },
                "high_layer_percentage": { "type": "number", "minimum": 0, "maximum": 100 },
                "vulnerability_signals_total": { "type": "integer", "minimum": 0 },
                "performance_mode_percentage": { "type": "number", "minimum": 0, "maximum": 100 },
                "estimated_depth_score": { "type": "number", "minimum": 0, "maximum": 10 },
                "assessment": {
                  "type": "string",
                  "enum": ["excellent", "good", "needs_work", "insufficient"]
                }
              }
            },
            "expertise_coverage": {
              "type": "object",
              "required": ["by_domain", "overall_score"],
              "properties": {
                "by_domain": {
                  "type": "object",
                  "patternProperties": {
                    ".*": {
                      "type": "object",
                      "required": ["sources_count", "average_level", "assessment"],
                      "properties": {
                        "sources_count": { "type": "integer", "minimum": 0 },
                        "level_4_plus_count": { "type": "integer", "minimum": 0 },
                        "average_level": { "type": "number", "minimum": 1, "maximum": 5 },
                        "assessment": {
                          "type": "string",
                          "enum": ["mastery", "expert", "practitioner", "weak", "gap"]
                        }
                      }
                    }
                  }
                },
                "overall_score": { "type": "number", "minimum": 0, "maximum": 10 }
              }
            }
          }
        },
        
        "temporal_distribution": {
          "type": "object",
          "required": ["current_2y", "recent_3_4y", "context_5_8y", "formative_9plus", "overall_assessment"],
          "properties": {
            "current_2y": {
              "type": "object",
              "required": ["count", "percentage", "target", "status"],
              "properties": {
                "count": { "type": "integer", "minimum": 0 },
                "percentage": { "type": "number", "minimum": 0, "maximum": 100 },
                "target": { "type": "string", "const": "40-50%" },
                "status": { "type": "string", "enum": ["on_target", "below", "above"] }
              }
            },
            "recent_3_4y": {
              "type": "object",
              "required": ["count", "percentage", "target", "status"],
              "properties": {
                "count": { "type": "integer", "minimum": 0 },
                "percentage": { "type": "number", "minimum": 0, "maximum": 100 },
                "target": { "type": "string", "const": "20-30%" },
                "status": { "type": "string", "enum": ["on_target", "below", "above"] }
              }
            },
            "context_5_8y": {
              "type": "object",
              "required": ["count", "percentage", "target", "status"],
              "properties": {
                "count": { "type": "integer", "minimum": 0 },
                "percentage": { "type": "number", "minimum": 0, "maximum": 100 },
                "target": { "type": "string", "const": "15-20%" },
                "status": { "type": "string", "enum": ["on_target", "below", "above"] }
              }
            },
            "formative_9plus": {
              "type": "object",
              "required": ["count", "percentage", "target", "status"],
              "properties": {
                "count": { "type": "integer", "minimum": 0 },
                "percentage": { "type": "number", "minimum": 0, "maximum": 100 },
                "target": { "type": "string", "const": "5-15%" },
                "status": { "type": "string", "enum": ["on_target", "below", "above"] }
              }
            },
            "clustering_detected": { "type": "boolean" },
            "clustering_period": { "type": ["string", "null"] },
            "overall_assessment": {
              "type": "string",
              "enum": ["excellent", "good", "needs_work", "problematic"]
            }
          }
        },
        
        "context_distribution": {
          "type": "object",
          "required": ["professional", "philosophical", "personal", "casual", "assessment"],
          "properties": {
            "professional": {
              "type": "object",
              "required": ["count", "percentage", "target"],
              "properties": {
                "count": { "type": "integer", "minimum": 0 },
                "percentage": { "type": "number", "minimum": 0, "maximum": 100 },
                "target": { "type": "string", "const": "40-50%" }
              }
            },
            "philosophical": {
              "type": "object",
              "required": ["count", "percentage", "target"],
              "properties": {
                "count": { "type": "integer", "minimum": 0 },
                "percentage": { "type": "number", "minimum": 0, "maximum": 100 },
                "target": { "type": "string", "const": "25-35%" }
              }
            },
            "personal": {
              "type": "object",
              "required": ["count", "percentage", "target"],
              "properties": {
                "count": { "type": "integer", "minimum": 0 },
                "percentage": { "type": "number", "minimum": 0, "maximum": 100 },
                "target": { "type": "string", "const": "15-25%" }
              }
            },
            "casual": {
              "type": "object",
              "required": ["count", "percentage", "target"],
              "properties": {
                "count": { "type": "integer", "minimum": 0 },
                "percentage": { "type": "number", "minimum": 0, "maximum": 100 },
                "target": { "type": "string", "const": "5-15%" }
              }
            },
            "assessment": {
              "type": "string",
              "enum": ["diverse", "adequate", "one_dimensional"]
            }
          }
        },
        
        "evidence_distribution": {
          "type": "object",
          "required": ["self_report", "third_party", "assessment"],
          "properties": {
            "self_report": {
              "type": "object",
              "required": ["count", "percentage", "target"],
              "properties": {
                "count": { "type": "integer", "minimum": 0 },
                "percentage": { "type": "number", "minimum": 0, "maximum": 100 },
                "target": { "type": "string", "const": "70-80%" }
              }
            },
            "third_party": {
              "type": "object",
              "required": ["count", "percentage", "target"],
              "properties": {
                "count": { "type": "integer", "minimum": 0 },
                "percentage": { "type": "number", "minimum": 0, "maximum": 100 },
                "target": { "type": "string", "const": "20-30%" }
              }
            },
            "assessment": {
              "type": "string",
              "enum": ["balanced", "needs_more_third_party", "excessive_self_report"]
            }
          }
        },
        
        "legacy_aggregates": {
          "type": "object",
          "required": ["authenticity_avg", "relevance_avg", "technical_quality_avg", "confidence_overall"],
          "properties": {
            "authenticity_avg": { "type": "number", "minimum": 1, "maximum": 10 },
            "relevance_avg": { "type": "number", "minimum": 1, "maximum": 10 },
            "technical_quality_avg": { "type": "number", "minimum": 1, "maximum": 10 },
            "total_audio_hours": { "type": "number", "minimum": 0 },
            "total_text_pages": { "type": "integer", "minimum": 0 },
            "period_covered_start": { "type": "string", "pattern": "^\\d{4}$" },
            "period_covered_end": { "type": "string", "pattern": "^\\d{4}$" },
            "confidence_overall": { "type": "number", "minimum": 1, "maximum": 10 }
          }
        }
      }
    },
    
    "gaps_identified": {
      "type": "array",
      "items": {
        "type": "object",
        "required": ["gap_type", "severity", "current_state", "target_state", "impact", "recommended_actions"],
        "properties": {
          "gap_type": { "type": "string" },
          "severity": { "type": "string", "enum": ["critical", "important", "moderate"] },
          "trigger": { "type": "string" },
          "current_state": { "type": "string" },
          "target_state": { "type": "string" },
          "impact": { "type": "string" },
          "recommended_actions": {
            "type": "array",
            "items": {
              "type": "object",
              "required": ["action", "rationale"],
              "properties": {
                "action": { "type": "string" },
                "rationale": { "type": "string" },
                "estimated_time": { "type": "string" },
                "priority": { "type": "integer", "minimum": 1 }
              }
            }
          }
        }
      }
    },
    
    "collection_readiness": {
      "type": "object",
      "required": ["feasibility", "prioritized_collection_plan"],
      "properties": {
        "feasibility": {
          "type": "object",
          "required": ["access", "estimated_cost_usd", "estimated_time_hours", "overall_feasibility"],
          "properties": {
            "access": {
              "type": "object",
              "required": ["free", "paywall", "purchase", "institutional", "restricted"],
              "properties": {
                "free": { "type": "integer", "minimum": 0 },
                "paywall": { "type": "integer", "minimum": 0 },
                "purchase": { "type": "integer", "minimum": 0 },
                "institutional": { "type": "integer", "minimum": 0 },
                "restricted": { "type": "integer", "minimum": 0 }
              }
            },
            "estimated_cost_usd": { "type": "number", "minimum": 0 },
            "estimated_time_hours": { "type": "number", "minimum": 0 },
            "tools_required": { "type": "array", "items": { "type": "string" } },
            "overall_feasibility": {
              "type": "string",
              "enum": ["all_accessible", "mostly_accessible", "significant_barriers"]
            }
          }
        },
        "prioritized_collection_plan": {
          "type": "object",
          "required": ["critical", "high", "medium", "low"],
          "properties": {
            "critical": {
              "type": "object",
              "required": ["source_ids", "count", "estimated_hours"],
              "properties": {
                "source_ids": { "type": "array", "items": { "type": "string" } },
                "count": { "type": "integer", "minimum": 0 },
                "estimated_hours": { "type": "number", "minimum": 0 }
              }
            },
            "high": {
              "type": "object",
              "required": ["source_ids", "count", "estimated_hours"],
              "properties": {
                "source_ids": { "type": "array", "items": { "type": "string" } },
                "count": { "type": "integer", "minimum": 0 },
                "estimated_hours": { "type": "number", "minimum": 0 }
              }
            },
            "medium": {
              "type": "object",
              "required": ["source_ids", "count", "estimated_hours"],
              "properties": {
                "source_ids": { "type": "array", "items": { "type": "string" } },
                "count": { "type": "integer", "minimum": 0 },
                "estimated_hours": { "type": "number", "minimum": 0 }
              }
            },
            "low": {
              "type": "object",
              "required": ["source_ids", "count", "estimated_hours"],
              "properties": {
                "source_ids": { "type": "array", "items": { "type": "string" } },
                "count": { "type": "integer", "minimum": 0 },
                "estimated_hours": { "type": "number", "minimum": 0 }
              }
            }
          }
        }
      }
    },
    
    "pre_evaluation_readiness": {
      "type": "object",
      "required": ["ready", "estimated_score", "confidence", "recommendation"],
      "properties": {
        "ready": { "type": "boolean" },
        "estimated_score": { "type": "number", "minimum": 0, "maximum": 10 },
        "confidence": { "type": "string", "enum": ["high", "medium", "low"] },
        "blocking_issues": { "type": "array", "items": { "type": "string" } },
        "recommendation": {
          "type": "string",
          "enum": ["proceed", "fix_critical_gaps", "major_work_needed"]
        }
      }
    }
  }
}
