# Aula 2.3 - API Simples: Conecte Sistemas sem Zapier

**M√≥dulo:** 2 - Arsenal Pr√°tico  
**Dura√ß√£o:** 15 minutos  
**N√≠vel Bloom:** Create  
**Instrutor:** Jos√© Carlos Amorim

---

## üéØ GOAL

Criar **API REST b√°sica** que conecta sistemas diferentes - tipo seu CRM ‚Üí script customizado ‚Üí planilha Google. Tudo automatizado, sem Zapier pago.

**Resultado concreto:** API com 3 endpoints funcionando (GET lista, POST novo item, webhook de recebimento) rodando localmente.

---

## üìç POSITION

Voc√™ j√° scrapeou dados (2.1) e processou em massa (2.2). Agora precisa **integrar sistemas**.

**Sabe aquele momento** que voc√™ quer automatizar fluxo tipo:

*"Quando form do Typeform √© preenchido ‚Üí meu script enriquece dados ‚Üí envia para Notion database"*

Zapier faz isso... mas:
- Cobra R$200-400/m√™s para tasks avan√ßados
- N√£o tem l√≥gica customizada (s√≥ condicionais b√°sicas)
- Seu script Python n√£o roda direto no Zapier

**Solu√ß√£o:** Criar API que **RECEBE dados do Zapier**, processa com SEU c√≥digo, retorna resultado.

**API = tomada el√©trica universal para sistemas.** Qualquer coisa se conecta, desde que fale a mesma "linguagem" (HTTP/JSON).

---

## üîÑ STEPS

### PASSO 1: O Que √â API em 2 Minutos (2min)

#### MET√ÅFORA: RESTAURANTE

**Voc√™** = Cliente  
**Cozinha** = Sistema/Database  
**Gar√ßom** = API

Voc√™ n√£o entra na cozinha pegando comida. Voc√™ **pede ao gar√ßom** (API), ele leva pedido pra cozinha, traz resposta.

**API = gar√ßom entre sistemas.**

#### REST API B√ÅSICO

REST = conjunto de regras para APIs web.

**4 opera√ß√µes principais:**

1. **GET** (buscar dados)
   - "Me d√° lista de clientes"
   - Navegador faz GET quando voc√™ acessa site

2. **POST** (criar novo)
   - "Adiciona novo cliente: Jo√£o Silva"
   - Form submit faz POST

3. **PUT** (atualizar existente)
   - "Atualiza email do cliente #42"

4. **DELETE** (remover)
   - "Deleta cliente #99"

**Voc√™ vai criar endpoints para GET e POST.** Suficiente para 80% dos casos.

---

### PASSO 2: Primeira API com Flask (5min)

#### PROMPT PARA CLAUDE

```
Criar API REST simples em Python usando Flask:

Caso de uso: Gerenciar lista de leads

Endpoints:
1. GET /leads - Retorna todos leads (JSON)
2. POST /leads - Adiciona novo lead
3. GET /leads/<id> - Retorna lead espec√≠fico

Estrutura lead: {id, nome, email, empresa, status}

Requisitos:
- Armazenar em mem√≥ria (lista Python) - MVP, sem banco de dados
- Valida√ß√£o b√°sica (email tem @, campos obrigat√≥rios)
- Retornar JSON formatado
- Incluir instru√ß√µes de teste (curl ou Postman)
```

**CLAUDE GERA:**

```python
from flask import Flask, request, jsonify

app = Flask(__name__)

# Banco de dados "fake" (em mem√≥ria)
leads = [
    {'id': 1, 'nome': 'Jo√£o Silva', 'email': 'joao@empresa.com', 'empresa': 'TechCorp', 'status': 'novo'},
    {'id': 2, 'nome': 'Maria Santos', 'email': 'maria@startup.com', 'empresa': 'StartupX', 'status': 'qualificado'}
]

contador_id = 3

# GET /leads - Lista todos
@app.route('/leads', methods=['GET'])
def get_leads():
    return jsonify({'total': len(leads), 'leads': leads})

# POST /leads - Adiciona novo
@app.route('/leads', methods=['POST'])
def add_lead():
    global contador_id
    
    data = request.json
    
    # Valida√ß√£o b√°sica
    if not data.get('nome') or not data.get('email'):
        return jsonify({'erro': 'Nome e email s√£o obrigat√≥rios'}), 400
    
    if '@' not in data.get('email'):
        return jsonify({'erro': 'Email inv√°lido'}), 400
    
    # Criar novo lead
    novo_lead = {
        'id': contador_id,
        'nome': data['nome'],
        'email': data['email'],
        'empresa': data.get('empresa', 'N/A'),
        'status': data.get('status', 'novo')
    }
    
    leads.append(novo_lead)
    contador_id += 1
    
    return jsonify({'mensagem': 'Lead criado!', 'lead': novo_lead}), 201

# GET /leads/<id> - Lead espec√≠fico
@app.route('/leads/<int:lead_id>', methods=['GET'])
def get_lead(lead_id):
    lead = next((l for l in leads if l['id'] == lead_id), None)
    
    if lead:
        return jsonify(lead)
    else:
        return jsonify({'erro': 'Lead n√£o encontrado'}), 404

if __name__ == '__main__':
    print("üöÄ API rodando em http://localhost:5000")
    app.run(debug=True)
```

**INSTALAR FLASK:**
```bash
pip3 install flask
```

**EXECUTAR:**
```bash
python3 api_leads.py
```

**OUTPUT:**
```
üöÄ API rodando em http://localhost:5000
 * Running on http://127.0.0.1:5000
```

**API est√° VIVA!** üéâ

---

### PASSO 3: Testar API (3min)

#### OP√á√ÉO 1: CURL (Terminal)

**GET todos leads:**
```bash
curl http://localhost:5000/leads
```

**Resposta:**
```json
{
  "total": 2,
  "leads": [
    {"id": 1, "nome": "Jo√£o Silva", "email": "joao@empresa.com", ...},
    {"id": 2, "nome": "Maria Santos", "email": "maria@startup.com", ...}
  ]
}
```

**POST novo lead:**
```bash
curl -X POST http://localhost:5000/leads \
  -H "Content-Type: application/json" \
  -d '{"nome": "Pedro Costa", "email": "pedro@tech.com", "empresa": "TechSolutions"}'
```

**Resposta:**
```json
{
  "mensagem": "Lead criado!",
  "lead": {"id": 3, "nome": "Pedro Costa", ...}
}
```

#### OP√á√ÉO 2: NAVEGADOR

Abre: `http://localhost:5000/leads`

Navegador faz GET autom√°tico ‚Üí V√™ JSON na tela.

#### OP√á√ÉO 3: POSTMAN (Recomendado para Testes)

1. Baixa Postman (gratuito)
2. Cria requisi√ß√£o GET ‚Üí `http://localhost:5000/leads`
3. Send ‚Üí V√™ resposta formatada
4. Testa POST com body JSON

---

### PASSO 4: Webhook para Zapier (3min)

#### CASO REAL: TYPEFORM ‚Üí SUA API ‚Üí NOTION

**Fluxo:**
1. Algu√©m preenche Typeform
2. Zapier detecta novo form
3. Zapier MANDA dados para SUA API (webhook)
4. Sua API processa (enriquece dados, valida, transforma)
5. Sua API retorna resultado
6. Zapier recebe e envia para Notion

**Adiciona endpoint webhook:**

```python
@app.route('/webhook/typeform', methods=['POST'])
def webhook_typeform():
    data = request.json
    
    # Processar dados do Typeform
    nome = data.get('nome')
    email = data.get('email')
    
    # L√ìGICA CUSTOMIZADA (aqui o valor est√°!)
    # Ex: Enriquecer com dados de API externa
    # Ex: Validar contra lista de clientes existentes
    # Ex: Calcular score de qualifica√ß√£o
    
    # Simples: adicionar timestamp
    from datetime import datetime
    data['processado_em'] = datetime.now().isoformat()
    data['score'] = len(data.get('mensagem', '')) * 2  # Score fake
    
    # Retornar dados processados
    return jsonify({
        'sucesso': True,
        'dados_processados': data
    }), 200
```

**NO ZAPIER:**

1. Trigger: Typeform "New Entry"
2. Action: Webhooks ‚Üí "POST to custom webhook"
3. URL: `http://SUA-API/webhook/typeform`
4. Body: JSON com dados do form
5. Action 2: Notion ‚Üí "Create Database Item"
6. Mapear response da sua API ‚Üí campos Notion

**Pronto!** Fluxo h√≠brido Zapier + c√≥digo customizado üöÄ

---

### PASSO 5: Deploy R√°pido (2min)

API rodando em `localhost` s√≥ funciona no seu computador.

**Para Zapier acessar, precisa de URL p√∫blica.**

#### OP√á√ÉO 1: NGROK (Tempor√°rio, Teste)

```bash
# Instala ngrok
brew install ngrok  # Mac
# ou baixa de ngrok.com

# Roda API normalmente
python3 api_leads.py

# Em outro terminal:
ngrok http 5000
```

**Ngrok d√° URL p√∫blica:**
```
https://abc123.ngrok.io ‚Üí localhost:5000
```

**Usa essa URL no Zapier** (vale por 2h gratuito).

#### OP√á√ÉO 2: HEROKU/RENDER (Produ√ß√£o)

**Render.com** (gratuito):
1. Sobe c√≥digo no GitHub
2. Conecta Render ao repo
3. Deploy autom√°tico
4. URL permanente: `https://sua-api.onrender.com`

**Pr√≥xima aula:** N√£o vamos cobrir deploy completo (fora do escopo), mas se precisar, prompt Claude: *"Como fazer deploy Flask no Render.com passo a passo"*

---

## üéì S√çNTESE

**O que voc√™ criou:**

1. **API REST funcional** com Flask
   - GET (buscar), POST (criar), valida√ß√£o
   - JSON input/output
   - Roda local em 5 minutos

2. **Webhook endpoint** para integra√ß√£o Zapier
   - Recebe dados externos
   - Processa com l√≥gica customizada
   - Retorna resultado para pr√≥ximo passo

3. **Casos de uso reais:**
   - CRM ‚Üí API ‚Üí Planilha (enriquecimento de dados)
   - Form ‚Üí API ‚Üí Database (valida√ß√£o/transforma√ß√£o)
   - Sistema A ‚Üí API ‚Üí Sistema B (ponte customizada)

4. **Por que APIs > Zapier sozinho:**
   - L√≥gica complexa (loops, regex, ML)
   - Integra√ß√£o com c√≥digo Python existente
   - Sem limite de tasks (Zapier cobra por execu√ß√£o)
   - Controle total do processamento

**Skills desbloqueadas:**
- ‚úÖ Criar API REST com Flask
- ‚úÖ Endpoints GET/POST
- ‚úÖ Valida√ß√£o JSON
- ‚úÖ Webhook para Zapier
- ‚úÖ Testar com curl/Postman

---

## üöÄ PR√ìXIMOS PASSOS

**Desafio:**

Pensa num fluxo atual seu que usa Zapier mas **trava** em alguma limita√ß√£o:
- "Zapier n√£o consegue fazer X"
- "Preciso de l√≥gica customizada"
- "Quero integrar com meu script Python"

Cria endpoint de API que resolve essa limita√ß√£o.

**Pr√≥xima aula (2.4):**
"Dashboard ao Vivo: Visualize Seus KPIs em Tempo Real"

API retorna dados. Mas visualizar JSON no navegador √© feio. Vamos criar dashboard web bonito que conecta na sua API.

**Dados (API) + Visual (Dashboard) = Sistema completo.** üí™

---

## üí≠ REFLEX√ÉO FINAL

**Porque no fundo...**

APIs parecem assustadoras quando voc√™ nunca fez.

Mas olha o que voc√™ acabou de criar: **sistema que conecta Typeform + l√≥gica customizada + Notion** em 15 minutos.

Desenvolvedores cobram R$5-15k para fazer isso.

Voc√™ fez com Claude Code em **15 minutos e 50 linhas de c√≥digo**.

**A diferen√ßa n√£o √© capacidade t√©cnica. √â saber que pode.** üöÄ

---

**Instrutor:** Jos√© Carlos Amorim  
**Dura√ß√£o:** 15 minutos  
**Framework:** GPS + Did√°tica Lend√°ria + ESPIRAL EXPANSIVA

