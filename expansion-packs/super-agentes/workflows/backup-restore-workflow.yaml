# Backup & Restore Workflow (Story 1.5)
workflow:
  id: "backup-restore"
  name: "Backup & Restore Database"
  version: "1.0.0"
metadata:
  story: "expansion-packs/super-agentes/docs/stories/1.5.backup-restore-workflow.md"
steps:
  - id: "operation"
    type: "elicit"
    elicit:
      question: "Backup/Restore operation:"
      options:
        - {label: "Create snapshot", value: "snapshot"}
        - {label: "Restore from snapshot", value: "restore"}
        - {label: "List snapshots", value: "list"}
      output_var: "operation"

  - id: "snapshot_label"
    condition: "{{operation}} == 'snapshot'"
    type: "elicit"
    elicit:
      fields:
        - {name: "label", label: "Snapshot label", type: "string", default: "manual"}
        - {name: "snapshot_type", label: "Type (schema/full)", type: "string", default: "schema"}
      output_vars: ["label", "snapshot_type"]

  - id: "create_snapshot"
    condition: "{{operation}} == 'snapshot'"
    type: "task"
    task: "db-snapshot"
    inputs: {label: "{{label}}", type: "{{snapshot_type}}"}

  - id: "list_snapshots"
    condition: "{{operation}} == 'list'"
    type: "execute"
    command: "ls -lht supabase/snapshots/*.sql | head -20"

  - id: "select_snapshot"
    condition: "{{operation}} == 'restore'"
    type: "elicit"
    elicit:
      fields:
        - {name: "snapshot_file", label: "Snapshot file", type: "string", required: true}
      output_vars: ["snapshot_file"]

  - id: "confirm_restore"
    condition: "{{operation}} == 'restore'"
    type: "elicit"
    elicit:
      question: "⚠️ WARNING: This will replace current database! Continue?"
      options:
        - {label: "Yes (I have backup)", value: "yes"}
        - {label: "No (cancel)", value: "no"}
      output_var: "confirm_restore"

  - id: "restore_snapshot"
    condition: "{{confirm_restore}} == 'yes'"
    type: "task"
    task: "db-rollback"
    inputs: {snapshot: "{{snapshot_file}}"}
