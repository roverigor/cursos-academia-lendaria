workflow:
  id: greenfield-course
  name: Greenfield Course Creation
  description: >-
    Agent workflow for creating online courses from scratch with no existing materials.
    Implements GPS + DidÃ¡tica LendÃ¡ria pedagogical frameworks with optional MMOS voice integration.
  type: greenfield
  project_types:
    - online-course
    - mini-course
    - certification-program
    - workshop
    - training-module

  sequence:
    - agent: course-architect
      creates: course-structure
      task: init-course-greenfield
      outputs:
        - course_slug
        - creation_mode: greenfield
        - mmos_persona_config
        - outputs/courses/{slug}/COURSE-BRIEF.md
      notes: |
        Initialize greenfield course structure:
        - Prompt for course slug (3-50 chars, kebab-case)
        - Validate folder does NOT exist (greenfield requirement)
        - Optional: Select MMOS persona for instructor voice
        - Create folder: outputs/courses/{slug}/
        - Copy COURSE-BRIEF.md template (8 empty sections)
        - Update frontmatter with metadata

        SAVE OUTPUT: Course structure created at outputs/courses/{slug}/

    - manual_halt_1:
      action: user_fills_course_brief
      requires: COURSE-BRIEF.md
      duration: 15-60 minutes
      notes: |
        âœ‹ WORKFLOW HALTED - Manual Step Required

        User must fill all 8 sections of COURSE-BRIEF.md:
          ðŸ“„ outputs/courses/{slug}/COURSE-BRIEF.md

        Sections to complete:
          1ï¸âƒ£ Basic Info - Title, subtitle, duration, prerequisites
          2ï¸âƒ£ ICP - Demographics, psychographics, pain points, goals
          3ï¸âƒ£ Content & Pedagogy - Learning objectives, outline, frameworks
          4ï¸âƒ£ Voice & Personality - Tone, style, teaching approach
          5ï¸âƒ£ Format & Delivery - Teaching style, content formats
          6ï¸âƒ£ Commercial - Pricing model, revenue targets
          7ï¸âƒ£ Success Metrics - KPIs, completion targets
          8ï¸âƒ£ Constraints - Limitations, special requirements

        When complete, continue with:
          @course-architect
          *generate-curriculum {slug}

    - agent: course-architect
      creates: curriculum.yaml
      task: generate-curriculum
      requires:
        - outputs/courses/{slug}/COURSE-BRIEF.md (filled)
      outputs:
        - outputs/courses/{slug}/curriculum.yaml
      notes: |
        Generate curriculum from COURSE-BRIEF:
        - Load and parse COURSE-BRIEF.md (all 8 sections)
        - Validate brief completeness (required fields check)
        - Generate curriculum structure:
          * MVP: Basic 3-module template
          * Production: AI-generated based on objectives
        - Validate curriculum structure (required fields)
        - Save curriculum.yaml

        Output structure:
          course_title: "..."
          total_duration_hours: X
          modules:
            - module_id: 1
              module_title: "..."
              lessons:
                - lesson_id: "1.1"
                  lesson_title: "..."
                  learning_objectives: [...]
                  bloom_level: "Remember/Understand/Apply/..."

        SAVE OUTPUT: curriculum.yaml created

    - manual_halt_2:
      action: curriculum_approval_checkpoint
      requires: curriculum.yaml
      duration: 5-15 minutes
      checkpoint: curriculum-approval
      notes: |
        âœ‹ WORKFLOW HALTED - Curriculum Approval Required

        Review generated curriculum:
          ðŸ“„ outputs/courses/{slug}/curriculum.yaml

        Approval options:
          1ï¸âƒ£ Approve curriculum â†’ Proceed to lesson generation
          2ï¸âƒ£ Edit curriculum.yaml â†’ Re-run generate-curriculum with --force
          3ï¸âƒ£ Edit COURSE-BRIEF.md â†’ Re-run generate-curriculum
          4ï¸âƒ£ Cancel â†’ Exit workflow

        When approved, continue with:
          @course-architect
          *generate-lessons {slug}

    - agent: course-architect
      creates: complete-course
      task: generate-lessons
      requires:
        - outputs/courses/{slug}/curriculum.yaml (approved)
        - outputs/courses/{slug}/COURSE-BRIEF.md
      outputs:
        - outputs/courses/{slug}/lessons/*.md
        - outputs/courses/{slug}/assessments/*.yaml
        - outputs/courses/{slug}/assessments/final-project.md
      resume_capable: true
      checkpoint_on_interrupt: true
      notes: |
        Generate all lessons and assessments (8-step workflow):

        STEP 1: Validate course exists
        STEP 2: Load COURSE-BRIEF.md (65 fields from 8 sections)
        STEP 3: Load curriculum.yaml
        STEP 4: Curriculum approval checkpoint (already passed)

        STEP 5: Generate All Lessons (GPS + DidÃ¡tica LendÃ¡ria)
          For each lesson in curriculum:
            - Build lesson spec (ID, objectives, duration, Bloom's level)
            - Generate content with AI:
              * IF mmos_persona enabled: Load system prompt, inject voice
              * ELSE: Use generic pedagogical template
            - Validate GPS structure (Goal â†’ Position â†’ Steps, score â‰¥ 30)
            - Validate DidÃ¡tica LendÃ¡ria (7 elements, score â‰¥ 70)
            - Retry up to 3x if validation fails
            - Save lesson to outputs/courses/{slug}/lessons/{lesson_id}.md
            - Update checkpoint (for --resume support)

        STEP 6: Validate Course Quality
          - GPS validation (all lessons)
          - DL validation (all lessons)
          - Voice fidelity (if MMOS enabled) [MVP: stub]
          - Bloom's progression check
          - Duration accuracy check

        STEP 7: Generate Assessments
          - Quiz scaffolds per module (YAML with [EDIT ME] placeholders)
          - Final project template (production-ready markdown)

        STEP 8: Cleanup & Summary
          - Display generation stats (lessons, time, cost)
          - Display validation results
          - Remove .state/ folder (checkpoints)

        RESUME SUPPORT:
          If interrupted (CTRL+C):
            - Progress saved to .state/lesson-generation.json
            - Resume with: *generate-lessons {slug} --resume
            - Skips already-generated lessons

        SAVE OUTPUT:
          outputs/courses/{slug}/
          â”œâ”€â”€ lessons/ (10-40 markdown files)
          â””â”€â”€ assessments/ (quiz YAML + final project MD)

    - agent: course-architect
      action: validate_course_quality
      task: validate-course
      requires:
        - outputs/courses/{slug}/lessons/
        - outputs/courses/{slug}/curriculum.yaml
      optional: true
      outputs:
        - validation_report
      notes: |
        OPTIONAL: Run comprehensive validation

        Validates:
          âœ… GPS structure (all lessons â‰¥ 30 points)
          âœ… DidÃ¡tica LendÃ¡ria (all lessons â‰¥ 70 points)
          âš ï¸ Voice fidelity (MMOS personas â‰¥ 85%) [MVP: stub]
          âœ… Bloom's taxonomy progression
          âœ… Duration accuracy (Â±25% tolerance)

        Output:
          - Overall pass/fail status
          - Per-lesson validation scores
          - Recommendations for improvement

        If validation fails:
          - Review failed lessons
          - Regenerate specific lessons if needed
          - Re-run validation

    - manual_finalization:
      action: review_and_publish
      requires: complete_course
      notes: |
        ðŸ“ MANUAL REVIEW & FINALIZATION

        1. Review Generated Lessons:
           - Check GPS structure (Goal â†’ Position â†’ Steps)
           - Verify voice consistency (especially if MMOS enabled)
           - Test with sample students (optional)

        2. Edit Assessment Scaffolds:
           âš ï¸ IMPORTANT: Quiz files contain [EDIT ME] placeholders
           - Replace all placeholders with real content
           - Create realistic scenarios
           - Design effective distractors

        3. Quality Validation:
           Run: @course-architect â†’ *validate-course {slug}

        4. Iterate:
           - Use feedback to improve
           - Regenerate specific lessons if needed:
             * Edit curriculum.yaml or COURSE-BRIEF.md
             * Re-run generation for specific modules

        5. Publish:
           - Export to LMS (if applicable)
           - Deploy to course platform
           - Launch to students

    - workflow_end:
      action: course_complete
      notes: |
        âœ… GREENFIELD COURSE GENERATION COMPLETE!

        ðŸ“‚ Course Location: outputs/courses/{slug}/

        Generated Files:
          â”œâ”€â”€ COURSE-BRIEF.md (8 sections filled)
          â”œâ”€â”€ curriculum.yaml (approved structure)
          â”œâ”€â”€ lessons/ (GPS + DL framework compliant)
          â””â”€â”€ assessments/ (scaffolds + final project)

        ðŸ“Š Quality Metrics:
          - GPS Validation: {gps_pass_rate}%
          - DL Validation: {dl_pass_rate}%
          - Voice Fidelity: {voice_fidelity}% (if MMOS)

        ðŸŽ¯ Next Steps:
          1. Review all generated lessons
          2. Complete assessment scaffolds ([EDIT ME] â†’ real content)
          3. Test course with beta students
          4. Iterate based on feedback
          5. Publish to production

        Reference: expansion-packs/creator-os/README.md

  flow_diagram: |
    ```mermaid
    graph TD
        A[Start: Greenfield Course] --> B[course-architect: init-course-greenfield]
        B --> B1{Course Structure Created}
        B1 --> C[HALT: User Fills COURSE-BRIEF.md]
        C --> D[User: Fill 8 Sections]
        D --> E[course-architect: generate-curriculum]
        E --> F{curriculum.yaml Generated}
        F --> G[HALT: Approve Curriculum]
        G --> H{User Approval}
        H -->|Approve| I[course-architect: generate-lessons]
        H -->|Edit curriculum| E1[User: Edit curriculum.yaml]
        H -->|Edit brief| D1[User: Edit COURSE-BRIEF.md]
        E1 --> E
        D1 --> E

        I --> J[Step 5: Generate All Lessons]
        J --> K{Lesson Loop}
        K --> L[Generate Lesson Content]
        L --> M[Validate GPS â‰¥ 30]
        M --> N{GPS Pass?}
        N -->|Fail| O[Retry 1-3x]
        N -->|Pass| P[Validate DL â‰¥ 70]
        O --> L
        P --> Q{DL Pass?}
        Q -->|Fail| O
        Q -->|Pass| R[Save Lesson]
        R --> S{More Lessons?}
        S -->|Yes| K
        S -->|No| T[Step 6: Validate Course]

        T --> U[Step 7: Generate Assessments]
        U --> V[Step 8: Summary & Cleanup]
        V --> W{Run Validation?}
        W -->|Yes| X[course-architect: validate-course]
        W -->|No| Y[Manual Review]
        X --> Y
        Y --> Z[Course Complete]

        J -.-> J1[CTRL+C: Save Checkpoint]
        J1 -.-> J2[Resume: --resume flag]
        J2 -.-> K

        B --> B2{MMOS Persona?}
        B2 -->|Yes| B3[Select MMOS Mind]
        B2 -->|No| C
        B3 --> C

        style Z fill:#90EE90
        style C fill:#FFE4B5
        style G fill:#FFE4B5
        style Y fill:#ADD8E6
        style J1 fill:#FFB6C1
        style J2 fill:#FFB6C1
    ```

  decision_guidance:
    when_to_use:
      - Creating courses from scratch (no existing materials)
      - Need structured pedagogical frameworks (GPS + DL)
      - Want consistent instructor voice (MMOS integration)
      - Require quality validation (GPS/DL scoring)
      - Building production-ready courses for students

    when_not_to_use:
      - Upgrading existing course materials (use brownfield-course)
      - Quick informal training (overkill for simple needs)
      - No pedagogical framework requirements

  performance_targets:
    mini_course:
      lessons: 3-5
      duration: "< 15 minutes"
      cost: "~$1-2 USD"

    standard_course:
      lessons: 8-15
      duration: "< 30 minutes"
      cost: "~$3-8 USD"

    extended_course:
      lessons: 20-40
      duration: "< 60 minutes"
      cost: "~$10-25 USD"

  handoff_prompts:
    init_to_user: |
      Course structure created!
      Save COURSE-BRIEF.md at outputs/courses/{slug}/COURSE-BRIEF.md
      Fill all 8 sections, then continue with curriculum generation.

    curriculum_to_user: |
      Curriculum generated!
      Review curriculum.yaml - it defines your course structure (modules + lessons).
      Approve to proceed, or edit and regenerate.

    lessons_complete: |
      All lessons generated!
      Review outputs/courses/{slug}/lessons/ for GPS + DL compliant content.
      Edit assessment scaffolds (replace [EDIT ME] placeholders).
      Run validation for quality check.

    workflow_complete: |
      Greenfield course complete!
      All artifacts saved in outputs/courses/{slug}/
      Review, test, iterate, then publish.
