workflow:
  id: greenfield-course
  name: Greenfield Course Creation
  description: >-
    Agent workflow for creating online courses from scratch with no existing materials.
    Implements GPS + Did√°tica Lend√°ria pedagogical frameworks with optional MMOS voice integration.
  type: greenfield
  project_types:
    - online-course
    - mini-course
    - certification-program
    - workshop
    - training-module

  sequence:
    - agent: course-architect
      creates: course-structure-and-context-detection
      task: init-course-greenfield
      outputs:
        - course_slug
        - creation_mode: greenfield
        - context: {greenfield_pure | pre_created_brief | legacy_materials}
        - mmos_persona_config
        - outputs/courses/{slug}/COURSE-BRIEF.md
        - outputs/courses/{slug}/.metadata.json
      notes: |
        Initialize greenfield course with INTELLIGENT CONTEXT DETECTION:

        STEP 1: Detect Context
          Check if outputs/courses/{slug}/ exists:
            - If NO ‚Üí SCENARIO A: Greenfield Pure
            - If YES ‚Üí Analyze contents:
              * Check COURSE-BRIEF.md completeness
              * Check for /sources/ materials
              * Determine scenario

        STEP 2: Execute Scenario-Appropriate Logic

        SCENARIO A: Greenfield Pure
          - Create folder com no m√°ximo 3 palavras: outputs/courses/{slug}/
          - Copy COURSE-BRIEF.md template (8 empty sections)
          - Create .metadata.json (context: greenfield_pure)
          - NEXT: User fills COURSE-BRIEF manually

        SCENARIO B: Pre-Created Brief (HYBRID MODE)
          - Validate existing COURSE-BRIEF.md (‚â•70% complete)
          - Detect /sources/ materials (optional)
          - Update .metadata.json (context: pre_created_brief)
          - SKIP manual filling ‚Üí Proceed to market research
          - NEXT: Auto-continue to market research

        SCENARIO C: Legacy Materials
          - Detect /sources/ but no COURSE-BRIEF
          - Suggest switching to brownfield mode (*upgrade)
          - HALT: Wait for user decision

        SAVE OUTPUT: Course initialized at outputs/courses/{slug}/

    - conditional_halt:
      action: context_based_decision
      duration: 0-60 minutes
      notes: |
        ‚öôÔ∏è CONDITIONAL CHECKPOINT (Context-Aware)

        IF context == "greenfield_pure":
          ‚úã WORKFLOW HALTED - Manual Step Required

          User must fill all 8 sections of COURSE-BRIEF.md:
            üìÑ outputs/courses/{slug}/COURSE-BRIEF.md

          Sections to complete:
            1Ô∏è‚É£ Basic Info - Title, subtitle, duration, prerequisites
            2Ô∏è‚É£ ICP - Demographics, psychographics, pain points, goals
            3Ô∏è‚É£ Content & Pedagogy - Learning objectives, outline, frameworks
            4Ô∏è‚É£ Voice & Personality - Tone, style, teaching approach
            5Ô∏è‚É£ Format & Delivery - Teaching style, content formats
            6Ô∏è‚É£ Commercial - Pricing model, revenue targets
            7Ô∏è‚É£ Success Metrics - KPIs, completion targets
            8Ô∏è‚É£ Constraints - Limitations, special requirements

          When complete, continue with:
            @course-architect
            *market-research {slug}

        IF context == "pre_created_brief":
          ‚úÖ AUTO-CONTINUE (No Manual Step Required)

          üìä Context Analysis:
            ‚úÖ COURSE-BRIEF.md: {completeness}% complete
            ‚úÖ Source materials: {count} files in /sources/
            ‚úÖ Mode: Greenfield (pre-created brief)

          üéØ Proceeding automatically to market research
            (Skipping manual filling - brief already complete!)

          System will now:
            1. Run market research (competitive intelligence)
            2. Reformulate COURSE-BRIEF with insights
            3. Present reformulated brief for review

          NO ACTION REQUIRED - Workflow continues automatically

        IF context == "legacy_materials":
          ‚ö†Ô∏è WORKFLOW RECOMMENDATION

          üìÇ Found {count} files in /sources/ but no COURSE-BRIEF.md

          üí° Recommendation: Switch to brownfield mode
            Command: *upgrade {slug}

          Brownfield mode will:
            - Auto-organize your source files
            - Auto-extract ICP, voice, objectives
            - Generate COURSE-BRIEF from materials
            - Run market research
            - Create optimized curriculum

          Options:
            1. Switch to brownfield: *upgrade {slug}
            2. Continue greenfield: Fill COURSE-BRIEF manually
            3. Cancel workflow

          Awaiting user decision...

    - agent: course-architect
      action: validate_course_brief
      task: validate-course-brief
      requires:
        - outputs/courses/{slug}/COURSE-BRIEF.md (filled)
      outputs:
        - outputs/courses/{slug}/validation-brief-report.md
      notes: |
        üîç QA CHECKPOINT 1: Validate COURSE-BRIEF Quality

        CRITICAL PRE-FLIGHT CHECK before spending 50K tokens on research.

        Validates:
          ‚úÖ Completeness (95%+ fields filled)
          ‚úÖ ICP Quality (‚â•80/100)
          ‚úÖ Learning Objectives (SMART, ‚â•80/100)
          ‚úÖ Framework Coherence (no mismatches)
          ‚úÖ Voice Clarity (MMOS or custom defined)
          ‚úÖ Outline Quality (logical structure)
          ‚úÖ No Critical Contradictions

        If FAIL (score <70): BLOCK workflow, show fixes needed

        Duration: 30-60 seconds
        SAVE OUTPUT: validation-brief-report.md

    - agent: course-architect
      creates: market-research-reports
      task: market-research
      requires:
        - outputs/courses/{slug}/COURSE-BRIEF.md (filled)
        - outputs/courses/{slug}/validation-brief-report.md (PASS)
      outputs:
        - outputs/courses/{slug}/research/market-analysis.md
        - outputs/courses/{slug}/research/content-gaps.md
        - outputs/courses/{slug}/research/differentiation.md
        - outputs/courses/{slug}/research/sources.md
      notes: |
        Conduct market research on similar courses:
        - Generate strategic search queries (topic, ICP, platform-specific)
        - Execute web searches (top 10-15 competitive courses)
        - Analyze curriculum patterns, pedagogical approaches, pricing
        - Identify content gaps and differentiation opportunities
        - Generate 4 research reports in /research/ folder

        Outputs used by generate-curriculum to:
          - Include gap topics in curriculum
          - Apply differentiation angles
          - Avoid commoditized patterns (unless core)
          - Leverage unique positioning

        Duration: 5-10 minutes
        SAVE OUTPUT: research/ folder with 4 markdown reports

    - agent: course-architect
      action: reformulate_course_brief
      task: reformulate-course-brief
      requires:
        - outputs/courses/{slug}/COURSE-BRIEF.md (initial version)
        - outputs/courses/{slug}/research/market-analysis.md
        - outputs/courses/{slug}/research/content-gaps.md
        - outputs/courses/{slug}/research/differentiation.md
      outputs:
        - outputs/courses/{slug}/COURSE-BRIEF.md (reformulated)
        - outputs/courses/{slug}/COURSE-BRIEF-ORIGINAL.md (backup)
      notes: |
        Reformulate COURSE-BRIEF based on market research insights:

        STEP 1: Backup Original
          - Copy COURSE-BRIEF.md ‚Üí COURSE-BRIEF-ORIGINAL.md
          - Preserve user's initial vision

        STEP 2: Load Research Insights
          - Load market-analysis.md (competitive patterns, pricing)
          - Load content-gaps.md (gap topics, priorities)
          - Load differentiation.md (positioning strategy)

        STEP 3: Reformulate COURSE-BRIEF Sections
          Section 1 (Basic Info):
            - Refine subtitle based on differentiation strategy
            - Adjust duration if market insights suggest different scope

          Section 2 (ICP):
            - Validate ICP against market (are we targeting underserved segment?)
            - Add competitive context ("Unlike competitors who target X, we target Y")

          Section 3 (Content & Pedagogy):
            - ADD gap topics to preliminary outline
            - Refine learning objectives based on market gaps
            - Highlight unique pedagogical approach (from differentiation.md)

          Section 4 (Voice & Personality):
            - Reinforce voice differentiation (if competitors are formal, emphasize casual)
            - Add signature style elements that competitors lack

          Section 5 (Format & Delivery):
            - Adjust format based on competitive analysis
            - If all competitors are lecture-heavy, emphasize hands-on approach

          Section 6 (Commercial):
            - Update pricing strategy based on market-analysis.md
            - Refine positioning statement from differentiation.md

          Section 7 (Success Metrics):
            - Add differentiation KPIs (e.g., "85% students say more practical than other courses")

          Section 8 (Constraints):
            - Note any competitive advantages to preserve

        STEP 4: Add Research Summary Section
          - Append new section to COURSE-BRIEF:

          ## 9. Market Research Summary (Auto-Generated)

          **Research Date:** {date}
          **Courses Analyzed:** {count}

          ### Key Insights:
          - {insight_1}
          - {insight_2}
          - {insight_3}

          ### Differentiation Strategy:
          {positioning_statement_from_differentiation_md}

          ### Gap Topics to Include:
          - {gap_topic_1} (P0 - Must address)
          - {gap_topic_2} (P1 - Should address)
          - {gap_topic_3} (P1 - Should address)

          ### Competitive Advantages:
          - {advantage_1}
          - {advantage_2}

          üìä Full Reports: outputs/courses/{slug}/research/

        STEP 5: Save Reformulated COURSE-BRIEF
          - Overwrite COURSE-BRIEF.md with reformulated version
          - Show diff summary (what changed)

        SAVE OUTPUT: COURSE-BRIEF.md (enriched with market intelligence)

    - manual_halt_research:
      action: review_reformulated_brief
      requires:
        - outputs/courses/{slug}/COURSE-BRIEF.md (reformulated)
      duration: 5-10 minutes
      notes: |
        ‚úã WORKFLOW HALTED - Review Reformulated COURSE-BRIEF

        üìä COURSE-BRIEF has been reformulated with market research insights!

        üìÑ Review updated file:
          outputs/courses/{slug}/COURSE-BRIEF.md

        üìÑ Compare with original:
          outputs/courses/{slug}/COURSE-BRIEF-ORIGINAL.md

        üîç Key Changes Made:
          ‚úÖ Section 3: Gap topics added to outline
          ‚úÖ Section 6: Pricing/positioning refined
          ‚úÖ Section 9: Market research summary appended

        üìä Full Research Reports:
          üìÑ market-analysis.md - Competitive landscape
          üìÑ content-gaps.md - Missing topics/depth
          üìÑ differentiation.md - Unique positioning

        Actions:
          1Ô∏è‚É£ Review all changes in COURSE-BRIEF.md
          2Ô∏è‚É£ Adjust if needed (you can edit directly)
          3Ô∏è‚É£ Validate differentiation strategy aligns with vision
          4Ô∏è‚É£ Confirm gap topics make sense

        When satisfied, continue with:
          @course-architect
          *validate-reformed-brief {slug}

    - agent: course-architect
      action: validate_reformed_brief
      task: validate-reformed-brief
      requires:
        - outputs/courses/{slug}/COURSE-BRIEF.md (reformulated)
        - outputs/courses/{slug}/COURSE-BRIEF-ORIGINAL.md
        - outputs/courses/{slug}/research/content-gaps.md
        - outputs/courses/{slug}/research/differentiation.md
      outputs:
        - outputs/courses/{slug}/validation-reformed-brief-report.md
      notes: |
        üîç QA CHECKPOINT 2: Validate Reformed COURSE-BRIEF Quality

        POST-RESEARCH INTEGRATION CHECK before spending 300K tokens on curriculum.

        Validates:
          ‚úÖ Research Integration (‚â•80/100)
            - Gap topics INTEGRATED into outline (not just Section 9)
            - Differentiation applied to brief (not just listed)
            - Market insights actionable (not data dump)
          ‚úÖ Positioning Clarity (specific, actionable statement)
          ‚úÖ Brief Evolution (improved, not just longer)
          ‚úÖ Alignment Preservation (core vision intact)
          ‚úÖ Gap Priority Respect (all P0 + ‚â•80% P1 integrated)
          ‚úÖ Actionability (ready for curriculum generation)

        If FAIL (score <70): BLOCK workflow, must integrate research properly

        Duration: 30-45 seconds
        SAVE OUTPUT: validation-reformed-brief-report.md

    - agent: course-architect
      creates: curriculum.yaml
      task: generate-curriculum
      requires:
        - outputs/courses/{slug}/COURSE-BRIEF.md (filled)
        - outputs/courses/{slug}/research/ (optional but recommended)
        - outputs/courses/{slug}/validation-reformed-brief-report.md (PASS)
      outputs:
        - outputs/courses/{slug}/curriculum.yaml
      notes: |
        Generate curriculum from COURSE-BRIEF + research insights:
        - Load and parse COURSE-BRIEF.md (all 8 sections)
        - Load market research (if available):
          * content-gaps.md ‚Üí topics to include
          * differentiation.md ‚Üí unique angles to apply
          * market-analysis.md ‚Üí patterns to avoid/embrace
        - Validate brief completeness (required fields check)
        - Generate curriculum structure:
          * MVP: Basic 3-module template
          * Production: AI-generated based on objectives + research
        - Apply differentiation strategy from research
        - Include gap topics identified in research
        - Validate curriculum structure (required fields)
        - Save curriculum.yaml

        Output structure:
          course_title: "..."
          total_duration_hours: X
          modules:
            - module_id: 1
              module_title: "..."
              lessons:
                - lesson_id: "1.1"
                  lesson_title: "..."
                  learning_objectives: [...]
                  bloom_level: "Remember/Understand/Apply/..."

        SAVE OUTPUT: curriculum.yaml created

    - manual_halt_2:
      action: curriculum_approval_checkpoint
      requires: curriculum.yaml
      duration: 5-15 minutes
      checkpoint: curriculum-approval
      notes: |
        ‚úã WORKFLOW HALTED - Curriculum Approval Required

        Review generated curriculum:
          üìÑ outputs/courses/{slug}/curriculum.yaml

        Approval options:
          1Ô∏è‚É£ Approve curriculum ‚Üí Proceed to lesson generation
          2Ô∏è‚É£ Edit curriculum.yaml ‚Üí Re-run generate-curriculum with --force
          3Ô∏è‚É£ Edit COURSE-BRIEF.md ‚Üí Re-run generate-curriculum
          4Ô∏è‚É£ Cancel ‚Üí Exit workflow

        When approved, continue with:
          @course-architect
          *generate-lessons {slug}

    - agent: course-architect
      creates: complete-course
      task: generate-lessons
      requires:
        - outputs/courses/{slug}/curriculum.yaml (approved)
        - outputs/courses/{slug}/COURSE-BRIEF.md
      outputs:
        - outputs/courses/{slug}/lessons/*.md
        - outputs/courses/{slug}/assessments/*.yaml
        - outputs/courses/{slug}/assessments/final-project.md
      resume_capable: true
      checkpoint_on_interrupt: true
      notes: |
        Generate all lessons and assessments (8-step workflow):

        STEP 1: Validate course exists
        STEP 2: Load COURSE-BRIEF.md (65 fields from 8 sections)
        STEP 3: Load curriculum.yaml
        STEP 4: Curriculum approval checkpoint (already passed)

        STEP 5: Generate All Lessons (GPS + Did√°tica Lend√°ria)
          For each MODULE in curriculum:
            For each LESSON in module:
              - Build lesson spec (ID, objectives, duration, Bloom's level)
              - Generate content with AI:
                * IF mmos_persona enabled: Load system prompt, inject voice
                * ELSE: Use generic pedagogical template
              - Validate GPS structure (Goal ‚Üí Position ‚Üí Steps, score ‚â• 30)
              - Validate Did√°tica Lend√°ria (7 elements, score ‚â• 70)
              - Retry up to 3x if validation fails
              - Save lesson to outputs/courses/{slug}/lessons/{lesson_id}.md
              - Update checkpoint (for --resume support)

            üîç QA CHECKPOINT 3 (Per-Module - OPTIONAL but RECOMMENDED):
              After completing all lessons in module:
                python scripts/validate_module.py {slug} {module_id}

              If FAIL:
                - Regenerate failed lessons
                - Re-validate module
                - Fix before proceeding to next module

              Benefits:
                - Catch issues incrementally (not at end)
                - Reduce regeneration cost (1 module vs. entire course)
                - 4,800% ROI (5K validation saves 240K regeneration)

        STEP 6: Validate Course Quality
          - GPS validation (all lessons)
          - DL validation (all lessons)
          - Voice fidelity (if MMOS enabled) [MVP: stub]
          - Bloom's progression check
          - Duration accuracy check

        STEP 7: Generate Assessments
          - Quiz scaffolds per module (YAML with [EDIT ME] placeholders)
          - Final project template (production-ready markdown)

        STEP 8: Cleanup & Summary
          - Display generation stats (lessons, time, cost)
          - Display validation results
          - Remove .state/ folder (checkpoints)

        RESUME SUPPORT:
          If interrupted (CTRL+C):
            - Progress saved to .state/lesson-generation.json
            - Resume with: *generate-lessons {slug} --resume
            - Skips already-generated lessons

        SAVE OUTPUT:
          outputs/courses/{slug}/
          ‚îú‚îÄ‚îÄ lessons/ (10-40 markdown files)
          ‚îî‚îÄ‚îÄ assessments/ (quiz YAML + final project MD)

    - agent: course-architect
      action: validate_course_quality
      task: validate-course
      requires:
        - outputs/courses/{slug}/lessons/
        - outputs/courses/{slug}/curriculum.yaml
      optional: true
      outputs:
        - validation_report
      notes: |
        OPTIONAL: Run comprehensive validation

        Validates:
          ‚úÖ GPS structure (all lessons ‚â• 30 points)
          ‚úÖ Did√°tica Lend√°ria (all lessons ‚â• 70 points)
          ‚ö†Ô∏è Voice fidelity (MMOS personas ‚â• 85%) [MVP: stub]
          ‚úÖ Bloom's taxonomy progression
          ‚úÖ Duration accuracy (¬±25% tolerance)

        Output:
          - Overall pass/fail status
          - Per-lesson validation scores
          - Recommendations for improvement

        If validation fails:
          - Review failed lessons
          - Regenerate specific lessons if needed
          - Re-run validation

    - manual_finalization:
      action: review_and_publish
      requires: complete_course
      notes: |
        üìù MANUAL REVIEW & FINALIZATION

        1. Review Generated Lessons:
           - Check GPS structure (Goal ‚Üí Position ‚Üí Steps)
           - Verify voice consistency (especially if MMOS enabled)
           - Test with sample students (optional)

        2. Edit Assessment Scaffolds:
           ‚ö†Ô∏è IMPORTANT: Quiz files contain [EDIT ME] placeholders
           - Replace all placeholders with real content
           - Create realistic scenarios
           - Design effective distractors

        3. Quality Validation:
           Run: @course-architect ‚Üí *validate-course {slug}

        4. Iterate:
           - Use feedback to improve
           - Regenerate specific lessons if needed:
             * Edit curriculum.yaml or COURSE-BRIEF.md
             * Re-run generation for specific modules

        5. Publish:
           - Export to LMS (if applicable)
           - Deploy to course platform
           - Launch to students

    - workflow_end:
      action: course_complete
      notes: |
        ‚úÖ GREENFIELD COURSE GENERATION COMPLETE!

        üìÇ Course Location: outputs/courses/{slug}/

        Generated Files:
          ‚îú‚îÄ‚îÄ COURSE-BRIEF.md (8 sections filled)
          ‚îú‚îÄ‚îÄ curriculum.yaml (approved structure)
          ‚îú‚îÄ‚îÄ lessons/ (GPS + DL framework compliant)
          ‚îî‚îÄ‚îÄ assessments/ (scaffolds + final project)

        üìä Quality Metrics:
          - GPS Validation: {gps_pass_rate}%
          - DL Validation: {dl_pass_rate}%
          - Voice Fidelity: {voice_fidelity}% (if MMOS)

        üéØ Next Steps:
          1. Review all generated lessons
          2. Complete assessment scaffolds ([EDIT ME] ‚Üí real content)
          3. Test course with beta students
          4. Iterate based on feedback
          5. Publish to production

        Reference: expansion-packs/creator-os/README.md

  flow_diagram: |
    ```mermaid
    graph TD
        A[Start: Greenfield Course] --> B[course-architect: init-course-greenfield]
        B --> B1{Course Structure Created}
        B1 --> C[HALT: User Fills COURSE-BRIEF.md]
        C --> D[User: Fill 8 Sections]
        D --> D2[course-architect: market-research]
        D2 --> D3[Web Search: Competitive Courses]
        D3 --> D4[Analyze: Patterns, Gaps, Differentiation]
        D4 --> D5{Research Reports Generated}
        D5 --> D6[course-architect: reformulate-course-brief]
        D6 --> D7[Integrate Research into COURSE-BRIEF]
        D7 --> D8[Backup Original + Add Section 9]
        D8 --> D9{COURSE-BRIEF Reformulated}
        D9 --> D10[HALT: Review Reformulated COURSE-BRIEF]
        D10 --> E[course-architect: generate-curriculum]
        E --> F{curriculum.yaml Generated}
        F --> G[HALT: Approve Curriculum]
        G --> H{User Approval}
        H -->|Approve| I[course-architect: generate-lessons]
        H -->|Edit curriculum| E1[User: Edit curriculum.yaml]
        H -->|Edit brief| D1[User: Edit COURSE-BRIEF.md]
        E1 --> E
        D1 --> E

        I --> J[Step 5: Generate All Lessons]
        J --> K{Lesson Loop}
        K --> L[Generate Lesson Content]
        L --> M[Validate GPS ‚â• 30]
        M --> N{GPS Pass?}
        N -->|Fail| O[Retry 1-3x]
        N -->|Pass| P[Validate DL ‚â• 70]
        O --> L
        P --> Q{DL Pass?}
        Q -->|Fail| O
        Q -->|Pass| R[Save Lesson]
        R --> S{More Lessons?}
        S -->|Yes| K
        S -->|No| T[Step 6: Validate Course]

        T --> U[Step 7: Generate Assessments]
        U --> V[Step 8: Summary & Cleanup]
        V --> W{Run Validation?}
        W -->|Yes| X[course-architect: validate-course]
        W -->|No| Y[Manual Review]
        X --> Y
        Y --> Z[Course Complete]

        J -.-> J1[CTRL+C: Save Checkpoint]
        J1 -.-> J2[Resume: --resume flag]
        J2 -.-> K

        B --> B2{MMOS Persona?}
        B2 -->|Yes| B3[Select MMOS Mind]
        B2 -->|No| C
        B3 --> C

        style Z fill:#90EE90
        style C fill:#FFE4B5
        style D10 fill:#FFE4B5
        style G fill:#FFE4B5
        style Y fill:#ADD8E6
        style J1 fill:#FFB6C1
        style J2 fill:#FFB6C1
        style D2 fill:#E0F2F7
        style D3 fill:#E0F2F7
        style D4 fill:#E0F2F7
        style D6 fill:#B0E0E6
        style D7 fill:#B0E0E6
        style D8 fill:#B0E0E6
    ```

  decision_guidance:
    when_to_use:
      - Creating courses from scratch (no existing materials)
      - Need structured pedagogical frameworks (GPS + DL)
      - Want consistent instructor voice (MMOS integration)
      - Require quality validation (GPS/DL scoring)
      - Building production-ready courses for students

    when_not_to_use:
      - Upgrading existing course materials (use brownfield-course)
      - Quick informal training (overkill for simple needs)
      - No pedagogical framework requirements

  performance_targets:
    mini_course:
      lessons: 3-5
      duration: "< 15 minutes"
      cost: "~$1-2 USD"

    standard_course:
      lessons: 8-15
      duration: "< 30 minutes"
      cost: "~$3-8 USD"

    extended_course:
      lessons: 20-40
      duration: "< 60 minutes"
      cost: "~$10-25 USD"

  handoff_prompts:
    init_to_user: |
      Course structure created!
      Save COURSE-BRIEF.md at outputs/courses/{slug}/COURSE-BRIEF.md
      Fill all 8 sections, then continue with curriculum generation.

    curriculum_to_user: |
      Curriculum generated!
      Review curriculum.yaml - it defines your course structure (modules + lessons).
      Approve to proceed, or edit and regenerate.

    lessons_complete: |
      All lessons generated!
      Review outputs/courses/{slug}/lessons/ for GPS + DL compliant content.
      Edit assessment scaffolds (replace [EDIT ME] placeholders).
      Run validation for quality check.

    workflow_complete: |
      Greenfield course complete!
      All artifacts saved in outputs/courses/{slug}/
      Review, test, iterate, then publish.
