# Aula 2.6: Lead Scoring Inteligente com GPT-4

**M√≥dulo:** 2 - AI Sales Machine
**N√≠vel:** 2 (Funcion√°rio Aprendendo - construir do zero)
**Dura√ß√£o:** 15 minutos
**Ferramentas:** GPT-4, n8n, PostgreSQL, Scoring algorithms

---

## üéØ Objetivos de Aprendizagem

Ao final desta aula, voc√™ ser√° capaz de:

1. **Criar scoring system multi-dimensional** (fit, intent, timing, behavior)
2. **Usar GPT-4 para scoring contextual** (vs regras fixas)
3. **Combinar dados** de 3 fontes (Google Maps + LinkedIn + Apollo)
4. **Priorizar leads automaticamente** (score 0-100)
5. **Atualizar scores dinamicamente** conforme lead interage

---

## üìä Contexto: Por Que Scoring Inteligente?

### Problema: Nem Todo Lead Vale a Pena

Voc√™ coleta **1.500 leads/m√™s** das 3 fontes:
- Google Maps: 800
- LinkedIn: 500
- Apollo: 200

**Quest√µes:**
- Qual lead atacar primeiro?
- Qual lead mandar para SDR humano vs AI?
- Qual lead tem mais chance de fechar?
- Qual lead pode comprar R$ 20k vs R$ 2k?

### Solu√ß√£o: Scoring System

**Lead Score = Fit Score + Intent Score + Timing Score + Behavior Score**

```
Fit Score (0-40):     Qu√£o bem o lead se encaixa no ICP
Intent Score (0-30):  Sinais de inten√ß√£o de compra
Timing Score (0-20):  Momento certo para comprar
Behavior Score (0-10): Como lead se comporta (responde? abre email?)
```

**Total:** 0-100 pontos

---

## üèóÔ∏è Estrutura da Aula (15 min)

```
00:00 - 02:00 | Introdu√ß√£o: Scoring manual vs AI
02:00 - 05:00 | Fit Score: ICP matching
05:00 - 08:00 | Intent Score: Sinais de compra
08:00 - 11:00 | GPT-4 Advanced Scoring
11:00 - 13:00 | Dynamic Scoring (atualiza conforme intera√ß√£o)
13:00 - 15:00 | Routing: High score ‚Üí humano, low ‚Üí AI
```

---

## üéØ Componente 1: Fit Score (0-40 pontos)

### O que √© Fit?

**Qu√£o bem o lead se encaixa no seu ICP (Ideal Customer Profile)?**

### Crit√©rios de Fit

```javascript
const fitScore = {
  // Decision Maker (0-15 pontos)
  decisionMaker: {
    'CEO': 15,
    'Founder': 15,
    'C-level (CTO, CMO, CFO)': 12,
    'VP': 10,
    'Director': 7,
    'Manager': 3,
    'Other': 0
  },

  // Company Size (0-10 pontos)
  companySize: {
    '51-200': 10,    // Sweet spot
    '201-500': 8,
    '11-50': 6,
    '501-1000': 4,
    '1-10': 2,
    '1000+': 1       // Too big (long sales cycle)
  },

  // Industry Fit (0-10 pontos)
  industryFit: {
    'SaaS': 10,
    'Tech': 9,
    'Marketing Agency': 8,
    'Consulting': 7,
    'E-commerce': 6,
    'Other': 3
  },

  // Location (0-5 pontos)
  location: {
    'S√£o Paulo': 5,
    'Rio de Janeiro': 4,
    'Belo Horizonte': 4,
    'Other Brazil': 3,
    'LATAM': 2,
    'Other': 1
  }
};
```

### C√°lculo: JavaScript Function (n8n)

```javascript
function calculateFitScore(lead) {
  let score = 0;

  // Decision Maker
  const titles = ['CEO', 'Founder', 'CTO', 'CMO', 'VP', 'Director'];
  const title = lead.title || lead.job_title || '';

  if (title.match(/CEO|Founder/i)) score += 15;
  else if (title.match(/CTO|CMO|CFO|COO/i)) score += 12;
  else if (title.match(/VP|Vice President/i)) score += 10;
  else if (title.match(/Director/i)) score += 7;
  else if (title.match(/Manager/i)) score += 3;

  // Company Size
  const size = parseInt(lead.company_size || lead.enrichment_data?.organization?.num_employees || 0);

  if (size >= 51 && size <= 200) score += 10;
  else if (size >= 201 && size <= 500) score += 8;
  else if (size >= 11 && size <= 50) score += 6;
  else if (size >= 501 && size <= 1000) score += 4;
  else if (size >= 1 && size <= 10) score += 2;

  // Industry
  const industry = (lead.industry || '').toLowerCase();

  if (industry.match(/saas|software as a service/i)) score += 10;
  else if (industry.match(/software|tech|technology/i)) score += 9;
  else if (industry.match(/marketing|agency/i)) score += 8;
  else if (industry.match(/consulting/i)) score += 7;
  else if (industry.match(/ecommerce|e-commerce/i)) score += 6;
  else score += 3;

  // Location
  const location = (lead.location || lead.city || '').toLowerCase();

  if (location.match(/s√£o paulo|sao paulo/i)) score += 5;
  else if (location.match(/rio de janeiro/i)) score += 4;
  else if (location.match(/belo horizonte|bras√≠lia|curitiba/i)) score += 4;
  else if (location.match(/brazil|brasil/i)) score += 3;
  else score += 1;

  return Math.min(score, 40); // Cap at 40
}
```

---

## üî• Componente 2: Intent Score (0-30 pontos)

### O que √© Intent?

**Sinais que indicam que o lead est√° pronto para comprar AGORA.**

### Intent Signals

```javascript
const intentScore = {
  // Funding (0-10 pontos)
  funding: {
    'Recently funded (last 6 months)': 10,
    'Series A/B': 7,
    'Seed': 5,
    'Bootstrapped': 2,
    'Unknown': 0
  },

  // Hiring (0-8 pontos)
  hiring: {
    'Actively hiring (10+ positions)': 8,
    'Hiring (1-9 positions)': 5,
    'Not hiring': 0
  },

  // Tech Stack (0-7 pontos)
  techStack: {
    'Uses competitor (HubSpot, Salesforce)': 7,  // Already invests in category
    'Uses basic tools (MailChimp, Pipedrive)': 4, // Room to upgrade
    'No tools detected': 1
  },

  // Website Quality (0-5 pontos)
  websiteQuality: {
    'Professional website + blog': 5,
    'Basic website': 3,
    'No website': 0
  }
};
```

### C√°lculo: Intent Score

```javascript
function calculateIntentScore(lead) {
  let score = 0;

  // Funding
  const funding = lead.enrichment_data?.organization?.latest_funding_stage || '';
  const fundingDate = lead.enrichment_data?.organization?.latest_funding_date || '';

  if (fundingDate) {
    const monthsAgo = (Date.now() - new Date(fundingDate)) / (1000 * 60 * 60 * 24 * 30);
    if (monthsAgo < 6) score += 10;
    else if (funding.match(/series_a|series_b/i)) score += 7;
    else if (funding.match(/seed/i)) score += 5;
  }

  // Hiring
  const isHiring = lead.enrichment_data?.organization?.is_hiring;
  const jobOpenings = lead.enrichment_data?.organization?.num_job_openings || 0;

  if (isHiring && jobOpenings >= 10) score += 8;
  else if (isHiring) score += 5;

  // Tech Stack
  const technologies = lead.enrichment_data?.organization?.current_technologies || [];
  const techNames = technologies.map(t => t.name.toLowerCase());

  if (techNames.includes('hubspot') || techNames.includes('salesforce')) score += 7;
  else if (techNames.includes('mailchimp') || techNames.includes('pipedrive')) score += 4;
  else if (techNames.length > 0) score += 1;

  // Website
  const website = lead.website || lead.enrichment_data?.organization?.website_url;

  if (website) {
    // Check if has blog (simple heuristic: /blog in sitemap)
    score += 5; // Assume professional if has website
  }

  return Math.min(score, 30); // Cap at 30
}
```

---

## ‚è∞ Componente 3: Timing Score (0-20 pontos)

### O que √© Timing?

**O lead est√° no momento certo da jornada de compra?**

### Timing Signals

```javascript
const timingScore = {
  // Engagement recente (0-10 pontos)
  recentEngagement: {
    'Replied to email': 10,
    'Opened email 3+ times': 7,
    'Opened email 1-2 times': 4,
    'Clicked link': 6,
    'No engagement': 0
  },

  // Quarter timing (0-5 pontos)
  quarterTiming: {
    'Q4 (budget flush)': 5,
    'Q1 (new budget)': 5,
    'Q2/Q3': 3
  },

  // Response time (0-5 pontos)
  responseTime: {
    'Replied < 24h': 5,
    'Replied 24-48h': 3,
    'Replied > 48h': 1,
    'No reply': 0
  }
};
```

### C√°lculo: Timing Score

```javascript
function calculateTimingScore(lead) {
  let score = 0;

  // Recent Engagement
  if (lead.replied) score += 10;
  else if (lead.email_opens >= 3) score += 7;
  else if (lead.email_opens >= 1) score += 4;

  if (lead.link_clicks > 0) score += 6;

  // Quarter Timing
  const month = new Date().getMonth() + 1; // 1-12
  if ([10, 11, 12, 1].includes(month)) score += 5; // Q4 or Q1
  else score += 3;

  // Response Time
  if (lead.replied && lead.reply_time_hours) {
    if (lead.reply_time_hours < 24) score += 5;
    else if (lead.reply_time_hours < 48) score += 3;
    else score += 1;
  }

  return Math.min(score, 20); // Cap at 20
}
```

---

## ü§ñ GPT-4 Advanced Scoring (Contextual)

### Por Que GPT-4?

**Regras fixas n√£o capturam nuances.**

Exemplo:
- Lead 1: CEO de startup SaaS (score alto)
- Lead 2: CEO de startup SaaS... mas de concorrente direto (score BAIXO!)

GPT-4 entende contexto.

### Prompt para GPT-4 Scoring

```
You are an expert B2B lead scorer for a sales automation company.

Analyze this lead and assign a score 0-100 based on FIT + INTENT + TIMING.

LEAD DATA:
Name: {{ $json.name }}
Title: {{ $json.title }}
Company: {{ $json.company }}
Company Size: {{ $json.company_size }} employees
Industry: {{ $json.industry }}
Location: {{ $json.location }}
Funding: {{ $json.funding_stage }} ({{ $json.funding_amount }})
Hiring: {{ $json.is_hiring }} ({{ $json.num_job_openings }} positions)
Tech Stack: {{ $json.technologies }}
Recent Activity: {{ $json.recent_posts }}
Email Engagement: {{ $json.email_opens }} opens, {{ $json.link_clicks }} clicks

OUR ICP (Ideal Customer Profile):
- Title: CEO, Founder, CMO (decision makers)
- Company Size: 50-200 employees (sweet spot)
- Industry: SaaS, Tech, Marketing Agency
- Funding: Seed to Series B (has budget)
- Location: Brazil (preferably S√£o Paulo)
- Tech Stack: Already uses sales tools (HubSpot, Salesforce)

SCORING BREAKDOWN:
1. **Fit Score (0-40)**: How well does lead match ICP?
   - Decision maker: 0-15
   - Company size: 0-10
   - Industry: 0-10
   - Location: 0-5

2. **Intent Score (0-30)**: Signals they're ready to buy?
   - Funding/budget: 0-10
   - Hiring/growth: 0-8
   - Tech stack: 0-7
   - Website quality: 0-5

3. **Timing Score (0-20)**: Right time to approach?
   - Email engagement: 0-10
   - Quarter timing: 0-5
   - Recent activity: 0-5

4. **Red Flags (-20 to 0)**: Reasons to DISQUALIFY?
   - Competitor: -20
   - Wrong industry: -10
   - Too small/too big: -5
   - Wrong location: -3

OUTPUT (JSON only, no explanation):
{
  "lead_score": 85,
  "fit_score": 38,
  "intent_score": 28,
  "timing_score": 19,
  "red_flags": 0,
  "reasoning": "CEO of 120-person SaaS in S√£o Paulo, recently funded $5M, hiring 15 positions, uses Salesforce. Perfect ICP fit.",
  "recommended_action": "HIGH_PRIORITY",
  "assign_to": "human_SDR"
}
```

### n8n Node: GPT-4 Scoring

```json
{
  "name": "GPT-4 Lead Scoring",
  "type": "@n8n/n8n-nodes-langchain.openAi",
  "parameters": {
    "model": "gpt-4",
    "options": {
      "temperature": 0.3
    },
    "messages": {
      "values": [
        {
          "content": "[PROMPT ACIMA]"
        }
      ]
    }
  }
}
```

---

## üîÑ Dynamic Scoring (Atualiza Conforme Intera√ß√£o)

### Problema: Score Est√°tico Fica Desatualizado

Lead come√ßa com score 60. Depois:
- ‚úÖ Abre email 3x ‚Üí score deve subir para 67
- ‚úÖ Responde "interessado" ‚Üí score sobe para 85
- ‚ùå Responde "n√£o tenho budget" ‚Üí score cai para 40

### Solu√ß√£o: Update Score Triggers

**Trigger 1: Email Opened**

```javascript
// When lead opens email
UPDATE leads
SET
  email_opens = email_opens + 1,
  lead_score = lead_score + 2,
  timing_score = timing_score + 2,
  updated_at = NOW()
WHERE email = '{{ $json.email }}';
```

**Trigger 2: Email Replied**

```javascript
// When lead replies
UPDATE leads
SET
  replied = true,
  reply_sentiment = '{{ $json.sentiment }}', // GPT-4 classifies
  lead_score = CASE
    WHEN '{{ $json.sentiment }}' = 'positive' THEN lead_score + 20
    WHEN '{{ $json.sentiment }}' = 'neutral' THEN lead_score + 5
    WHEN '{{ $json.sentiment }}' = 'negative' THEN lead_score - 10
  END,
  timing_score = timing_score + 10,
  updated_at = NOW()
WHERE email = '{{ $json.email }}';
```

**Trigger 3: Meeting Booked**

```javascript
// When lead books meeting
UPDATE leads
SET
  meeting_booked = true,
  meeting_date = '{{ $json.meeting_date }}',
  lead_score = 95, // Almost guaranteed hot lead
  stage = 'meeting_booked',
  updated_at = NOW()
WHERE email = '{{ $json.email }}';
```

---

## üéØ Lead Routing Baseado em Score

### Routing Rules

```javascript
const routingRules = {
  // Score 90-100: Hot lead ‚Üí Human SDR ASAP
  90: {
    assign_to: 'human_SDR',
    priority: 'URGENT',
    sla: '2 hours', // Human must contact in 2h
    channel: 'phone_call' // Call, don't email
  },

  // Score 70-89: Warm lead ‚Üí Human SDR
  70: {
    assign_to: 'human_SDR',
    priority: 'HIGH',
    sla: '24 hours',
    channel: 'email_personalized'
  },

  // Score 50-69: Qualified ‚Üí AI SDR
  50: {
    assign_to: 'AI_SDR',
    priority: 'MEDIUM',
    sequence: 'standard_7_touch',
    channel: 'email_automated'
  },

  // Score 30-49: Low quality ‚Üí AI Nurture
  30: {
    assign_to: 'AI_nurture',
    priority: 'LOW',
    sequence: 'nurture_monthly',
    channel: 'newsletter'
  },

  // Score 0-29: Disqualify
  0: {
    assign_to: 'disqualified',
    action: 'do_not_contact',
    reason: 'low_fit'
  }
};
```

### n8n Routing Logic

```json
{
  "name": "Route by Score",
  "type": "n8n-nodes-base.switch",
  "parameters": {
    "mode": "expression",
    "rules": [
      {
        "conditions": {
          "number": [
            { "value1": "={{ $json.lead_score }}", "operation": "largerEqual", "value2": 90 }
          ]
        },
        "renameOutput": "Hot Lead ‚Üí Human"
      },
      {
        "conditions": {
          "number": [
            { "value1": "={{ $json.lead_score }}", "operation": "largerEqual", "value2": 70 }
          ]
        },
        "renameOutput": "Warm Lead ‚Üí Human"
      },
      {
        "conditions": {
          "number": [
            { "value1": "={{ $json.lead_score }}", "operation": "largerEqual", "value2": 50 }
          ]
        },
        "renameOutput": "Qualified ‚Üí AI SDR"
      },
      {
        "conditions": {
          "number": [
            { "value1": "={{ $json.lead_score }}", "operation": "largerEqual", "value2": 30 }
          ]
        },
        "renameOutput": "Low ‚Üí Nurture"
      }
    ],
    "fallbackOutput": "Disqualify"
  }
}
```

---

## ‚úÖ Entreg√°vel Pr√°tico

Ao final desta aula:

```
scoring-system/
‚îú‚îÄ‚îÄ fit-score-calculator.js
‚îú‚îÄ‚îÄ intent-score-calculator.js
‚îú‚îÄ‚îÄ timing-score-calculator.js
‚îî‚îÄ‚îÄ gpt4-advanced-scoring-prompt.md

n8n-workflows/
‚îú‚îÄ‚îÄ lead-scoring-workflow.json
‚îî‚îÄ‚îÄ dynamic-score-update-triggers.json

database/
‚îî‚îÄ‚îÄ leads table with columns:
    - lead_score (0-100)
    - fit_score, intent_score, timing_score
    - assigned_to, priority, routing_reason
```

---

## üéØ Checklist de Valida√ß√£o

- [ ] **Fit score calculado** para todos os leads
- [ ] **Intent score** usando dados Apollo (funding, hiring, tech stack)
- [ ] **Timing score** baseado em engagement (opens, clicks, replies)
- [ ] **GPT-4 scoring** funcionando e retornando JSON v√°lido
- [ ] **Dynamic updates** disparando quando lead interage
- [ ] **Routing autom√°tico** (score 90+ ‚Üí humano, 50-69 ‚Üí AI)
- [ ] **Dashboard** mostrando distribui√ß√£o de scores

---

## üöÄ Pr√≥ximos Passos

Agora que tem scoring inteligente:

1. **Aula 2.7** ‚Üí Sequ√™ncias Multi-Canal (adaptar por score)
2. **Aula 2.8** ‚Üí Testes A/B (qual score threshold converte melhor?)
3. **Aula 2.9** ‚Üí Dashboard de M√©tricas (visualizar scores)

---

**üéì Conceito-chave:** Lead scoring n√£o √© "set and forget". Use GPT-4 para scoring contextual e atualize dinamicamente conforme o lead interage. Leads com score 90+ devem ir para humano imediatamente.
