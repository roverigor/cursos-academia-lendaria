# ROTEIRO TELEPROMPTER - Aula 2.2: Arquitetura n8n Multi-Role

**Duração Total:** 15 minutos
**Formato:** Screencast (tela) + Câmera (picture-in-picture quando relevante)

---

## [00:00 - 00:40] ABERTURA + PROBLEMA

**[CÂMERA: Olhando direto, energia média, tom sério]**

Fala! Aula de hoje é CRÍTICA.

Por quê?

Porque a maioria das pessoas que tentam criar AI Sales Machine fazem um erro GIGANTE:

**[MOSTRA NA TELA: Diagrama de workflow monolítico bagunçado - 400+ nodes]**

Criam UM único workflow GIGANTE tentando fazer tudo.

Prospecção → Enriquecimento → Scoring → Email → Follow-up → Meeting → Proposta → Contrato.

Tudo em UM workflow só.

**[PAUSA - tom frustrado]**

Resultado?

❌ Impossível de debugar
❌ Lento demais
❌ Qualquer mudança quebra tudo

**[TRANSIÇÃO - tom confiante]**

Hoje você vai aprender a arquitetura CERTA:

**[MOSTRA NA TELA: Diagrama limpo com 3 workflows separados]**

3 workflows SEPARADOS que se comunicam.

---

## [00:40 - 02:30] POR QUE MODULAR

**[SCREENCAST: Mostrando lado-a-lado monolito vs modular]**

Deixa eu te mostrar a diferença...

**Workflow Monolítico (400 nodes):**

**[SCROLLA pelo workflow gigante bagunçado]**

Olha isso... 400 nodes.

Se DER ERRO em algum lugar...

**[ZOOM em um node no meio]**

...boa sorte achando ONDE foi.

**[PAUSA]**

Agora, arquitetura modular:

**[MOSTRA 3 workflows separados lado-a-lado]**

**Workflow 1: PROSPECT** (100 nodes)
Só faz UMA coisa: Coletar + qualificar leads.

**Workflow 2: SDR** (150 nodes)
Só faz UMA coisa: Outreach + agendar reunião.

**Workflow 3: CLOSER** (120 nodes)
Só faz UMA coisa: Proposta + fechar venda.

**[TOM: Didático]**

Vantagens?

✅ Erro no Prospect? Não afeta SDR.
✅ Quer testar novo email? Mexe só no SDR.
✅ Cada workflow pode rodar INDEPENDENTE.

Isso é **separação de responsabilidades**.

Como engenharia de software REAL.

---

## [02:30 - 05:00] DATABASE: CENTRO DE COMUNICAÇÃO

**[SCREENCAST: Mostrando schema PostgreSQL]**

Ok, mas como os 3 workflows se comunicam?

**[MOSTRA diagrama]**

```
PROSPECT WF → [PostgreSQL] → SDR WF → [PostgreSQL] → CLOSER WF
```

O banco de dados é o **centro de comunicação**.

**[ABRE pgAdmin ou TablePlus]**

Deixa eu te mostrar a tabela `leads`:

**[MOSTRA tabela leads com colunas]**

Olha as colunas importantes:

- `stage`: Onde o lead está no funil
- `lead_score`: Score 0-100
- `assigned_to`: Quem tá trabalhando (AI ou humano)

**[APONTA para dados]**

PROSPECT WF:
→ Insere lead com `stage = 'prospected'`
→ Calcula `lead_score`

SDR WF:
→ Query: "Me dá leads com `stage = 'prospected' AND lead_score > 70`"
→ Manda email
→ Atualiza `stage = 'sdr_outreach'`

CLOSER WF:
→ Query: "Me dá leads com `stage = 'meeting_booked'`"
→ Envia proposta
→ Atualiza `stage = 'closed_won'`

**[TOM: Ênfase]**

Isso é uma **state machine**.

Cada workflow pega lead em um stage, processa, move pro próximo.

Simples. Limpo. Escalável.

---

## [05:00 - 08:00] WORKFLOW 1: PROSPECT ARCHITECTURE

**[SCREENCAST: n8n aberto, mostrando Workflow Prospect]**

Vamos ver como montar o PROSPECT workflow.

**[MOSTRA flow completo em visão panorâmica]**

Overview:

```
[Cron Diário] → [Scrape Google Maps] → [Enrich Apollo] →
[GPT-4 Score] → [Insert PostgreSQL]
```

**[ZOOM no primeiro node]**

**Node 1: Schedule Trigger**

**[MOSTRA configuração]**

Cron: `0 8 * * *` = Todo dia às 8 AM.

Por quê 8 AM? Porque queremos leads FRESCOS toda manhã.

**[NEXT NODE]**

**Node 2: HTTP Request (Google Maps)**

**[MOSTRA config]**

Outscraper API:
- Query: "marketing agency in São Paulo"
- Limit: 100 empresas/dia

**[EXECUTA e mostra output]**

Olha o resultado... **[SCROLL pelo JSON]**

100 empresas com:
- Nome
- Telefone
- Website
- Rating
- Reviews

**[NEXT NODE]**

**Node 3: Apollo Enrich**

**[MOSTRA config + resultado]**

Pega email do CEO, tech stack, funding...

**[NEXT NODE - GPT-4]**

**Node 4: GPT-4 Lead Scoring**

**[MOSTRA prompt]**

```
Score this lead 0-100 based on:
- Company size: {{ employees }}
- Rating: {{ rating }}
- Industry fit: {{ industry }}
```

**[EXECUTA e mostra]**

Output: `{ "lead_score": 85 }`

Perfeito!

**[LAST NODE]**

**Node 5: PostgreSQL Insert**

**[MOSTRA config]**

```sql
INSERT INTO leads (email, company, lead_score, stage, source)
VALUES (..., 'prospected', 'google_maps')
```

**[EXECUTA workflow completo]**

**[MOSTRA resultado no banco]**

Olha... **[QUERY no DB]**

25 leads inseridos, todos com `stage = 'prospected'`.

**[TOM: Satisfeito]**

PROSPECT workflow DONE.

---

## [08:00 - 11:00] WORKFLOW 2: SDR ARCHITECTURE

**[SCREENCAST: n8n, Workflow SDR]**

Agora, SDR workflow.

**[MOSTRA panorama]**

```
[Hourly Cron] → [Query DB: prospected + score > 70] →
[GPT-4 Email] → [Send Gmail] → [Update DB: sdr_outreach]
```

**[TOM: Instrucional]**

Node 1: Query

**[MOSTRA SQL]**

```sql
SELECT * FROM leads
WHERE stage = 'prospected'
AND lead_score > 70
AND outreach_started_at IS NULL
LIMIT 50
```

Traduzindo:

"Me dá 50 leads que o PROSPECT workflow criou, com score alto, que ainda não recebi email."

**[EXECUTA e mostra 50 leads]**

Perfect.

**[NEXT]**

Node 2: GPT-4 Email Generator

**[MOSTRA prompt]**

```
Write personalized cold email for:
- Company: {{ company }}
- Industry: {{ industry }}
Tone: Casual Portuguese
Length: 80 words
```

**[EXECUTA]**

Output: Email personalizado.

**[NEXT]**

Node 3: Send Gmail

**[MOSTRA enviando]**

50 emails enviados.

**[NEXT]**

Node 4: Update Database

```sql
UPDATE leads
SET stage = 'sdr_outreach',
    outreach_started_at = NOW(),
    touch_count = 1
WHERE id = {{ id }}
```

**[QUERY no DB para mostrar]**

Olha... stage mudou de `'prospected'` → `'sdr_outreach'`.

**[TOM: Ênfase]**

Isso é a **transição de estado**.

PROSPECT criou o lead.
SDR assumiu e mandou email.

Próximo passo? CLOSER vai pegar quando tiver reunião agendada.

---

## [11:00 - 13:00] WORKFLOW 3: CLOSER ARCHITECTURE

**[SCREENCAST: Workflow Closer]**

Último workflow: CLOSER.

**[MOSTRA flow]**

```
[Webhook: Meeting Ended] → [Query Lead] → [GPT-4 Proposal] →
[Send Email + Proposal] → [Wait for Reply] → [DocuSign Contract]
```

**[TOM: Rápido, overview]**

Trigger: Calendly webhook quando reunião acaba.

Processo:
1. Gera proposta com GPT-4
2. Manda por email
3. Espera 2 dias
4. Follow-up
5. Envia contrato DocuSign
6. Update `stage = 'closed_won'`

**[MOSTRA execução de exemplo]**

**[QUERY no DB]**

Stage: `'proposal_sent'` → `'closed_won'`.

Perfect.

---

## [13:00 - 14:30] COMUNICAÇÃO ENTRE WORKFLOWS

**[VOLTA para câmera - tom de resumo]**

Recap rápido:

3 workflows SEPARADOS.

Como eles se comunicam?

**[MOSTRA diagrama]**

Via **PostgreSQL**.

PROSPECT insere lead → stage `'prospected'`
SDR query leads com stage `'prospected'` → processa → stage `'sdr_outreach'`
CLOSER query leads com stage `'meeting_booked'` → fecha venda → stage `'closed_won'`

**[TOM: Importante]**

Isso é **event-driven architecture**.

Cada workflow reage a mudanças no banco.

---

## [14:30 - 15:00] CALL TO ACTION + PRÓXIMOS PASSOS

**[CÂMERA: Direto, confiante]**

Próxima aula:

**Aula 2.3**: Vamos implementar o PROSPECT workflow completo, do zero.

Google Maps → Apollo → GPT-4 → PostgreSQL.

Mão na massa.

**[MOSTRA na tela: Checklist]**

Antes da próxima aula, garante que você tem:

✅ PostgreSQL instalado (local ou cloud)
✅ n8n rodando
✅ API keys: Google Maps (Outscraper), Apollo, OpenAI

**[FECHA]**

Valeu! Qualquer dúvida, comenta aqui embaixo.

Até a próxima!

**[FIM]**
